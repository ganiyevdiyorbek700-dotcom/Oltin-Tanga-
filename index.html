<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kosmos Raketa Miner - Space Adventure</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <!-- Monetag reklama SDK (sizning zone ID'ingiz bilan) -->
    <script src="//libtl.com/sdk.js" data-zone="10558007" data-sdk="show_10558007"></script>
    
    <!-- TON Connect SDK (wallet ulash uchun) -->
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

    <style>
        :root { --space-blue: #0b0d17; --gold: #ffd700; --card: #1c222d; --green: #2ecc71; --red: #e74c3c; --blue: #0088cc; --orange: #ffa500; --star-yellow: #ffe066; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--space-blue); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }

        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; pointer-events: none; background: url('https://www.transparenttextures.com/patterns/stardust.png'), #000; }
        .star-bg { background: radial-gradient(circle at top right, #f5f3ce, transparent 40%); }

        .top-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 12px; background: rgba(0,0,0,0.6); }
        .stat-box { background: var(--card); padding: 6px; border-radius: 8px; text-align: center; border: 1px solid #333; }
        .stat-box small { font-size: 10px; color: #aaa; display: block; }
        .stat-box b { font-size: 13px; color: var(--gold); }

        .game-area { display: flex; flex-direction: column; align-items: center; justify-content: flex-end; height: 62vh; padding-bottom: 30px; }
        #balance-main { color: var(--gold); font-size: 38px; margin-bottom: 10px; font-weight: bold; text-shadow: 0 0 10px rgba(255,215,0,0.3); }
        .rocket-wrapper { width: 230px; height: 230px; cursor: pointer; transition: transform 0.05s; }
        .rocket-main { width: 100%; height: 100%; background: linear-gradient(to bottom, #4a90e2, #357abd); border-radius: 50% 50% 20% 20%; display: flex; align-items: center; justify-content: center; font-size: 40px; color: white; box-shadow: 0 0 30px rgba(74, 144, 226, 0.5); position: relative; }
        .rocket-main::after { content: 'ğŸš€'; font-size: 60px; }
        .rocket-wrapper:active { transform: scale(0.92); }

        .fuel-container { width: 80%; text-align: center; margin-top: 15px; }
        .fuel-bar-bg { width: 100%; height: 10px; background: #222; border-radius: 5px; overflow: hidden; margin-top: 5px; }
        #fuel-fill { height: 100%; background: var(--star-yellow); width: 100%; transition: width 0.2s; }

        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #07090c; display: flex; justify-content: space-around; padding: 15px 5px; border-top: 1px solid #222; z-index: 100; }
        .nav-btn { color: #666; text-align: center; font-size: 11px; flex: 1; cursor: pointer; }
        .nav-btn.active { color: var(--gold); }

        .page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--space-blue); z-index: 200; padding: 20px; display: none; overflow-y: auto; padding-bottom: 110px; }
        .card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #333; position: relative; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 10px; font-weight: bold; background: var(--gold); color: #000; cursor: pointer; margin-top: 8px; font-size: 15px; }
        .lock-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); border-radius:15px; display:flex; align-items:center; justify-content:center; color: #ff4d4d; font-weight:bold; z-index: 5; text-align: center;}

        #notify { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 12px 20px; border-radius: 30px; z-index: 3000; display: none; font-weight: bold; text-align: center; color: white; }
        #ton-connect-button-root { margin-top: 10px; }
    </style>
</head>
<body>

<div id="notify"></div>
<div id="bg-fx" class="bg-overlay"></div>

<div class="top-stats">
    <div class="stat-box"><small>ğŸŒŒ Space Coin/soat</small><b id="coin-pph-val">0</b></div>
    <div class="stat-box"><small>ğŸ’ Olmos/soat</small><b id="diam-pph-val">0</b></div>
    <div class="stat-box"><small>ğŸ’ Olmoslar</small><b id="diam-total-val">0</b></div>
    <div class="stat-box"><small>â­ Daraja</small><b id="lvl-val">1</b></div>
</div>

<div class="game-area">
    <div id="balance-main">0</div>
    <div class="rocket-wrapper" onclick="handleLaunch(event)">
        <div class="rocket-main" id="launch-power-val">Launch</div>
    </div>
    <div class="fuel-container">
        <span>â›½ <span id="f-text">500/500</span></span>
        <div class="fuel-bar-bg"><div id="fuel-fill"></div></div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-btn" onclick="openPage('p-upgrade')">Upgrade</div>
    <div class="nav-btn" onclick="openPage('p-bonus')">Bonus</div>
    <div class="nav-btn" onclick="openPage('p-rank')">Rank</div>
    <div class="nav-btn" onclick="openPage('p-boost')">Booster</div>
    <div class="nav-btn" onclick="openPage('p-home')">Profil</div>
</div>

<div id="p-upgrade" class="page">
    <span style="float:right; font-size:30px;" onclick="closePage('p-upgrade')">âœ–</span>
    <h2>Upgrade ğŸš€</h2>
    <div class="card"><b>ğŸ› ï¸ Basic Engine</b><p>+10 Space Coin/soat. Narxi: 100 ğŸ’</p><button class="btn" onclick="buyItem('basic', 100)">Sotib olish</button></div>
    <div class="card"><b>âš¡ Advanced Fuel</b><p>+15 ğŸ’/soat. Narxi: 200 ğŸ’</p><button class="btn" onclick="buyItem('advanced', 200)">Sotib olish</button></div>
    <div class="card"><div id="lock-cosmic" class="lock-overlay">Lvl 3 kerak!</div><b>ğŸŒŒ Cosmic Booster</b><p>+25 ğŸ’/soat. Narxi: 350 ğŸ’</p><button class="btn" onclick="buyItem('cosmic', 350)">Sotib olish</button></div>
    <div class="card"><div id="lock-galaxy" class="lock-overlay">Lvl 3 kerak!</div><b>ğŸŒ  Galaxy Tank</b><p>+35 ğŸ’/soat. Narxi: 500 ğŸ’</p><button class="btn" onclick="buyItem('galaxy', 500)">Sotib olish</button></div>
    <div class="card"><div id="lock-star" class="lock-overlay">Lvl 7 kerak!</div><b>â­ Star Drive</b><p>+100 ğŸ’/soat. Narxi: 1000 ğŸ’</p><button class="btn" onclick="buyItem('star', 1000)">Sotib olish</button></div>
    <div class="card"><div id="lock-universe" class="lock-overlay">Lvl 7 kerak!</div><b>ğŸŒŒ Universe Core</b><p>+250 ğŸ’/soat. Narxi: 5000 ğŸ’</p><button class="btn" onclick="buyItem('universe', 5000)">Sotib olish</button></div>
</div>

<div id="p-bonus" class="page">
    <span style="float:right; font-size:30px;" onclick="closePage('p-bonus')">âœ–</span>
    <h2>Bonuslar ğŸ</h2>
    <div class="card"><h3>Kanal Vazifasi</h3><button class="btn" onclick="goTask()">Kanalga o'tish</button><button class="btn" style="background:var(--green);" onclick="checkTask()">Tekshirish & Olish</button></div>
    <div class="card"><h3>Kunlik Launch ğŸ¬</h3><button class="btn" onclick="claimDaily()">5,000 ğŸŒŒ Olish</button></div>
    <div class="card"><h3>Omadli Asteroid ğŸ¬</h3><p id="lucky-count">Imkoniyat: 3/3</p><button class="btn" onclick="claimLucky()">Yutib olish</button></div>
</div>

<div id="p-rank" class="page"><span style="float:right; font-size:30px;" onclick="closePage('p-rank')">âœ–</span><h2>Reyting ğŸ†</h2><div id="rank-list"></div></div>

<div id="p-boost" class="page">
    <span style="float:right; font-size:30px;" onclick="closePage('p-boost')">âœ–</span>
    <h2>Booster âš¡</h2>
    <div class="card"><b>Mining Rate</b> (PPH) <button class="btn" onclick="buyBoost('pph')">Narxi: <span id="c-pph">500</span></button></div>
    <div class="card"><b>Fuel</b> <button class="btn" onclick="buyBoost('fuel')">Narxi: <span id="c-f">500</span></button></div>
    <div class="card"><b>Launch Power</b> <button class="btn" onclick="buyBoost('launch')">Narxi: <span id="c-launch">500</span></button></div>
</div>

<div id="p-home" class="page">
    <span style="float:right; font-size:30px;" onclick="closePage('p-home')">âœ–</span>
    <h2>Profil ğŸ‘¤</h2>
    <div class="card">Ism: <b id="u-name">...</b><br>ID: <b id="u-id">...</b><br>Space Coins: <b id="p-coins">0</b><br>Olmoslar: <b id="p-diams">0</b></div>
    <button class="btn" onclick="tonConnectUI.openModal()" style="background:var(--blue); color:white;">TON Wallet ulash</button>
    <div id="ton-connect-button-root"></div>
    <button class="btn" style="background:var(--orange); color:white;" onclick="withdrawTON()">TON Chiqarish</button>
</div>

<script>
// Firebase sozlamalari (sizning loyihangiz)
const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" };
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tg = window.Telegram.WebApp;
const user = tg.initDataUnsafe?.user || { id: "12345", first_name: "Mehmon" };

let s = { spaceCoins: 0, diamonds: 0, lvl: 1, pphCoin: 0, pphDiam: 0, fuel: 500, maxF: 500, launch: 1, launchLvl: 1, pphLvl: 1, fLvl: 1, lastD: 0, luckyC: 3, skin: 'default', taskDone: false, lastTime: Date.now(), walletAddress: null };

// TON Connect UI (wallet ulash)
const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
  manifestUrl: 'https://sizning-vercel-url.vercel.app/tonconnect-manifest.json',  // Sizning manifest URL
  buttonRootId: 'ton-connect-button-root',
  uiPreferences: { theme: 'DARK' },
  actionsConfiguration: { twaReturnUrl: 'https://t.me/sizning_bot_username/app' }
});
tonConnectUI.onStatusChange(walletInfo => {
  if (walletInfo?.connected) {
    s.walletAddress = walletInfo.account?.address;
    showNotify(`Wallet ulandi: \( {s.walletAddress.slice(0,6)}... \){s.walletAddress.slice(-4)}`, 'green');
    save();
  } else {
    s.walletAddress = null;
    showNotify('Wallet uzildi', 'red');
    save();
  }
});

// REKLAMA FUNKSIYASI (Monetag)
function runAd(callback) {
    if (typeof show_10558007 === 'function') {
        show_10558007().then(() => { if(callback) callback(); });
    } else { if(callback) callback(); }
}

// Ma'lumotlarni yuklash
db.ref('users/' + user.id).on('value', snap => {
    if(snap.exists()) {
        let data = snap.val();
        let now = Date.now();
        // Offline mining
        if(data.lastTime) {
            let diff = Math.floor((now - data.lastTime)/1000);
            if(diff > 10) {
                s.spaceCoins = (data.spaceCoins || 0) + (data.pphCoin / 3600) * Math.min(diff, 86400);
                s.diamonds = (data.diamonds || 0) + (data.pphDiam / 3600) * Math.min(diff, 86400);
                s.fuel = Math.min(data.maxF || 500, (data.fuel || 0) + diff);
            } else { Object.assign(s, data); }
        } else { Object.assign(s, data); }
    }
    updateUI();
});

function updateUI() {
    // Level tizimi
    const levels = [0, 50000, 100000, 500000, 1000000, 10000000, 50000000, 100000000];
    let clvl = 1; levels.forEach((v, i) => { if(s.spaceCoins >= v) clvl = i+1; });
    s.lvl = clvl;

    document.getElementById('balance-main').innerText = Math.floor(s.spaceCoins).toLocaleString();
    document.getElementById('coin-pph-val').innerText = s.pphCoin;
    document.getElementById('diam-pph-val').innerText = s.pphDiam;
    document.getElementById('diam-total-val').innerText = Math.floor(s.diamonds).toLocaleString();
    document.getElementById('lvl-val').innerText = s.lvl;
    document.getElementById('launch-power-val').innerText = "Launch";
    document.getElementById('f-text').innerText = Math.floor(s.fuel) + "/" + s.maxF;
    document.getElementById('fuel-fill').style.width = (s.fuel/s.maxF*100) + "%";
    
    document.getElementById('u-name').innerText = user.first_name;
    document.getElementById('u-id').innerText = user.id;
    document.getElementById('p-coins').innerText = Math.floor(s.spaceCoins).toLocaleString();
    document.getElementById('p-diams').innerText = Math.floor(s.diamonds).toLocaleString();
    document.getElementById('lucky-count').innerText = `Imkoniyat: ${s.luckyC}/3`;

    // Boster narxlari
    document.getElementById('c-pph').innerText = (500 * Math.pow(2, s.pphLvl-1)).toLocaleString();
    document.getElementById('c-f').innerText = (500 * Math.pow(2, s.fLvl-1)).toLocaleString();
    document.getElementById('c-launch').innerText = (500 * Math.pow(2, s.launchLvl-1)).toLocaleString();

    // Qulflar
    document.getElementById('lock-cosmic').style.display = s.lvl >= 3 ? 'none' : 'flex';
    document.getElementById('lock-galaxy').style.display = s.lvl >= 3 ? 'none' : 'flex';
    document.getElementById('lock-star').style.display = s.lvl >= 7 ? 'none' : 'flex';
    document.getElementById('lock-universe').style.display = s.lvl >= 7 ? 'none' : 'flex';

    // Skinlar (space theme)
    const bg = document.getElementById('bg-fx');
    bg.className = 'bg-overlay';
    if(s.skin === 'cosmic') bg.classList.add('star-bg');
}

function handleLaunch(e) {
    if(s.fuel >= s.launch) {
        s.spaceCoins += s.launch; s.fuel -= s.launch; updateUI();
    } else {
        showNotify("Fuel tugadi! Reklama ko'rib to'ldiring", "red");
        runAd(() => { s.fuel = s.maxF; updateUI(); showNotify("Fuel tiklandi!â›½", "green"); });
    }
}

function buyItem(id, price) {
    if(s.diamonds >= price) {
        s.diamonds -= price;
        if(id === 'basic') s.pphCoin += 10;
        if(id === 'advanced') s.pphDiam += 15;
        if(id === 'cosmic') { s.pphDiam += 25; s.skin = 'cosmic'; }
        if(id === 'galaxy') s.pphDiam += 35;
        if(id === 'star') { s.pphDiam += 100; s.skin = 'star'; }
        if(id === 'universe') { s.pphDiam += 250; s.skin = 'universe'; }
        save(); showNotify("Sotib olindi! âœ…", "green");
    } else showNotify("Olmos yetarli emas!", "red");
}

function buyBoost(type) {
    let cost = 0;
    if(type==='pph') cost = 500 * Math.pow(2, s.pphLvl-1);
    if(type==='fuel') cost = 500 * Math.pow(2, s.fLvl-1);
    if(type==='launch') cost = 500 * Math.pow(2, s.launchLvl-1);

    if(s.spaceCoins >= cost) {
        s.spaceCoins -= cost;
        if(type==='pph') { s.pphLvl++; s.pphCoin += 100; }
        if(type==='fuel') { s.fLvl++; s.maxF += 500; s.fuel = s.maxF; }
        if(type==='launch') { s.launchLvl++; s.launch++; }
        save(); updateUI();
    } else showNotify("Space Coins yetarli emas!", "red");
}

function claimDaily() {
    let now = Date.now();
    if(now - s.lastD > 86400000) {
        runAd(() => { s.spaceCoins += 5000; s.lastD = now; save(); showNotify("+5,000 ğŸŒŒ berildi!", "green"); });
    } else showNotify("Hali vaqt bor!", "red");
}

function claimLucky() {
    if(s.luckyC > 0) {
        runAd(() => {
            let win = Math.floor(Math.random()*10001);
            s.spaceCoins += win; s.luckyC--; save();
            showNotify(`+${win} ğŸŒŒ yutdingiz!`, "green");
        });
    } else showNotify("Imkoniyat qolmadi!", "red");
}

function goTask() { tg.openTelegramLink("https://t.me/sizning_kanal_uz"); s.clicked = true; }
function checkTask() {
    if(!s.taskDone && s.clicked) {
        s.spaceCoins += 10000; s.diamonds += 10; s.taskDone = true; save();
        showNotify("Vazifa bajarildi! âœ…", "green");
    } else showNotify("Avval kanalga o'ting!", "red");
}

function loadRank() {
    db.ref('users').orderByChild('spaceCoins').limitToLast(15).once('value', snap => {
        let list = []; snap.forEach(c => {
            let d = c.val();
            list.push({name: d.first_name || "User", id: c.key, coins: d.spaceCoins || 0, lvl: d.lvl || 1, diam: d.diamonds || 0});
        });
        list.sort((a,b) => b.coins - a.coins);
        let h = '';
        list.forEach((u, i) => {
            h += `<div style="background:#161b22; padding:10px; border-radius:10px; margin-bottom:8px; border:1px solid #333; display:flex; justify-content:space-between; align-items:center;">
                <div><b>#${i+1} \( {u.name}</b><br><small style="color:#666">ID: \){u.id} | Lvl:${u.lvl}</small></div>
                <div style="text-align:right"><b>\( {Math.floor(u.coins).toLocaleString()} ğŸŒŒ</b><br><small>ğŸ’ \){Math.floor(u.diam)}</small></div>
            </div>`;
        });
        document.getElementById('rank-list').innerHTML = h;
    });
}

function openPage(id) { 
    document.getElementById(id).style.display = 'block'; 
    if(id === 'p-rank') loadRank();
    if(['p-upgrade', 'p-boost', 'p-bonus'].includes(id)) runAd(); // Bo'limga o'tganda reklama
}
function closePage(id) { document.getElementById(id).style.display = 'none'; }

function showNotify(m, c) {
    let n = document.getElementById('notify'); n.innerText = m;
    n.style.background = c === 'green' ? '#2ecc71' : (c === 'orange' ? '#ffa500' : '#e74c3c');
    n.style.display = 'block'; setTimeout(() => n.style.display = 'none', 2500);
}

function save() { s.lastTime = Date.now(); db.ref('users/' + user.id).update(s); }

// TON chiqarish
function withdrawTON() {
    if (!s.walletAddress) {
        showNotify("Avval TON Wallet ulang!", "red");
        tonConnectUI.openModal();
        return;
    }
    showNotify("TON chiqarish: Walletga yuborilmoqda... (Tez kunda!)", "orange");
    // Realda: tonConnectUI.sendTransaction({ to: s.walletAddress, value: '50000000' }) qo'shing (nanoTON)
}

// Avtomatik tiklanish va mining
setInterval(() => {
    if(s.fuel < s.maxF) s.fuel = Math.min(s.maxF, s.fuel + 1);
    if(s.pphCoin > 0) s.spaceCoins += (s.pphCoin / 3600);
    if(s.pphDiam > 0) s.diamonds += (s.pphDiam / 3600);
    updateUI();
}, 1000);

setInterval(save, 30000); // Har 30 soniyada saqlash
tg.expand();
</script>
</body>
                    </html>
        
    
    
    
        
            
        
                                               
    
            
        
        
    
        
    
    
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

