<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga PRO</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

    <script src='https://alwingulla.com/88/p.js' async data-ahasid='10558007'></script>

    <style>
        :root { --gold: #fbc531; --bg: #0c111c; --card: #1c2230; --green: #4cd137; --blue: #00d2ff; --ruby: #ff4757; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin:0; padding:0; font-family: 'Segoe UI', sans-serif; }
        
        body { background: var(--bg); color: white; height: 100vh; overflow: hidden; display: flex; flex-direction: column; transition: 0.8s; }

        /* Tabaqa Fonlari */
        body.tab-1 { background: #0c111c; }
        body.tab-2 { background: linear-gradient(180deg, #0c111c 0%, #1e3799 100%); }
        body.tab-3 { background: radial-gradient(circle, #2c3e50 0%, #000 100%); }
        body.tab-4 { background: linear-gradient(180deg, #0c111c 0%, #b71c1c 100%); }
        body.tab-5 { background: linear-gradient(180deg, #0c111c 0%, #1b5e20 100%); }

        /* Loading */
        #loading { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .spin { width: 50px; height: 50px; border: 5px solid #222; border-top-color: var(--gold); border-radius: 50%; animation: s 1s linear infinite; }
        @keyframes s { to { transform: rotate(360deg); } }

        /* Header & Stats */
        .h-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 10px; }
        .s-box { background: var(--card); border: 1px solid #333; border-radius: 12px; padding: 8px; text-align: center; }
        .s-box small { font-size: 10px; color: #888; display: block; }
        .s-box b { color: var(--green); font-size: 14px; }

        /* Main Game */
        .main-container { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .balance { font-size: 60px; font-weight: 900; color: var(--gold); text-shadow: 0 0 20px rgba(251,197,49,0.3); }
        
        .coin-btn {
            width: 270px; height: 270px;
            background: radial-gradient(circle, #fbc531, #cc8e00);
            border-radius: 50%; border: 10px solid #8a6200;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.05s;
            box-shadow: 0 15px 40px rgba(0,0,0,0.6);
            z-index: 10;
        }
        .coin-btn:active { transform: scale(0.92); }

        /* Navbar */
        .nav { display: flex; background: #000; padding: 15px 0; border-top: 1px solid #222; }
        .n-item { flex: 1; text-align: center; font-size: 10px; color: #7f8fa6; cursor: pointer; }
        .n-item i { font-size: 24px; display: block; margin-bottom: 4px; font-style: normal; }

        /* Modal Pages */
        .modal { position: fixed; inset: 0; background: var(--bg); z-index: 1000; padding: 20px; display: none; overflow-y: auto; }
        .p-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .close { font-size: 30px; color: var(--ruby); cursor: pointer; }

        /* Aviator */
        #av-screen { background: #000; height: 220px; position: relative; border-radius: 15px; overflow: hidden; border: 1px solid #333; }
        #rocket { position: absolute; bottom: 10px; left: 10%; font-size: 35px; transition: 0.1s; }
        .hist-chip { background: #222; padding: 3px 10px; border-radius: 5px; font-size: 10px; color: var(--gold); }

        /* Rank */
        .rank-row { background: #fbc53111; border: 1px solid #fbc53133; padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; margin-bottom: 10px; }

        #toast { position: fixed; top: 30px; left: 50%; transform: translateX(-50%); background: white; color: black; padding: 10px 25px; border-radius: 50px; z-index: 10001; display: none; font-weight: bold; }
    </style>
</head>
<body class="tab-1">

<div id="loading"><div class="spin"></div><p style="margin-top:10px">Yuklanmoqda...</p></div>
<div id="toast"></div>

<div class="h-stats">
    <div class="s-box"><small>üìÄ Tanga Mining</small><b id="ui-pph">0 /s</b></div>
    <div class="s-box"><small>üíé Olmos Mining</small><b id="ui-dph">0 /s</b></div>
</div>

<div style="padding: 0 15px;">
    <div style="display:flex; justify-content:space-between; font-size:11px; margin-bottom:4px;"><span id="ui-tab-name">Qishloq üè°</span> <span id="ui-perc">0%</span></div>
    <div style="background:#1e272e; height:8px; border-radius:10px; overflow:hidden;"><div id="ui-bar" style="width:0%; background:var(--gold); height:100%; transition:0.5s"></div></div>
</div>

<div class="main-container">
    <h1 class="balance" id="ui-bal">0</h1>
    <div style="color:var(--blue); font-weight:bold; margin-bottom:15px;">üíé <span id="ui-diam">0</span></div>
    <div class="coin-btn" onclick="handleTap(event)">
        <span style="font-size:60px; color:white; font-weight:900;" id="ui-tap-val">+1</span>
    </div>
    <div style="margin-top:25px; background:rgba(0,0,0,0.5); padding:8px 25px; border-radius:30px; border:1px solid #333;">‚ö° <b id="ui-en">5000 / 5000</b></div>
</div>

<div class="nav">
    <div class="n-item" onclick="openPage('p-shop')"><i>üÉè</i>Do'kon</div>
    <div class="n-item" onclick="openPage('p-bonus')"><i>üéÅ</i>Bonus</div>
    <div class="n-item" onclick="openPage('p-games')"><i>üéÆ</i>O'yinlar</div>
    <div class="n-item" onclick="openPage('p-rank')"><i>üèÜ</i>Reyting</div>
    <div class="n-item" onclick="openPage('p-prof')"><i>üë§</i>Profil</div>
</div>

<div id="p-shop" class="modal">
    <div class="p-head"><h2>Upgrade Kartalar</h2><span class="close" onclick="closePage('p-shop')">√ó</span></div>
    <div id="shop-grid" style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;"></div>
</div>

<div id="p-bonus" class="modal">
    <div class="p-head"><h2>Bonus Markazi</h2><span class="close" onclick="closePage('p-bonus')">√ó</span></div>
    <div class="s-box" style="margin-bottom:15px; padding:20px;">
        <h3>Super Tap üî•</h3>
        <p>30 sek: Tap=1000 & Energiya cheksiz!</p>
        <button onclick="adWrapper('super')" style="width:100%; background:var(--gold); padding:12px; border:none; border-radius:10px; margin-top:10px; font-weight:bold;">REKLAMA VA YOQISH</button>
    </div>
    <div class="s-box" style="padding:20px;">
        <h3>Omadli Sandiq üéÅ</h3>
        <button onclick="adWrapper('chest')" style="width:100%; background:var(--blue); padding:12px; border:none; border-radius:10px; margin-top:10px; font-weight:bold;">REKLAMA VA OCHISH</button>
    </div>
</div>

<div id="p-games" class="modal">
    <div class="p-head"><h2>Mini O'yinlar</h2><span class="close" onclick="closePage('p-games')">√ó</span></div>
    <div id="av-screen">
        <h2 id="av-mult" style="text-align:center; margin-top:60px; font-size:45px; color:var(--gold)">1.00x</h2>
        <div id="rocket">üöÄ</div>
    </div>
    <div id="av-history" style="display:flex; gap:5px; margin-top:10px; overflow-x:auto; padding:5px;"></div>
    <div style="display:flex; gap:10px; margin-top:10px;">
        <button id="av-btn-start" onclick="adWrapper('av')" style="flex:1; background:var(--green); padding:15px; border:none; border-radius:10px; font-weight:bold;">TIKISH (1000)</button>
        <button id="av-btn-cash" onclick="cashoutAviator()" style="flex:1; background:var(--gold); padding:15px; border:none; border-radius:10px; font-weight:bold; display:none;">OLISH</button>
    </div>
    <hr style="margin:25px 0; opacity:0.1;">
    <h3>üß© Puzzle 36 (2 min)</h3>
    <div id="puz-board" style="display:grid; grid-template-columns:repeat(6,1fr); gap:2px; margin-top:15px;"></div>
    <button id="puz-start-btn" onclick="adWrapper('puz')" style="width:100%; background:var(--blue); padding:15px; border:none; border-radius:10px; margin-top:15px; font-weight:bold;">O'YINNI BOSHLASH</button>
</div>

<div id="p-rank" class="modal">
    <div class="p-head"><h2>Global Reyting</h2><span class="close" onclick="closePage('p-rank')">√ó</span></div>
    <div id="rank-list"></div>
</div>

<div id="p-prof" class="modal">
    <div class="p-head"><h2>Mening Profilim</h2><span class="close" onclick="closePage('p-prof')">√ó</span></div>
    <div class="s-box" style="text-align:left; line-height:2;">
        <p>üë§ Ism: <b id="u-name">...</b></p>
        <p>üÜî ID: <span id="u-id">...</span></p>
        <hr style="opacity:0.1; margin:10px 0;">
        <h3>üîó TON Hamyon</h3>
        <div id="ton-connect-btn"></div>
        <hr style="opacity:0.1; margin:10px 0;">
        <h3 style="color:var(--green)">üöÄ AIRDROP TAYMERI</h3>
        <div id="air-timer" style="font-size:28px; font-weight:900;">00:00:00</div>
        <p style="font-size:10px; color:#888;">Har bir tabaqa va olmos uchun haqiqiy tokenlar beriladi!</p>
    </div>
</div>

<script>
// --- FIREBASE VA ASOSIY SOZLAMALAR ---
const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tg = window.Telegram.WebApp;
const user = tg.initDataUnsafe?.user || { id: "TEST_USER", first_name: "O'yinchi" };

let s = { c: 0, d: 0, pph: 0, dph: 0, e: 5000, tap: 1, tab: 1, items: {}, puzLast: 0 };
let isSuper = false;

// --- REKLAMA FUNKSIYASI (MONETAG) ---
function adWrapper(type) {
    if(typeof show_10558007 === 'function') {
        show_10558007().then(() => {
            executeReward(type);
        }).catch(() => {
            toast("Reklama yuklanmadi!");
            // Test rejimi uchun reklamasiz ham ishlatish (ixtiyoriy): executeReward(type);
        });
    } else {
        toast("Reklama scripti topilmadi!");
        executeReward(type); // Faqat ishlab chiqish davrida
    }
}

function executeReward(type) {
    if(type === 'super') { isSuper=true; s.tap=1000; toast("SUPER TAP YOQILDI!"); setTimeout(()=>{isSuper=false; s.tap=1; updateUI();}, 30000); }
    if(type === 'chest') { let w=Math.floor(Math.random()*80000)+20000; s.c+=w; toast(w.toLocaleString()+" tanga yutdingiz!"); }
    if(type === 'av') startAviator();
    if(type === 'puz') startPuzzle();
    if(type === 'energy') { s.e=5000; updateUI(); }
}

// --- O'YIN MANTIG'I ---
function init() {
    db.ref('users/' + user.id).once('value', snap => {
        if(snap.val()) s = {...s, ...snap.val()};
        document.getElementById('loading').style.display = 'none';
        updateUI();
        renderShop();
        setInterval(mainLoop, 1000);
    });
}

function mainLoop() {
    s.c += (s.pph / 3600);
    s.d += (s.dph / 3600);
    if(s.e < 5000 && !isSuper) s.e = Math.min(5000, s.e + 2);
    updateUI();
    updateAirdrop();
}

function handleTap(e) {
    if(s.e >= s.tap || isSuper) {
        s.c += s.tap;
        if(!isSuper) s.e -= s.tap;
        updateUI();
        createTapEf(e.pageX, e.pageY);
    } else {
        toast("Energiya tugadi!");
        adWrapper('energy');
    }
}

function updateUI() {
    document.getElementById('ui-bal').innerText = Math.floor(s.c).toLocaleString();
    document.getElementById('ui-diam').innerText = Math.floor(s.d).toLocaleString();
    document.getElementById('ui-pph').innerText = "+" + Math.floor(s.pph) + " /s";
    document.getElementById('ui-dph').innerText = "+" + Math.floor(s.dph) + " /s";
    document.getElementById('ui-en').innerText = Math.floor(s.e) + " / 5000";
    document.getElementById('ui-tap-val').innerText = "+" + s.tap;
    
    let n = s.tab * 200000;
    let p = (s.c % n) / n * 100;
    document.getElementById('ui-bar').style.width = p + "%";
    document.getElementById('ui-perc').innerText = Math.floor(p) + "%";
    document.body.className = "tab-" + s.tab;
    
    document.getElementById('u-name').innerText = user.first_name;
    document.getElementById('u-id').innerText = user.id;
}

// --- AVIATOR ---
let avX = 1.0, avInt;
function startAviator() {
    if(s.c < 1000) return toast("Mablag' kam!");
    s.c -= 1000;
    document.getElementById('av-btn-start').style.display = 'none';
    document.getElementById('av-btn-cash').style.display = 'block';
    avX = 1.0;
    let crash = (Math.random() * 4 + 1.2).toFixed(2);
    avInt = setInterval(() => {
        avX += 0.01;
        document.getElementById('av-mult').innerText = avX.toFixed(2) + "x";
        document.getElementById('rocket').style.left = (10 + avX*5) + "%";
        document.getElementById('rocket').style.bottom = (10 + avX*5) + "px";
        if(avX >= crash) {
            clearInterval(avInt);
            toast("BOOM! üí•");
            addHistory(avX.toFixed(2));
            resetAviator();
        }
    }, 100);
}
function cashoutAviator() {
    clearInterval(avInt);
    let win = 1000 * avX;
    s.c += win;
    toast(Math.floor(win) + " yutdingiz!");
    addHistory(avX.toFixed(2));
    resetAviator();
}
function resetAviator() {
    document.getElementById('av-btn-start').style.display = 'block';
    document.getElementById('av-btn-cash').style.display = 'none';
    document.getElementById('av-mult').innerText = "1.00x";
}
function addHistory(x) {
    let d = document.createElement('div'); d.className='hist-chip'; d.innerText=x+'x';
    document.getElementById('av-history').prepend(d);
}

// --- PUZZLE ---
function startPuzzle() {
    if(Date.now() < s.puzLast) return toast("1 soat kuting!");
    let b = document.getElementById('puz-board'); b.innerHTML = '';
    let items = ["üè†","üå≥","üöó","üçé","üê∂","üê±","üåô","‚≠ê","üî•","üçé","üè†","üå≥","üöó","üçé","üê∂","üê±","üåô","‚≠ê"]; 
    let shuffle = [...items, ...items].sort(() => Math.random() - 0.5);
    shuffle.forEach(e => {
        let t = document.createElement('div'); t.innerText=e;
        t.style.cssText = "background:var(--card); aspect-ratio:1; display:flex; align-items:center; justify-content:center; border:1px solid #333; font-size:20px;";
        b.appendChild(t);
    });
    setTimeout(() => {
        toast("Puzzle tugadi! 100K yutuq!");
        s.c += 100000; s.puzLast = Date.now() + 3600000;
        b.innerHTML = ''; updateUI(); save();
    }, 120000);
}

// --- DO'KON ---
function renderShop() {
    let h = '';
    for(let i=1; i<=25; i++) {
        let cost = Math.floor(5000 * Math.pow(1.5, i/2));
        let pph = i * 100;
        h += `<div class="s-box">
            <h4>Karta ${i}</h4>
            <p style="color:var(--green)">+${pph} /s</p>
            <button onclick="buyK(${i},${cost},${pph})" style="width:100%; background:var(--gold); border:none; padding:8px; border-radius:5px; font-weight:bold; margin-top:5px;">${cost.toLocaleString()}</button>
        </div>`;
    }
    document.getElementById('shop-grid').innerHTML = h;
}
function buyK(id, c, p) {
    if(s.c >= c) {
        s.c -= c; s.pph += p;
        if(id % 5 === 0) s.dph += 20;
        if(id % 5 === 0 && s.tab < 5) s.tab++;
        updateUI(); save();
    } else toast("Mablag' kam!");
}

// --- REYTING ---
function loadRank() {
    db.ref('users').orderByChild('c').limitToLast(15).once('value', snap => {
        let l = document.getElementById('rank-list'); l.innerHTML = '';
        let arr = []; snap.forEach(u => arr.push(u.val()));
        arr.reverse().forEach((p, i) => {
            let m = i==0?'ü•á':i==1?'ü•à':i==2?'ü•â':(i+1);
            l.innerHTML += `<div class="rank-row"><span>${m}. ${p.first_name}</span><b>${Math.floor(p.c).toLocaleString()}</b></div>`;
        });
    });
}

function openPage(id) { if(id==='p-rank') loadRank(); document.getElementById(id).style.display='block'; }
function closePage(id) { document.getElementById(id).style.display='none'; }
function toast(m) { let t=document.getElementById('toast'); t.innerText=m; t.style.display='block'; setTimeout(()=>t.style.display='none',2500); }
function save() { db.ref('users/'+user.id).update(s); }
function createTapEf(x,y) {
    let d = document.createElement('div'); d.innerText="+"+s.tap;
    d.style.cssText=`position:fixed; left:${x}px; top:${y}px; color:white; font-weight:bold; font-size:25px; pointer-events:none; z-index:2000;`;
    document.body.appendChild(d);
    d.animate([{transform:'translateY(0)', opacity:1},{transform:'translateY(-100px)', opacity:0}], 800).onfinish=()=>d.remove();
}
function updateAirdrop() {
    let diff = new Date("2026-05-20") - new Date();
    document.getElementById('air-timer').innerText = Math.floor(diff/(1000*60*60*24)) + " Kun " + new Date(diff).toISOString().substr(11,8);
}

init();
</script>

<script>
// TON CONNECT
const tonUI = new TON_CONNECT_UI.TonConnectUI({
    manifestUrl: 'https://ganiyevdiyorbek700-dotcom.github.io/Oltin-Tanga-/tonconnect-manifest.json',
    buttonRootId: 'ton-connect-btn'
});
</script>

</body>
        </html>
            
        
                                               
    
            
        
        
    
        
    
    
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

