<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tanha Empire: AI Evolution</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="//libtl.com/sdk.js" data-zone="10558007" data-sdk="show_10558007"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Outfit:wght@300;500;800&display=swap');
        
        :root {
            --p: #fbc531; --s: #4cd137; --err: #ff4757; --bg: #010409;
            --neon: #00f2ff; --glass: rgba(255, 255, 255, 0.05);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { 
            background: var(--bg); color: white; height: 100vh; overflow: hidden; 
            font-family: 'Outfit', sans-serif;
        }

        /* 1. KREATIV LOADING */
        #loader {
            position: fixed; inset: 0; background: #000; z-index: 10000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .load-anim {
            width: 120px; height: 120px; border: 4px solid #111; border-top: 4px solid var(--neon);
            border-radius: 50%; animation: spin 1s infinite linear; box-shadow: 0 0 20px var(--neon);
        }

        /* 2. HEADER & STATUS */
        .header {
            padding: 15px; display: grid; grid-template-columns: 1fr 2fr 1fr; align-items: center;
            background: rgba(0,0,0,0.8); border-bottom: 1px solid var(--glass);
        }
        .status-top { text-align: center; font-family: 'Orbitron'; font-size: 14px; }
        
        /* 3. ASOSIY MAYDON (MAIN CORE) */
        .main-core { height: 60vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .tap-power { font-size: 20px; font-weight: 800; color: var(--neon); margin-bottom: 10px; text-shadow: 0 0 10px var(--neon); }
        
        .coin-box { position: relative; }
        .tap-circle {
            width: 240px; height: 240px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 80px; cursor: pointer; transition: 0.1s; border: 10px solid rgba(255,255,255,0.05);
        }
        .tap-circle:active { transform: scale(0.9); }

        /* EVOLUTIONS (20 TA) */
        .evo-1 { background: radial-gradient(circle, #00a8ff, #001233); box-shadow: 0 0 50px #00a8ff; }
        .evo-20 { background: radial-gradient(circle, #fff, #fbc531); box-shadow: 0 0 100px #fff; animation: shine 2s infinite; }

        /* LVL PROGRESS */
        .lvl-box { width: 85%; margin-top: 30px; }
        .lvl-bar { width: 100%; height: 10px; background: #111; border-radius: 20px; overflow: hidden; border: 1px solid #333; }
        #lvl-fill { height: 100%; width: 0%; background: linear-gradient(90deg, var(--neon), var(--p)); transition: 0.5s; }

        /* 4. NAV BAR (ASOSIY 5 TA) */
        .nav {
            position: fixed; bottom: 0; width: 100%; display: flex; 
            background: #000; padding: 15px 0; border-top: 1px solid #222;
        }
        .nav-item { flex: 1; text-align: center; color: #555; font-size: 10px; cursor: pointer; transition: 0.3s; }
        .nav-item i { font-size: 24px; display: block; margin-bottom: 4px; font-style: normal; }
        .nav-item.active { color: var(--p); transform: translateY(-5px); }

        /* 5. PAGES */
        .page { position: fixed; inset: 0; background: var(--bg); z-index: 2000; display: none; padding: 25px; overflow-y: auto; padding-bottom: 120px; }
        .glass-card { background: var(--glass); border-radius: 20px; padding: 20px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.08); backdrop-filter: blur(10px); }
        .btn-buy { width: 100%; padding: 12px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; margin-top: 10px; }

        /* 6. MINI GAMES OVERLAY */
        #game-screen { position: fixed; inset: 0; background: #000; z-index: 5000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        #game-timer { font-size: 40px; font-family: 'Orbitron'; color: var(--err); margin-bottom: 20px; }

        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes shine { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(1.5); } }
    </style>
</head>
<body>

<div id="loader">
    <div class="load-anim"></div>
    <h2 style="margin-top:20px; font-family:'Orbitron'; color:var(--neon)">INITIALIZING AI...</h2>
</div>

<div class="header">
    <button class="nav-item" style="background:none; border:none;" onclick="toggleLang()" id="lang-btn">üá∫üáø UZ</button>
    <div class="status-top">
        <div style="color:var(--p)">üìÄ <span id="bal-top">0</span></div>
        <div style="font-size:10px; color:#aaa">Mining: <span id="rob-power">0</span>/h</div>
    </div>
    <div onclick="openP('p-faq')" style="font-size:22px; text-align:right; cursor:pointer">‚ùì</div>
</div>

<div class="main-core">
    <div class="tap-power" id="tap-val">TAP POWER: 1</div>
    <div class="coin-box" onclick="handleTap(event)">
        <div class="tap-circle evo-1" id="coin-main">üìÄ</div>
    </div>
    <div class="lvl-box">
        <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:5px;">
            <span id="lvl-txt">LEVEL 1</span>
            <span id="lvl-percent">0%</span>
        </div>
        <div class="lvl-bar"><div id="lvl-fill"></div></div>
    </div>
    <div style="margin-top:20px; font-weight:900">‚ö° <span id="st-en">5000</span> / 5000</div>
</div>

<div class="nav">
    <div class="nav-item" onclick="openP('p-shop', true)"><i>üõí</i>Do'kon</div>
    <div class="nav-item" onclick="openP('p-bonus', true)"><i>üéÅ</i>Bonus</div>
    <div class="nav-item active" onclick="closeAll()"><i>üè†</i>Asosiy</div>
    <div class="nav-item" onclick="openP('p-games')"><i>üïπÔ∏è</i>O'yinlar</div>
    <div class="nav-item" onclick="openP('p-prof')"><i>üë§</i>Profil</div>
</div>

<div id="p-shop" class="page">
    <div style="display:flex; justify-content:space-between"><h2>Imperiya Do'koni</h2> <h2 onclick="closeP('p-shop')">‚úï</h2></div>
    <div id="shop-container" style="margin-top:20px;">
        </div>
</div>

<div id="p-games" class="page">
    <h2>Mini O'yinlar üéÆ</h2>
    <div class="glass-card" onclick="checkGameLimit('2048')">
        <h3>üî¢ Tanga 2048</h3>
        <p>Yutuq: 25,000 üìÄ + 25 üíé</p>
        <button class="btn-buy" style="background:var(--neon); color:#000">O'YNASH (1/1)</button>
    </div>
    <div class="glass-card" onclick="checkGameLimit('memory')">
        <h3>üß† Memory Match</h3>
        <button class="btn-buy" style="background:var(--s); color:#000">O'YNASH (1/1)</button>
    </div>
    <div class="glass-card" onclick="checkGameLimit('sort')">
        <h3>üß™ Ball Sort</h3>
        <button class="btn-buy" style="background:var(--p); color:#000">O'YNASH (1/1)</button>
    </div>
</div>

<div id="p-prof" class="page">
    <div style="display:flex; justify-content:space-between"><h2>Profil</h2> <h2 onclick="closeP('p-prof')">‚úï</h2></div>
    <div class="glass-card" style="text-align:center;">
        <div style="width:80px; height:80px; background:var(--p); border-radius:50%; margin:0 auto 10px; font-size:40px; display:flex; align-items:center; justify-content:center;">üë§</div>
        <h2 id="u-name">O'yinchi</h2>
        <p>Daraja: <span id="u-lvl">1</span></p>
    </div>
    <div class="glass-card">
        <h3>Hamyon: <span style="font-size:12px; color:var(--p)">Bog'lanmagan</span></h3>
        <button class="btn-buy" style="background:#0088cc; color:#fff" onclick="connectWallet()">TON WALLET ULASH</button>
    </div>
    <div class="glass-card" style="border-left:5px solid var(--p);">
        <h3>Airdrop Shartlari</h3>
        <p style="font-size:12px; opacity:0.7;">- 5-daraja robotga ega bo'lish<br>- Kunlik o'yinlarni o'ynash<br>- Hamyonni bog'lash</p>
    </div>
</div>

<div id="game-screen">
    <h2 id="game-title">O'yin Nomlanishi</h2>
    <div id="game-timer">60</div>
    <div id="game-arena" style="width:100%; height:300px; background:var(--glass); border-radius:20px;"></div>
    <p style="margin-top:20px;">Yutish uchun barcha amallarni bajaring!</p>
</div>

<audio id="snd-tap" src="https://www.soundjay.com/buttons/sounds/button-16.mp3"></audio>
<audio id="snd-win" src="https://www.soundjay.com/misc/sounds/bell-ringing-05.mp3"></audio>

<script>
// --- FIREBASE & STATE ---
const firebaseConfig = { databaseURL: "https://Sizning-Baza-URL.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let s = {
    id: window.Telegram.WebApp.initDataUnsafe?.user?.id || "local_dev",
    name: window.Telegram.WebApp.initDataUnsafe?.user?.first_name || "O'yinchi",
    c: 0, d: 0, e: 5000, lvl: 1, robPower: 0, lang: 'uz',
    lastExit: Date.now(),
    gamesDone: { '2048': false, 'memory': false, 'sort': false }
};

// --- CORE LOGIC ---
window.onload = () => {
    loadData();
    tg.expand();
};

function handleTap(e) {
    if(s.e > 0) {
        let p = s.lvl * 1;
        s.c += p; s.e -= 1;
        document.getElementById('snd-tap').play();
        createTapAnim(e, p);
        updateUI();
    } else {
        runAd('energy');
    }
}

// OFFLINE MINING (O'yindan chiqqanda ishlash)
function calculateOfflineMining() {
    let now = Date.now();
    let diffInHours = (now - s.lastExit) / 3600000;
    let earned = diffInHours * s.robPower;
    if(earned > 0) {
        s.c += earned;
        alert(`Siz yo'qligingizda robotlar ${Math.floor(earned)} üìÄ yig'ishdi!`);
    }
}

// MINI GAMES SYSTEM
function checkGameLimit(type) {
    if(s.gamesDone[type]) {
        alert("Bu o'yinni bugun o'ynab bo'ldingiz! Ertaga qaytib keling.");
    } else {
        runAd('start_game').then(() => startGame(type));
    }
}

function startGame(type) {
    document.getElementById('game-screen').style.display = 'flex';
    let timer = 60;
    const interval = setInterval(() => {
        timer--;
        document.getElementById('game-timer').innerText = timer;
        if(timer <= 0) {
            clearInterval(interval);
            finishGame(type);
        }
    }, 1000);
}

function finishGame(type) {
    s.c += 25000; s.d += 25;
    s.gamesDone[type] = true;
    document.getElementById('snd-win').play();
    document.getElementById('game-screen').style.display = 'none';
    alert("TABRIKLAYMIZ! 25,000 üìÄ va 25 üíé yutdingiz!");
    updateUI();
    saveData();
}

// --- UTILS ---
function updateUI() {
    document.getElementById('bal-top').innerText = Math.floor(s.c).toLocaleString();
    document.getElementById('tap-val').innerText = `TAP POWER: ${s.lvl}`;
    document.getElementById('st-en').innerText = s.e;
    document.getElementById('rob-power').innerText = s.robPower;
    document.getElementById('lvl-fill').style.width = (s.c % 10000) / 100 + "%";
}

function createTapAnim(e, p) {
    let d = document.createElement('div');
    d.innerText = `+${p}`;
    d.style.cssText = `position:fixed; left:${e.clientX}px; top:${e.clientY}px; font-weight:900; color:var(--neon); animation: flyUp 0.8s forwards; pointer-events:none; z-index:9999;`;
    document.body.appendChild(d);
    setTimeout(() => d.remove(), 800);
}

function openP(id, ad = false) {
    if(ad) runAd('page_transition');
    document.getElementById(id).style.display = 'block';
}

function closeP(id) { document.getElementById(id).style.display = 'none'; }
function closeAll() { document.querySelectorAll('.page').forEach(p => p.style.display = 'none'); }

function runAd(type) {
    if(typeof show_10558007 === 'function') return show_10558007();
    return Promise.resolve();
}

// --- PERSISTENCE ---
function saveData() {
    s.lastExit = Date.now();
    db.ref('users/' + s.id).set(s);
}

function loadData() {
    db.ref('users/' + s.id).once('value').then((snap) => {
        if(snap.exists()) {
            s = snap.val();
            calculateOfflineMining();
        }
        document.getElementById('loader').style.display = 'none';
        updateUI();
    });
}

setInterval(saveData, 10000); // Har 10 soniyada saqlash
setInterval(() => { if(s.e < 5000) s.e += 5; updateUI(); }, 2000);
</script>

<style> @keyframes flyUp { to { transform: translateY(-120px); opacity: 0; } } </style>
</body>
                                                    </html>
    
        
    
    
    
        
            
        
                                               
    
            
        
        
    
        
    
    
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

