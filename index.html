<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga - Final Edition</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://alwingulla.com/88/tag.min.js" data-zone="10558007" async></script>
    
    <style>
        :root { --bg: #0b111d; --card: #1a2332; --accent: #f1c40f; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; text-align: center; user-select: none; }
        
        .top-stats { display: flex; justify-content: space-around; padding: 10px; gap: 5px; }
        .stat-box { background: var(--card); border: 1px solid #2c3e50; border-radius: 10px; padding: 8px; flex: 1; font-size: 12px; }
        .stat-box b { color: var(--accent); display: block; }

        .score-display { font-size: 55px; font-weight: bold; margin: 15px 0 0; }
        .diam-text { color: #3498db; margin-bottom: 15px; display: block; }

        .tanga-btn { 
            width: 240px; height: 240px; border-radius: 50%; margin: 0 auto;
            display: flex; align-items: center; justify-content: center;
            font-size: 80px; border: 10px solid rgba(255,255,255,0.1);
            cursor: pointer; transition: 0.1s; box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        .tanga-btn:active { transform: scale(0.92); }

        /* Energiya Bar */
        .energy-cont { width: 85%; margin: 25px auto; }
        .bar-bg { width: 100%; height: 12px; background: #1a2332; border-radius: 10px; overflow: hidden; margin-top: 5px; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, #f1c40f, #e67e22); transition: 0.3s; }

        /* Modallar */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 1000; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .active { display: block; }
        .card { background: var(--card); border-radius: 15px; padding: 15px; margin-bottom: 12px; border: 1px solid #34495e; text-align: left; position: relative; }
        .btn-action { background: var(--accent); color: black; border: none; padding: 12px; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; margin-top: 10px; }

        /* Navigatsiya */
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #0a0e17; padding: 10px 0; border-top: 1px solid #1a2533; }
        .nav-item { flex: 1; font-size: 10px; color: #888; cursor: pointer; }
        .nav-item i { display: block; font-size: 20px; margin-bottom: 3px; }
    </style>
</head>
<body>

<audio id="bgMusic" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"></audio>

<div id="game-ui">
    <div class="top-stats">
        <div class="stat-box">SOATIGA <b id="h-val">0</b></div>
        <div class="stat-box">TAP KUCHI <b id="p-val">1</b></div>
        <div class="stat-box">ENERGY <b id="e-val">500</b></div>
    </div>

    <div class="score-display" id="score">0</div>
    <span class="diam-text">üíé <span id="d-val">0</span></span>

    <div class="tanga-btn" id="tanga" onclick="tap(event)">üí∞</div>

    <div class="energy-cont">
        <div style="font-size: 12px;">‚ö° <span id="e-now">500</span> / <span id="e-max">500</span></div>
        <div class="bar-bg"><div id="e-fill" class="bar-fill"></div></div>
    </div>
</div>

<div id="market-modal" class="modal">
    <h2>üõí Market</h2>
    <div class="card">1,000 Tanga = 1 Olmos üíé<button class="btn-action" onclick="exchange()">ALMASHTIRISH (1000)</button></div>
    <button class="btn-action" style="background:#333; color:white" onclick="closeAll()">YOPISH</button>
</div>

<div id="leader-modal" class="modal">
    <h2>üìä Leaderboard</h2>
    <div id="leader-list"></div>
    <button class="btn-action" style="background:#333; color:white" onclick="closeAll()">YOPISH</button>
</div>

<div id="booster-modal" class="modal">
    <h2>‚ö° Boosterlar</h2>
    <div class="card">Tap Kuchi (+1) <br> Narxi: <span id="p-cost">500</span> <button class="btn-action" onclick="buy('p')">LEVEL UP</button></div>
    <div class="card">Soatbay Foyda (+100) <br> Narxi: <span id="h-cost">1000</span> <button class="btn-action" onclick="buy('h')">LEVEL UP</button></div>
    <button class="btn-action" style="background:#333; color:white" onclick="closeAll()">YOPISH</button>
</div>

<div id="home-modal" class="modal">
    <h2>üè† Mening Uyim</h2>
    <div class="card">Ism: <b id="u-name">...</b><br>ID: <b id="u-id">...</b></div>
    <div class="card">üí∞ Jami: <span id="u-c">0</span><br>üíé Olmos: <span id="u-d">0</span></div>
    <button class="btn-action" onclick="openM('ref')">DO'STLARNI TAKLIF QILISH</button>
    <button class="btn-action" style="background:#333; color:white" onclick="closeAll()">YOPISH</button>
</div>

<div id="ref-modal" class="modal">
    <h2>üë• Referal</h2>
    <div class="card">Har bir do'st uchun: <b>25,000 üí∞</b></div>
    <div class="card" id="ref-link" style="word-break:break-all; font-size:12px;">...</div>
    <button class="btn-action" onclick="copyRef()">NUSXALASH</button>
    <button class="btn-action" style="background:#333; color:white" onclick="closeAll()">YOPISH</button>
</div>

<div id="bonus-modal" class="modal">
    <h2>üéÅ Bonus & Omad</h2>
    <div class="card">Kunlik Bonus <button class="btn-action" onclick="getDaily()">5,000 üí∞ OLISH</button></div>
    <div class="card">Tasodifiy Tanga (Reklama) <button class="btn-action" style="background:#e67e22" onclick="spin()">REKLAMA KO'RISH</button></div>
    <button class="btn-action" style="background:#333; color:white" onclick="closeAll()">YOPISH</button>
</div>

<nav class="nav">
    <div class="nav-item" onclick="openM('market')"><i>üõí</i>MARKET</div>
    <div class="nav-item" onclick="openM('leader')"><i>üìä</i>REYTING</div>
    <div class="nav-item" onclick="openM('bonus')"><i>üéÅ</i>BONUS</div>
    <div class="nav-item" onclick="openM('booster')"><i>‚ö°</i>BOOSTER</div>
    <div class="nav-item" onclick="openM('home')"><i>üè†</i>UYIM</div>
</nav>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDbttlr-oGJeDbjMbrubcuspgg9gk-7Gxs",
        databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com",
        projectId: "oltin-tanga-d2c80",
        appId: "1:954210050924:web:f57b75568c66216c49c949"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const tg = window.Telegram.WebApp;
    const user = tg.initDataUnsafe.user || { id: "8009403510", first_name: "Admin" };

    let s = { coins: 0, diams: 0, power: 1, hourly: 0, energy: 500, maxE: 500, lastSeen: Date.now() };

    function init() {
        tg.expand();
        db.ref('users/' + user.id).once('value', (snap) => {
            if(snap.exists()) {
                let d = snap.val();
                let earned = (d.hourly / 3600) * ((Date.now() - d.lastSeen)/1000);
                if(earned > 5) alert("Siz yo'qligingizda " + Math.floor(earned) + " üí∞ yig'ildi!");
                s = {...s, ...d, coins: (d.coins || 0) + earned};
            }
            updateUI();
        });

        setInterval(() => {
            s.coins += (s.hourly / 3600);
            if(s.energy < s.maxE) s.energy += 0.5;
            updateUI();
        }, 1000);
        setInterval(saveData, 10000);
    }

    function tap(e) {
        document.getElementById('bgMusic').play().catch(()=>{});
        if(s.energy >= s.power) {
            s.coins += s.power; s.energy -= s.power;
            updateUI();
        }
    }

    function updateUI() {
        let c = Math.floor(s.coins);
        document.getElementById('score').innerText = c.toLocaleString();
        document.getElementById('h-val').innerText = s.hourly;
        document.getElementById('p-val').innerText = s.power;
        document.getElementById('d-val').innerText = s.diams;
        document.getElementById('e-now').innerText = Math.floor(s.energy);
        document.getElementById('e-max').innerText = s.maxE;
        document.getElementById('e-fill').style.width = (s.energy/s.maxE*100) + "%";
        
        document.getElementById('u-name').innerText = user.first_name;
        document.getElementById('u-id').innerText = user.id;
        document.getElementById('u-c').innerText = c.toLocaleString();
        document.getElementById('u-d').innerText = s.diams;
        document.getElementById('ref-link').innerText = "https://t.me/OltinTanga1_bot?start=" + user.id;

        // Tanga rangini o'zgartirish
        let t = document.getElementById('tanga');
        t.style.background = "radial-gradient(circle, #f1c40f, #d4ac0d)"; // Gold
        if(c >= 5000000) t.style.background = "radial-gradient(circle, #2c3e50, #000000)"; // Black
        else if(c >= 1000000) t.style.background = "radial-gradient(circle, #9b59b6, #8e44ad)"; // Purple
        else if(c >= 500000) t.style.background = "radial-gradient(circle, #3498db, #2980b9)"; // Blue
        else if(c >= 100000) t.style.background = "radial-gradient(circle, #2ecc71, #27ae60)"; // Green
        else if(c >= 50000) t.style.background = "radial-gradient(circle, #e74c3c, #c0392b)"; // Red
    }

    function buy(type) {
        if(type === 'p' && s.coins >= 500) { s.coins -= 500; s.power += 1; }
        if(type === 'h' && s.coins >= 1000) { s.coins -= 1000; s.hourly += 100; }
        saveData(); updateUI();
    }

    function exchange() {
        if(s.coins >= 1000) { s.coins -= 1000; s.diams += 1; saveData(); updateUI(); }
    }

    function spin() {
        if(window.show_10558007) {
            window.show_10558007().then(() => {
                let win = Math.floor(Math.random() * 10000);
                s.coins += win; alert("Yutuq: " + win + " üí∞"); saveData(); updateUI();
            });
        }
    }

    function getDaily() { s.coins += 5000; alert("5000 tanga qo'shildi!"); saveData(); updateUI(); }
    function copyRef() { navigator.clipboard.writeText(document.getElementById('ref-link').innerText); alert("Nusxalandi!"); }

    function openM(id) { 
        document.getElementById(id + '-modal').classList.add('active'); 
        if(id === 'leader') loadLeader();
    }
    function closeAll() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('active')); }

    function loadLeader() {
        db.ref('users').orderByChild('coins').limitToLast(10).once('value', (snap) => {
            let list = ""; let i = 1;
            snap.forEach(c => {
                let u = c.val();
                let highlight = c.key == user.id ? "border: 2px solid gold;" : "";
                list = `<div class="card" style="${highlight}">${i}. ${u.name || 'User'}: ${Math.floor(u.coins)}</div>` + list;
                i++;
            });
            document.getElementById('leader-list').innerHTML = list;
        });
    }

    function saveData() {
        db.ref('users/' + user.id).update({...s, name: user.first_name, lastSeen: Date.now()});
    }

    init();
</script>
</body>
                                                                          </html>
    
            
            
        
    
    
                                        
                                                                                 </html>

    
    
    
                                                                                              

        

    
                                                           </html>
            
                                                      
                

