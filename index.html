<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga Platinum</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="//libtl.com/sdk.js" data-zone="10558007" data-sdk="show_10558007"></script>

    <style>
        :root {
            --gold: #ffd700; --bg: #07090f; --card: #161a2e; 
            --cyan: #00f2fe; --purple: #7d5fff; --ruby: #ff4757;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', Roboto, sans-serif; }
        body { margin: 0; background: var(--bg); color: white; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }

        /* Header & Stats */
        .air-banner { background: linear-gradient(90deg, #6c5ce7, #a29bfe); padding: 8px; text-align: center; font-weight: bold; font-size: 12px; }
        .top-nav { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 10px; }
        .stat-card { background: var(--card); padding: 8px; border-radius: 12px; text-align: center; border: 1px solid #2d3436; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .stat-card small { font-size: 10px; color: #aaa; display: block; }
        .stat-card b { color: var(--gold); font-size: 13px; }

        /* Level Progress */
        .level-box { padding: 0 15px; margin-top: 5px; }
        .lvl-header { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 4px; color: var(--cyan); font-weight: bold; }
        .lvl-bar { width: 100%; height: 8px; background: #1e272e; border-radius: 10px; overflow: hidden; }
        #lvl-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #00f2fe, #7d5fff); transition: 0.8s ease; }

        /* Main Game */
        .game-area { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .main-balance { font-size: 52px; font-weight: 900; color: var(--gold); text-shadow: 0 0 20px rgba(255,215,0,0.3); margin: 0; }
        .coin-btn { width: 230px; height: 230px; position: relative; cursor: pointer; transition: transform 0.1s; }
        .coin-btn:active { transform: scale(0.92); }
        .coin-circle { 
            width: 100%; height: 100%; border-radius: 50%; 
            background: radial-gradient(circle, #ffe066 0%, #cc8e00 100%);
            border: 8px solid #8a6200; display: flex; align-items: center; justify-content: center; font-size: 90px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        }

        /* Navigation */
        .nav-bar { width: 100%; background: #0f111a; display: flex; padding: 10px 0; border-top: 1px solid #2d3436; }
        .nav-item { flex: 1; text-align: center; font-size: 10px; color: #636e72; cursor: pointer; }
        .nav-item i { font-size: 24px; display: block; margin-bottom: 4px; font-style: normal; }
        .nav-item.active { color: var(--gold); }

        /* Pages */
        .page { position: fixed; inset: 0; background: var(--bg); z-index: 2000; padding: 20px; display: none; overflow-y: auto; padding-bottom: 110px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; margin-bottom: 20px; padding-bottom: 10px; }
        .card-item { background: var(--card); border-radius: 15px; padding: 15px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; border: 1px solid #2d3436; }
        
        /* Birja Box */
        .ex-box { background: var(--card); padding: 20px; border-radius: 20px; border: 1px solid var(--purple); margin-top: 10px; }
        .ex-input { width: 100%; padding: 15px; background: #000; border: 1px solid #333; border-radius: 12px; color: white; font-size: 18px; text-align: center; margin: 10px 0; }
        .ex-btn { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: 800; cursor: pointer; font-size: 16px; }

        #toast { position: fixed; top: 30px; left: 50%; transform: translateX(-50%); background: #fff; color: #000; padding: 12px 25px; border-radius: 30px; font-weight: bold; z-index: 10000; display: none; }
    </style>
</head>
<body>

<audio id="snd-drop" src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" preload="auto"></audio>

<div id="toast"></div>
<div class="air-banner" id="air-timer">Airdrop yuklanmoqda...</div>

<div class="top-nav">
    <div class="stat-card"><small>ğŸ“€ PPH</small><b id="st-pph">0</b></div>
    <div class="stat-card"><small>ğŸ’ Olmos</small><b id="st-diam">0</b></div>
    <div class="stat-card"><small>âš¡ Energiya</small><b id="st-en">1000</b></div>
</div>

<div class="level-box">
    <div class="lvl-header"><span id="lvl-name">...</span> <span id="lvl-num">LVL 1/15</span></div>
    <div class="lvl-bar"><div id="lvl-fill"></div></div>
</div>

<div class="game-area">
    <h1 class="main-balance" id="main-bal">0</h1>
    <div class="coin-btn" onclick="tap(event)">
        <div class="coin-circle" id="main-coin">ğŸ“€</div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item" onclick="openP('p-cards', true)"><i>ğŸƒ</i>Magazin</div>
    <div class="nav-item" onclick="openP('p-bonus', true)"><i>ğŸ</i>Bonus</div>
    <div class="nav-item" onclick="openP('p-exchange', false)"><i>ğŸ’±</i>Birja</div>
    <div class="nav-item" onclick="openP('p-rank', false)"><i>ğŸ†</i>Reyting</div>
    <div class="nav-item" onclick="openP('p-profile', true)"><i>ğŸ‘¤</i>Profil</div>
</div>

<div id="p-cards" class="page">
    <div class="page-header"><h2>Mining Magazini</h2><h2 onclick="closeP('p-cards')">âœ–</h2></div>
    <div id="cards-container"></div>
</div>

<div id="p-bonus" class="page">
    <div class="page-header"><h2>Bonuslar</h2><h2 onclick="closeP('p-bonus')">âœ–</h2></div>
    <div class="card-item" style="flex-direction:column; text-align:center;">
        <h3>Super Tap ğŸ”¥</h3>
        <p>30 soniya davomida Tap kuchi 100 bo'ladi!</p>
        <button id="btn-supertap" style="width:100%; background:var(--ruby); padding:15px; border-radius:12px; border:none; font-weight:bold; color:white;" onclick="startSuper()">Hozir Yoqish ğŸ¬</button>
    </div>
</div>

<div id="p-exchange" class="page">
    <div class="page-header"><h2>Birja ğŸ’±</h2><h2 onclick="closeP('p-exchange')">âœ–</h2></div>
    <div class="ex-box">
        <h4 style="text-align:center; margin:0;">ğŸ“€ â” ğŸ’ (10,000 : 1)</h4>
        <input type="number" id="ex-diam" class="ex-input" placeholder="Olmos miqdori">
        <button class="ex-btn" style="background:var(--gold);" onclick="doEx(true)">Almashtirish</button>
        <hr style="margin:20px 0; border:0; border-top:1px solid #333;">
        <h4 style="text-align:center; margin:0;">ğŸ’ â” ğŸ“€ (1 : 8,000)</h4>
        <input type="number" id="ex-coin" class="ex-input" placeholder="Tanga miqdori">
        <button class="ex-btn" style="background:var(--cyan); color:#000;" onclick="doEx(false)">Almashtirish</button>
    </div>
</div>

<div id="p-rank" class="page">
    <div class="page-header"><h2>Global Top 50</h2><h2 onclick="closeP('p-rank')">âœ–</h2></div>
    <div id="rank-list"></div>
</div>

<div id="p-profile" class="page">
    <div class="page-header"><h2>Profil</h2><h2 onclick="closeP('p-profile')">âœ–</h2></div>
    <div class="card-item" style="flex-direction:column; align-items:flex-start; gap:8px;">
        <div>ğŸ‘¤ Ism: <b id="pr-name">...</b></div>
        <div>ğŸ†” ID: <b id="pr-id">...</b></div>
        <div>ğŸ“€ Tangalar: <b id="pr-c">0</b></div>
        <div>ğŸ’ Olmoslar: <b id="pr-d">0</b></div>
        <div>ğŸ† Daraja: <b id="pr-lvl">1/15</b></div>
    </div>
    <div id="ton-connect-button" style="display:flex; justify-content:center; margin-top:20px;"></div>
</div>

<script>
const tg = window.Telegram.WebApp;
const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const user = tg.initDataUnsafe?.user || { id: "000000", first_name: "O'yinchi" };

let s = { c: 0, d: 0, pph: 0, dpph: 0, e: 1000, maxE: 1000, tap: 1, lvl: 1, items: {} };
let isSuper = false;

const lvls = [0, 10000, 100000, 1000000, 10000000, 50000000, 200000000, 1000000000, 5000000000, 20000000000, 100000000000, 500000000000, 1000000000000, 5000000000000, 10000000000000];
const lvlNames = ["Yangi", "Havaskor", "Ishchi", "Usta", "Katta Usta", "Menejer", "Direktor", "Boy", "Millioner", "Milliarder", "Trillioner", "Qirol", "Imperator", "Xudo", "Tanga Egasi"];
const cardData = [
    {id:1, n:"Ketmon", p:1000, pr:50, col:"#55efc4"}, {id:2, n:"Kurak", p:5000, pr:250, col:"#81ecec"},
    {id:3, n:"Araba", p:25000, pr:1200, col:"#74b9ff"}, {id:4, n:"Zavod", p:150000, pr:8000, col:"#fab1a0"},
    {id:5, n:"Ombor", p:800000, pr:45000, col:"#fdcb6e"}, {id:6, n:"Bank", p:4000000, pr:250000, col:"#ff7675"}
];

function init() {
    db.ref('users/' + user.id).on('value', snap => {
        const val = snap.val();
        if(val) {
            s = { ...s, ...val };
            s.c = Number(s.c) || 0;
            s.d = Number(s.d) || 0;
            s.e = Number(s.e) || 1000;
        }
        updateUI();
        renderCards();
    });
    new TON_CONNECT_UI.TonConnectUI({ manifestUrl: 'https://ganiyevdiyorbek700-dotcom.github.io/Oltin-Tanga-/tonconnect-manifest.json', buttonRootId: 'ton-connect-button' });
    startAirdropTimer();
    tg.expand();
}

function updateUI() {
    document.getElementById('main-bal').innerText = Math.floor(s.c).toLocaleString();
    document.getElementById('st-pph').innerText = Math.floor(s.pph).toLocaleString();
    document.getElementById('st-diam').innerText = Math.floor(s.d).toLocaleString();
    document.getElementById('st-en').innerText = Math.floor(s.e);

    let ci = 0; lvls.forEach((v, i) => { if(s.c >= v) ci = i; });
    s.lvl = ci + 1;
    document.getElementById('lvl-name').innerText = lvlNames[ci];
    document.getElementById('lvl-num').innerText = `LVL ${s.lvl}/15`;
    let nextVal = lvls[ci+1] || s.c;
    document.getElementById('lvl-fill').style.width = Math.min(100, ((s.c-lvls[ci])/(nextVal-lvls[ci])*100)) + "%";

    document.getElementById('pr-name').innerText = user.first_name;
    document.getElementById('pr-id').innerText = user.id;
    document.getElementById('pr-c').innerText = Math.floor(s.c).toLocaleString();
    document.getElementById('pr-d').innerText = Math.floor(s.d).toLocaleString();
    document.getElementById('pr-lvl').innerText = s.lvl + "/15";
}

function tap(e) {
    let power = isSuper ? 100 : s.tap;
    if(s.e >= (isSuper ? 1 : power)) {
        s.c += power; if(!isSuper) s.e -= power;
        playDrop();
        updateUI();
    } else {
        notify("Energiya tugadi!");
        runAd(() => { s.e = s.maxE; updateUI(); save(); });
    }
}

function playDrop() {
    const audio = document.getElementById('snd-drop');
    audio.currentTime = 0;
    audio.play();
}

function startSuper() {
    runAd(() => {
        isSuper = true;
        notify("SUPER TAP AKTIV! ğŸ”¥");
        document.getElementById('main-coin').style.boxShadow = "0 0 40px var(--ruby)";
        setTimeout(() => {
            isSuper = false;
            document.getElementById('main-coin').style.boxShadow = "none";
            notify("Super Tap tugadi.");
        }, 30000);
    });
}

function renderCards() {
    let h = '';
    cardData.forEach(c => {
        let bought = s.items && s.items[c.id];
        h += `<div class="card-item" style="border-left: 5px solid ${c.col}">
            <div><b>${c.n}</b><br><small>+${c.pr}/s foyda</small></div>
            <button style="background:var(--gold); border:none; padding:10px 15px; border-radius:10px; font-weight:bold; color:black;" 
                onclick="buyCard(${c.id}, '${c.col}')" ${bought?'disabled':''}>
                ${bought ? 'MAX' : c.p.toLocaleString()}
            </button>
        </div>`;
    });
    document.getElementById('cards-container').innerHTML = h;
}

function buyCard(id, color) {
    let c = cardData.find(x => x.id === id);
    if(s.c >= c.p) {
        s.c -= c.p; if(!s.items) s.items = {}; s.items[id] = true;
        s.pph += c.pr;
        document.getElementById('main-coin').style.background = `radial-gradient(circle, #fff, ${color})`;
        notify("Karta sotib olindi!");
        save();
    } else notify("Mablag' yetarli emas!");
}

function doEx(toDiam) {
    if(toDiam) {
        let amt = parseInt(document.getElementById('ex-diam').value);
        if(amt > 0 && s.c >= amt*10000) { s.c -= amt*10000; s.d += amt; notify("Muvaffaqiyatli! ğŸ’"); save(); }
        else notify("Tanga yetarli emas!");
    } else {
        let amt = parseInt(document.getElementById('ex-coin').value);
        let cost = Math.ceil(amt/8000);
        if(amt > 0 && s.d >= cost) { s.d -= cost; s.c += amt; notify("Muvaffaqiyatli! ğŸ“€"); save(); }
        else notify("Olmos yetarli emas!");
    }
}

function loadRank() {
    db.ref('users').orderByChild('c').limitToLast(50).once('value', snap => {
        let list = []; snap.forEach(u => list.push(u.val())); list.reverse();
        let h = '';
        list.forEach((u, i) => {
            h += `<div class="card-item">
                <span>#${i+1} <b>${u.first_name || 'Player'}</b></span>
                <span style="color:var(--gold)">${Math.floor(Number(u.c)||0).toLocaleString()} ğŸ“€</span>
            </div>`;
        });
        document.getElementById('rank-list').innerHTML = h;
    });
}

function save() { db.ref('users/' + user.id).update(s); }
function openP(id, ad) { if(ad) runAd(() => { if(id=='p-rank') loadRank(); document.getElementById(id).style.display='block'; }); else { if(id=='p-rank') loadRank(); document.getElementById(id).style.display='block'; } }
function closeP(id) { document.getElementById(id).style.display='none'; }
function notify(m) { let t=document.getElementById('toast'); t.innerText=m; t.style.display='block'; setTimeout(()=>t.style.display='none', 2500); }
function runAd(cb) { if(typeof show_10558007 === 'function') show_10558007().then(cb).catch(cb); else cb(); }

function startAirdropTimer() {
    const target = new Date().getTime() + (99 * 24 * 60 * 60 * 1000);
    setInterval(() => {
        let diff = target - new Date().getTime();
        let d=Math.floor(diff/86400000), h=Math.floor((diff%86400000)/3600000), m=Math.floor((diff%3600000)/60000), sec=Math.floor((diff%60000)/1000);
        document.getElementById('air-timer').innerText = `${d}k ${h}s ${m}m ${sec}s Airdrop Countdown`;
    }, 1000);
}

setInterval(() => { s.c += (s.pph/3600); s.e = Math.min(s.maxE, s.e + 1.5); updateUI(); }, 1000);
setInterval(save, 30000);
init();
</script>
</body>
    </html>
    
            
        
        
    
        
    
    
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

