<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga: Infinity Evolution</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="//libtl.com/sdk.js" data-zone="10558007" data-sdk="show_10558007"></script>

    <style>
        :root { --p: #fbc531; --s: #4cd137; --err: #ff4757; --bg: #0a0e17; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Poppins', sans-serif; margin: 0; padding: 0; }
        body { background: var(--bg); color: white; height: 100vh; overflow: hidden; transition: 0.8s; background-size: cover; background-position: center; }

        /* KARTALAR ORQALI O'ZGARUVCHI FONLAR */
        .theme-0 { background-image: radial-gradient(circle, #2c3e50, #000); }
        .theme-1 { background-image: url('https://images.unsplash.com/photo-1500382017468-9049fed747ef?q=80&w=1000'); } /* Suvli */
        .theme-2 { background-image: url('https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1000'); } /* Tog'li */
        .theme-3 { background-image: url('https://images.unsplash.com/photo-1464822759023-fed622ff2c3b?q=80&w=1000'); } /* Olovli */

        /* UI */
        .header { padding: 15px; display: flex; justify-content: space-between; background: rgba(0,0,0,0.6); backdrop-filter: blur(10px); z-index: 10; position: relative; }
        .stat { background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 8px; font-size: 12px; border: 1px solid rgba(255,255,255,0.1); }

        /* LEVEL BAR */
        .lvl-container { width: 90%; height: 8px; background: #222; margin: 10px auto; border-radius: 10px; overflow: hidden; border: 1px solid #333; }
        #lvl-fill { height: 100%; background: linear-gradient(90deg, var(--p), var(--s)); width: 0%; transition: 0.3s; }

        /* MAIN */
        .main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 65vh; }
        .bal { font-size: 50px; font-weight: 900; color: var(--p); text-shadow: 0 0 20px rgba(0,0,0,0.5); }
        
        /* EVOLYUTSIYA */
        .char-circle { width: 260px; height: 260px; border-radius: 50%; border: 10px solid var(--p); background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; font-size: 110px; cursor: pointer; transition: 0.1s; box-shadow: 0 0 40px rgba(251,197,49,0.3); position: relative; }
        .char-circle:active { transform: scale(0.95); }

        /* NAVIGATION */
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #05080f; padding: 15px 0; border-top: 1px solid #222; z-index: 100; }
        .nav-item { flex: 1; text-align: center; font-size: 10px; color: #7f8fa6; }
        .nav-item i { font-size: 24px; display: block; margin-bottom: 5px; font-style: normal; }
        .nav-item.active { color: var(--p); }

        /* PAGES */
        .page { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: none; padding: 20px; overflow-y: auto; padding-bottom: 100px; }
        .card { background: rgba(255,255,255,0.05); border-radius: 20px; padding: 15px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); }
        .btn { width: 100%; padding: 12px; border-radius: 15px; border: none; font-weight: bold; margin-top: 10px; }

        /* RUNNER GAME (Subway style) */
        #game-canvas { background: #111; width: 100%; height: 350px; border-radius: 20px; border: 3px solid var(--p); display: none; position: relative; overflow: hidden; }
        .player { width: 40px; height: 40px; background: orange; position: absolute; bottom: 20px; transition: 0.2s; border-radius: 5px; }
        .item { position: absolute; font-size: 25px; }

        /* NOTIFICATION */
        #notif { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 12px 30px; border-radius: 50px; font-weight: bold; z-index: 10000; display: none; }

        /* CHEST ANIMATION */
        @keyframes shake { 0%, 100% { transform: rotate(0); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } }
        .chest-anim { font-size: 80px; animation: shake 0.5s infinite; cursor: pointer; display: inline-block; }
    </style>
</head>
<body class="theme-0">

<div id="notif"></div>

<div class="header">
    <div class="stat">ğŸ“€ <b id="st-pph">0</b>/s</div>
    <div class="stat">ğŸ¤– Robot: <b id="st-rob">0</b></div>
    <div class="stat">ğŸ’ <b id="st-dph">0</b>/s</div>
</div>

<div class="lvl-container"><div id="lvl-fill"></div></div>

<div class="main">
    <h1 class="bal" id="st-bal">0</h1>
    <div style="color:var(--p); margin-bottom:15px;">ğŸ’ <span id="st-diam">0</span></div>
    
    <div class="char-circle" onclick="handleTap(event)">
        <span id="char-img">ğŸ‘¶</span>
    </div>

    <div style="margin-top: 30px;">
        <div class="stat" style="padding: 10px 30px; border: 1px solid var(--p);">âš¡ <span id="st-en">5000</span> / 5000</div>
    </div>
</div>

<div class="nav">
    <div class="nav-item" onclick="openPage('p-shop')"><i>ğŸƒ</i>Kartalar</div>
    <div class="nav-item" onclick="openPage('p-bonus')"><i>ğŸ</i>Bonus</div>
    <div class="nav-item" onclick="openPage('p-games')"><i>ğŸ®</i>O'yinlar</div>
    <div class="nav-item" onclick="openPage('p-rank')"><i>ğŸ†</i>Reyting</div>
    <div class="nav-item" onclick="openPage('p-prof')"><i>ğŸ‘¤</i>Profil</div>
</div>

<div id="p-shop" class="page">
    <div style="display:flex; justify-content:space-between"><h2>Interfeys Kartalari</h2> <h2 onclick="closePage('p-shop')">âœ•</h2></div>
    <p style="font-size:12px; opacity:0.6; margin-bottom:15px;">Har bir karta menyu ko'rinishini butunlay o'zgartiradi!</p>
    <div id="shop-list"></div>
    <h2 style="margin:20px 0;">Robotlar (Offline Mining)</h2>
    <div id="robot-list"></div>
</div>

<div id="p-bonus" class="page">
    <div style="display:flex; justify-content:space-between"><h2>Haftalik Bonuslar</h2> <h2 onclick="closePage('p-bonus')">âœ•</h2></div>
    <div class="card">
        <h3>ğŸ”¥ Super Tap (10x)</h3>
        <p id="t-super">Tayyor</p>
        <button class="btn" style="background:var(--p)" onclick="startAd('super')">Reklama Ko'rish</button>
    </div>
    <div class="card" style="text-align:center;">
        <h3>ğŸ“¦ Omadli Sandiq</h3>
        <p id="t-chest">Tayyor</p>
        <div id="chest-ui" style="margin:20px 0; display:none;">
            <div class="chest-anim" onclick="openChest()">ğŸ</div>
        </div>
        <button id="btn-chest" class="btn" style="background:var(--s)" onclick="startAd('chest')">Reklama Ko'rish</button>
    </div>
</div>

<div id="p-games" class="page">
    <div style="display:flex; justify-content:space-between"><h2>Mini O'yinlar</h2> <h2 onclick="closePage('p-games')">âœ•</h2></div>
    
    <div class="card" onclick="startAd('runner')">ğŸƒâ€â™‚ï¸ <b>Tanga Yuguruvchi (Subway)</b><p>Yoldagi tangalarni yig'ing!</p></div>
    <div id="game-canvas">
        <div id="player" class="player"></div>
        <div id="score-ui" style="position:absolute; top:10px; left:10px; font-weight:bold;">Tanga: 0</div>
    </div>

    <div class="card" onclick="startAd('coinflip')">ğŸª™ <b>Coin Flip (3D)</b><p>Tikkan pulingizni 2 barobar qiling!</p></div>
</div>

<div id="p-coinflip" class="page">
    <div style="display:flex; justify-content:space-between"><h3>COIN FLIP</h3> <h2 onclick="closePage('p-coinflip')">âœ•</h2></div>
    <div id="coin-obj" style="width:120px; height:120px; background:var(--p); border-radius:50%; margin:40px auto; border:5px solid #8a6200; display:flex; align-items:center; justify-content:center; font-size:40px; transition: 1s cubic-bezier(.45,1.45,.8,1);">ğŸ“€</div>
    <div style="display:flex; gap:10px; margin-bottom:20px;">
        <button class="btn" id="side-1" style="background:#333;" onclick="selSide(1)">GERB</button>
        <button class="btn" id="side-2" style="background:#333;" onclick="selSide(2)">RAQAM</button>
    </div>
    <input type="number" id="flip-amt" value="100" min="100" max="10000" style="width:100%; padding:15px; background:#111; color:white; border:1px solid var(--p); border-radius:10px;">
    <button class="btn" style="background:var(--p); color:black;" onclick="flipNow()">AYLANTIRISH</button>
</div>

<div id="p-rank" class="page">
    <div style="display:flex; justify-content:space-between"><h2>Global Reyting ğŸ†</h2> <h2 onclick="closePage('p-rank')">âœ•</h2></div>
    <div id="rank-list"></div>
</div>

<div id="p-prof" class="page">
    <div style="display:flex; justify-content:space-between"><h2>Mening Profilim</h2> <h2 onclick="closePage('p-prof')">âœ•</h2></div>
    <div class="card" style="text-align:center;">
        <h2 id="u-name">Ism</h2>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:15px;">
            <div class="stat">ğŸ“€ <b id="u-c">0</b></div>
            <div class="stat">ğŸ’ <b id="u-d">0</b></div>
            <div class="stat">ğŸ† Lvl: <b id="u-lvl">1</b></div>
            <div class="stat">ğŸ¤– Rob: <b id="u-r">0</b></div>
        </div>
        <div id="ton-btn" style="margin-top:20px;"></div>
    </div>

    <div class="card" style="border:1px solid var(--s); background:rgba(76,209,55,0.05);">
        <h3 style="color:var(--s)">ğŸš€ Airdrop Yaqin</h3>
        <h2 id="air-timer">99 KUN 00:00:00</h2>
        <p style="font-size:11px; margin-top:10px; line-height:1.5; opacity:0.8; border:1px solid rgba(255,255,255,0.1); padding:10px; border-radius:10px;">
            O'yinchilar 100 kun davomida faol bo'lganlar, darajalarini oshirgan, kartalar sotib olgan, olmoslar yig'gan va hamyonini ulaganlar uchun o'yindagi umumiy faollikka qarab taymer tugagandan so'ng <b>TON</b> kriptovalyutasi hamyoniga tushiriladi. Faol bo'ling!
        </p>
    </div>
</div>

<script>
// --- KONFIGURATSIYA ---
const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tg = window.Telegram.WebApp;
const user = tg.initDataUnsafe?.user || { id: "7462622808", first_name: "O'yinchi" };

// O'YIN HOLATI
let s = { c:0, d:0, pph:0, dph:0, e:5000, tap:1, tab:1, cards:[], robots:{}, lastOff:Date.now(), lastS:0, lastC:0, wall:"" };

// DARAXT/BOLA (20 DARAXA)
const chars = ["ğŸ‘¶","ğŸ¼","ğŸ§’","ğŸ‘¦","ğŸ’","ğŸ§‘","ğŸ“","ğŸ‘”","ğŸ’¼","ğŸ¤µ","ğŸ ","ğŸš—","ğŸ¢","ğŸš","ğŸš¢","ğŸ°","ğŸ‘´","ğŸ‘¨â€ğŸ¦³","âš°ï¸","ğŸ‘¼"];

// 10 TA KARTA (FONLAR)
const themes = [
    { n: "Boshlang'ich", p:0, img:"theme-0" },
    { n: "Suvli Dunyo ğŸ’§", p:100000, img:"theme-1" },
    { n: "Tog'li Dunyo â›°", p:500000, img:"theme-2" },
    { n: "Olovli Dunyo ğŸ”¥", p:2000000, img:"theme-3" },
    { n: "Koinot ğŸŒŒ", p:10000000, img:"theme-4" },
    { n: "Neon Shahar ğŸŒƒ", p:50000000, img:"theme-5" },
    { n: "Oltin Saroy ğŸ°", p:250000000, img:"theme-6" },
    { n: "Kripto Zona â‚¿", p:1000000000, img:"theme-7" },
    { n: "Afsonaviy ğŸ‰", p:5000000000, img:"theme-8" },
    { n: "Cheksizlik â™¾", p:25000000000, img:"theme-9" }
];

// 10 TA ROBOT
const robots = [];
for(let i=1; i<=10; i++) robots.push({ id:i, n:"Robot v"+i, p:20000*i*i, c:5000*i, d:2*i });

function init() {
    db.ref('users/' + user.id).once('value', snap => {
        if(snap.val()) s = {...s, ...snap.val()};
        calculateOffline();
        updateUI();
        renderShop();
        renderRobots();
        setInterval(loop, 1000);
        setInterval(save, 15000);
    });
    const ton = new TON_CONNECT_UI.TonConnectUI({ manifestUrl: 'https://ganiyevdiyorbek700-dotcom.github.io/Oltin-Tanga-/tonconnect-manifest.json', buttonRootId: 'ton-btn' });
    tg.expand();
}

function calculateOffline() {
    let diff = Math.floor((Date.now() - s.lastOff) / 1000);
    if(diff > 60) {
        let rc=0, rd=0;
        Object.keys(s.robots).forEach(id => { rc += (robots[id-1].c/3600)*diff; rd += (robots[id-1].d/3600)*diff; });
        s.c += rc; s.d += rd;
        if(rc > 1) notify(`Robotlar siz yo'qligingizda ${Math.floor(rc)} yig'di!`, 'green');
    }
}

function loop() {
    s.c += (s.pph/3600);
    Object.keys(s.robots).forEach(id => { s.c += robots[id-1].c/3600; s.d += robots[id-1].d/3600; });
    if(s.e < 5000) s.e += 3;
    updateUI();
    updateTimers();
}

function handleTap(e) {
    if(s.e >= s.tap) {
        s.c += s.tap; s.e -= s.tap;
        // Daraja oshirish logikasi (20 ta daraja)
        let nextLvl = 50000 * Math.pow(4, s.tab-1); 
        if(s.c >= nextLvl && s.tab < 20) { s.tab++; notify("YANGI DARAJA!", 'green'); }
        updateUI(); createTapAnim(e);
    } else {
        startAd('energy');
    }
}

function updateUI() {
    document.getElementById('st-bal').innerText = Math.floor(s.c).toLocaleString();
    document.getElementById('st-diam').innerText = Math.floor(s.d).toLocaleString();
    document.getElementById('st-en').innerText = Math.floor(s.e);
    document.getElementById('st-pph').innerText = Math.floor(s.pph);
    document.getElementById('st-rob').innerText = Object.keys(s.robots).length;
    document.getElementById('char-img').innerText = chars[s.tab-1] || "ğŸ‘¶";
    
    // Level Bar
    let next = 50000 * Math.pow(4, s.tab-1);
    let perc = (s.c % next) / next * 100;
    document.getElementById('lvl-fill').style.width = perc + "%";

    // Theme (Karta orqali)
    if(s.cards.length > 0) {
        let lastTheme = themes[s.cards[s.cards.length-1]].img;
        document.body.className = lastTheme;
    }

    // Profil
    document.getElementById('u-name').innerText = user.first_name;
    document.getElementById('u-c').innerText = Math.floor(s.c).toLocaleString();
    document.getElementById('u-d').innerText = Math.floor(s.d).toLocaleString();
    document.getElementById('u-lvl').innerText = s.tab;
    document.getElementById('u-r').innerText = Object.keys(s.robots).length;

    // Airdrop Timer
    let end = new Date("2026-05-20").getTime();
    let diff = end - Date.now();
    let d=Math.floor(diff/(1000*60*60*24)), h=Math.floor((diff%(1000*60*60*24))/(1000*60*60)), m=Math.floor((diff%(1000*60*60))/(1000*60)), sec=Math.floor((diff%(1000*60))/1000);
    document.getElementById('air-timer').innerText = `${d} KUN ${h}:${m}:${sec}`;
}

// SHOP & ROBOTS
function renderShop() {
    let h = '';
    themes.forEach((t, i) => {
        let bought = s.cards.includes(i);
        h += `<div class="card" style="border-left:5px solid var(--p)">
            <b>${t.n}</b><br><small>Narxi: ${t.p.toLocaleString()}</small>
            <button class="btn" style="background:${bought?'#444':'var(--p)'}" onclick="buyTheme(${i}, ${t.p})" ${bought?'disabled':''}>${bought?'SOTIB OLINGAN':'SOTIB OLISH'}</button>
        </div>`;
    });
    document.getElementById('shop-list').innerHTML = h;
}

function renderRobots() {
    let h = '';
    robots.forEach(r => {
        let has = s.robots[r.id];
        h += `<div class="card" style="border-left:5px solid var(--s)">
            <b>${r.n}</b><br><small>${r.c}ğŸ“€ & ${r.d}ğŸ’ /soat</small>
            <button class="btn" style="background:${has?'#444':'var(--s)'}" onclick="buyRob(${r.id}, ${r.p})" ${has?'disabled':''}>${has?'SOTIB OLINGAN':r.p.toLocaleString()}</button>
        </div>`;
    });
    document.getElementById('robot-list').innerHTML = h;
}

function buyTheme(id, p) { if(s.c >= p) { s.c -= p; s.cards.push(id); save(); updateUI(); renderShop(); notify("Karta faollashdi!", 'green'); } else notify("Tanga yetarli emas!", 'red'); }
function buyRob(id, p) { if(s.c >= p) { s.c -= p; s.robots[id]=true; save(); updateUI(); renderRobots(); notify("Robot olindi!", 'green'); } else notify("Tanga yetarli emas!", 'red'); }

// BONUS TIMERS
function updateTimers() {
    let now = Date.now();
    let s_rem = Math.max(0, 1800000 - (now - s.lastS));
    let c_rem = Math.max(0, 1800000 - (now - s.lastC));
    document.getElementById('t-super').innerText = s_rem > 0 ? Math.floor(s_rem/60000) + " min" : "Tayyor";
    document.getElementById('t-chest').innerText = c_rem > 0 ? Math.floor(c_rem/60000) + " min" : "Tayyor";
}

// AD SYSTEM
function startAd(type) {
    if(typeof show_10558007 === 'function') {
        show_10558007().then(() => {
            if(type=='super') { s.lastS = Date.now(); s.tap = 100; setTimeout(()=>s.tap=1, 60000); notify("SUPER TAP YOQILDI!", 'green'); }
            if(type=='chest') { document.getElementById('chest-ui').style.display='block'; document.getElementById('btn-chest').style.display='none'; }
            if(type=='energy') { s.e = 5000; updateUI(); notify("ENERGIYA TO'LDI!", 'green'); }
            if(type=='runner') startRunner();
            if(type=='coinflip') openPage('p-coinflip');
        });
    } else {
        // Test rejim
        if(type=='runner') startRunner();
        if(type=='coinflip') openPage('p-coinflip');
        if(type=='chest') { document.getElementById('chest-ui').style.display='block'; document.getElementById('btn-chest').style.display='none'; }
    }
}

function openChest() {
    let w = Math.floor(Math.random()*100000) + 1000;
    s.c += w; s.lastC = Date.now();
    document.getElementById('chest-ui').style.display='none';
    document.getElementById('btn-chest').style.display='block';
    notify(`SANDIQDAN ${w} TANGA CHIQDI!`, 'green');
    save(); updateUI();
}

// RUNNER GAME (SUBWAY STYLE)
let gameInt, score=0;
function startRunner() {
    document.getElementById('game-canvas').style.display='block';
    score = 0;
    let p = document.getElementById('player');
    let pos = 50;
    document.addEventListener('keydown', (e) => {
        if(e.key == 'ArrowLeft') pos = 10;
        if(e.key == 'ArrowRight') pos = 80;
        p.style.left = pos + '%';
    });
    // Mobil uchun tap
    document.getElementById('game-canvas').onclick = (e) => {
        pos = e.clientX < window.innerWidth/2 ? 10 : 80;
        p.style.left = pos + '%';
    };

    gameInt = setInterval(() => {
        let item = document.createElement('div');
        item.className = 'item';
        item.innerText = Math.random() > 0.8 ? 'ğŸ’' : 'ğŸ“€';
        item.style.left = (Math.random() > 0.5 ? 10 : 80) + '%';
        item.style.top = '-50px';
        document.getElementById('game-canvas').appendChild(item);

        let fall = setInterval(() => {
            let top = parseInt(item.style.top);
            item.style.top = (top + 5) + 'px';
            
            // To'qnashuv
            if(top > 280 && top < 320 && parseInt(item.style.left) == pos) {
                if(item.innerText == 'ğŸ“€') { s.c += 100; score += 100; }
                else { s.d += 1; score += 1000; }
                document.getElementById('score-ui').innerText = "Ball: " + score;
                item.remove(); clearInterval(fall);
            }
            if(top > 350) { item.remove(); clearInterval(fall); }
        }, 20);
    }, 1000);

    setTimeout(() => { clearInterval(gameInt); document.getElementById('game-canvas').style.display='none'; notify(`O'YIN TUGADI! +${score} ball`, 'green'); updateUI(); }, 30000);
}

// COIN FLIP
let sel = 0;
function selSide(n) { sel=n; document.getElementById('side-1').style.background=n==1?'var(--p)':'#333'; document.getElementById('side-2').style.background=n==2?'var(--p)':'#333'; }
function flipNow() {
    let amt = parseInt(document.getElementById('flip-amt').value);
    if(s.c >= amt && sel > 0) {
        s.c -= amt;
        let c = document.getElementById('coin-obj');
        c.style.transform = "rotateY(1800deg)";
        setTimeout(() => {
            let res = Math.random() > 0.5 ? 1 : 2;
            c.innerText = res == 1 ? 'ğŸ“€' : 'ğŸ”¢';
            c.style.transform = "rotateY(0deg)";
            if(res == sel) { s.c += amt*2; notify("G'
    
    
        
            
        
                                               
    
            
        
        
    
        
    
    
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

