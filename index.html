<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga: Pro Edition</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="//libtl.com/sdk.js" data-zone="10558007" data-sdk="show_10558007"></script>

    <style>
        :root {
            --gold: #ffd700; --bg: #0b0d17; --card: #1c222d; 
            --cyan: #00f2fe; --purple: #a18cd1; --ruby: #ff4757;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', sans-serif; }
        body { margin: 0; background: var(--bg); color: white; overflow: hidden; touch-action: manipulation; }

        /* Level Bar - Tanga tepasida */
        .level-container { width: 90%; margin: 10px auto 0; }
        .lvl-text { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px; color: var(--gold); font-weight: bold; }
        .lvl-bar { width: 100%; height: 8px; background: #222; border-radius: 10px; overflow: hidden; border: 1px solid #444; }
        #lvl-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #00f2fe, #7d5fff); transition: 0.5s; }

        /* Top Stats */
        .top-nav { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; padding: 10px; background: rgba(0,0,0,0.5); }
        .stat-card { background: var(--card); padding: 5px; border-radius: 8px; text-align: center; border: 1px solid #444; }
        .stat-card b { display: block; color: var(--gold); font-size: 12px; }

        /* Airdrop Banner */
        .air-banner { background: linear-gradient(90deg, #9b59b6, #3498db); padding: 8px; text-align: center; font-weight: 900; font-size: 14px; }

        /* Main Game Area */
        .main-container { height: calc(100vh - 220px); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .main-balance { font-size: 45px; font-weight: 900; color: var(--gold); text-shadow: 0 0 20px rgba(255,215,0,0.4); margin: 0; }
        
        .coin-btn { width: 230px; height: 230px; position: relative; cursor: pointer; transition: 0.1s; }
        .coin-circle { 
            width: 100%; height: 100%; border-radius: 50%; 
            background: radial-gradient(circle, #ffe066 0%, #cc8e00 100%);
            border: 8px solid #8a6200; box-shadow: 0 0 40px rgba(255,215,0,0.2);
            display: flex; align-items: center; justify-content: center; font-size: 80px;
        }
        .tap-power-badge { position: absolute; top: -10px; right: 10px; background: var(--ruby); color: white; padding: 4px 10px; border-radius: 20px; font-weight: 900; font-size: 14px; z-index: 10; border: 2px solid white; }
        
        /* Dinamik Tanga Effektlari */
        .coin-evo-1 { filter: hue-rotate(45deg); box-shadow: 0 0 50px #00f2fe !important; }
        .coin-evo-2 { filter: hue-rotate(280deg); animation: pulse 1s infinite; }

        /* Navigation */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #07090c; display: flex; padding: 12px 0; border-top: 1px solid #222; }
        .nav-item { flex: 1; text-align: center; font-size: 10px; color: #666; cursor: pointer; }
        .nav-item i { font-style: normal; font-size: 22px; display: block; margin-bottom: 4px; }
        .nav-item.active { color: var(--gold); }

        /* Pages */
        .page { position: fixed; inset: 0; background: var(--bg); z-index: 1000; padding: 20px; display: none; overflow-y: auto; padding-bottom: 100px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; }
        .card-item { background: var(--card); border-radius: 15px; padding: 15px; border: 1px solid #333; margin-bottom: 10px; display: flex; align-items: center; justify-content: space-between; }
        
        /* Rank Styles */
        .rank-row { display: flex; align-items: center; padding: 12px; background: #161b22; border-radius: 12px; margin-bottom: 8px; border-left: 5px solid var(--gold); }
        .rank-medal { font-size: 24px; width: 40px; }
        .rank-info { flex: 1; }
        .rank-val { text-align: right; color: var(--cyan); font-weight: bold; }

        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.95); padding: 12px 25px; border-radius: 30px; border: 1px solid var(--gold); z-index: 5000; display: none; font-weight: bold; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

<div id="toast"></div>
<div class="air-banner" id="air-timer">99d 00h 00m 00s</div>

<div class="top-nav">
    <div class="stat-card"><small>ğŸ“€ PPH</small><b id="st-pph">0</b></div>
    <div class="stat-card"><small>ğŸ’ PPH</small><b id="st-dpph">0</b></div>
    <div class="stat-card"><small>ğŸ’ Olmos</small><b id="st-diam">0</b></div>
</div>

<div class="level-container">
    <div class="lvl-text"><span id="lvl-name">Bronza Konchi</span><span id="lvl-num">LVL 1</span></div>
    <div class="lvl-bar"><div id="lvl-fill"></div></div>
</div>

<div class="main-container">
    <h1 class="main-balance" id="main-bal">0</h1>
    <div class="coin-btn" onclick="tap(event)">
        <div class="tap-power-badge" id="tap-val">+1</div>
        <div class="coin-circle" id="main-coin">ğŸ“€</div>
    </div>
    <div style="width:80%; margin-top:20px; text-align:center;">
        <small id="en-txt" style="font-weight:bold; color:var(--cyan);">1000/1000</small>
        <div class="lvl-bar" style="height:10px; margin-top:5px;"><div id="en-fill" style="background:var(--gold); width:100%;"></div></div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item" onclick="openP('p-cards')"><i>ğŸƒ</i>Kartalar</div>
    <div class="nav-item" onclick="openP('p-bonus')"><i>ğŸ</i>Bonus</div>
    <div class="nav-item" onclick="openP('p-rank')"><i>ğŸ†</i>Rank</div>
    <div class="nav-item" onclick="openP('p-profile')"><i>ğŸ‘¤</i>Profil</div>
</div>

<div id="p-cards" class="page">
    <div class="page-header"><h2>Upgrade Kartalar</h2><h2 onclick="closeP('p-cards')">âœ–</h2></div>
    <div id="cards-container"></div>
</div>

<div id="p-bonus" class="page">
    <div class="page-header"><h2>Bonus & O'yinlar</h2><h2 onclick="closeP('p-bonus')">âœ–</h2></div>
    <div class="card-item" style="flex-direction:column; text-align:center;">
        <h3>Kunlik Bonus</h3>
        <button class="btn" style="background:var(--gold); padding:10px; width:100%; border-radius:10px;" onclick="dailyBonus()">Hozir olish ğŸ¬</button>
    </div>
    <div class="card-item" style="flex-direction:column; text-align:center;">
        <h3>Sandiqlar O'yini</h3>
        <div style="display:flex; justify-content:space-around; font-size:50px; width:100%; margin:15px 0;">
            <div onclick="chest(1)" id="ch1">ğŸ“¦</div><div onclick="chest(2)" id="ch2">ğŸ“¦</div><div onclick="chest(3)" id="ch3">ğŸ“¦</div>
        </div>
        <button id="res-ch" class="btn" style="background:var(--cyan); display:none" onclick="resChest()">Qayta o'ynash ğŸ¬</button>
    </div>
</div>

<div id="p-rank" class="page">
    <div class="page-header"><h2>Global Top 50</h2><h2 onclick="closeP('p-rank')">âœ–</h2></div>
    <div id="rank-list"></div>
</div>

<div id="p-profile" class="page">
    <div class="page-header"><h2>Profil & Airdrop</h2><h2 onclick="closeP('p-profile')">âœ–</h2></div>
    <div class="card-item" style="flex-direction:column; background:linear-gradient(135deg, #1c222d, #0b0d17); border:1px solid var(--purple);">
        <p style="font-size:14px; text-align:center;">Timer tugagandan keyin o'yinchilarga faolligi, darajasi, olmos va tangalar soni qo'shib hisoblanadi va Airdrop ajratiladi.</p>
        <div id="ton-connect-button" style="margin-top:10px;"></div>
    </div>
</div>

<script>
const tg = window.Telegram.WebApp;
const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const user = tg.initDataUnsafe?.user || { id: "GUEST_" + Math.random().toString(36).substr(2,5), first_name: "Player" };

let s = { c: 0, d: 0, pph: 0, dpph: 0, e: 1000, maxE: 1000, tap: 1, lvl: 1, items: {}, lastS: Date.now() };

const cards = [
    {id:1, n:"Ketmon", p:500, pr:15, i:"â›"}, {id:2, n:"Kurak", p:2500, pr:80, i:"ğŸ”¨"},
    {id:3, n:"Araba", p:10000, pr:350, i:"ğŸ›’"}, {id:4, n:"Konchi", p:50000, pr:2000, i:"ğŸ‘·"},
    {id:5, n:"Zavod", p:200000, pr:9000, i:"ğŸ­"}, {id:6, n:"Olmos Burg'u", p:5000, pr:50, i:"ğŸ’", cur:"d"}
]; // Misol tariqasida 6 ta, sizda 25 ta bo'ladi

function init() {
    db.ref('users/' + user.id).on('value', snap => {
        if(snap.exists()) s = {...s, ...snap.val()};
        updateUI();
        renderCards();
    });
}

function updateUI() {
    document.getElementById('main-bal').innerText = Math.floor(s.c).toLocaleString();
    document.getElementById('st-pph').innerText = Math.floor(s.pph).toLocaleString();
    document.getElementById('st-dpph').innerText = Math.floor(s.dpph).toLocaleString();
    document.getElementById('st-diam').innerText = Math.floor(s.d).toLocaleString();
    document.getElementById('tap-val').innerText = "+" + s.tap;
    
    // Level Logic
    let lvls = [0, 50000, 500000, 5000000, 50000000];
    let ci = 0; lvls.forEach((v,i) => { if(s.c >= v) ci = i; });
    s.lvl = ci + 1;
    let nxt = lvls[ci+1] || s.c;
    document.getElementById('lvl-fill').style.width = ((s.c - lvls[ci]) / (nxt - lvls[ci]) * 100) + "%";
    document.getElementById('lvl-num').innerText = "LVL " + s.lvl;

    // Energy
    document.getElementById('en-fill').style.width = (s.e/s.maxE*100) + "%";
    document.getElementById('en-txt').innerText = `${Math.floor(s.e)}/${s.maxE}`;

    // Tanga Effektlari (Har sotib olingan karta soniga qarab)
    let count = Object.keys(s.items || {}).length;
    let coin = document.getElementById('main-coin');
    if(count >= 5) coin.classList.add('coin-evo-1');
    if(count >= 15) coin.classList.add('coin-evo-2');
}

function tap(ev) {
    if(s.e >= s.tap) {
        s.c += s.tap; s.e -= s.tap;
        createPop(ev);
        tg.HapticFeedback.impactOccurred('light');
        updateUI();
    } else {
        notify("Energiya tugadi!", "ruby");
        runAd(() => { s.e = s.maxE; updateUI(); });
    }
}

function renderCards() {
    let h = '';
    cards.forEach(c => {
        let bought = s.items && s.items[c.id];
        h += `<div class="card-item">
            <div style="font-size:30px">${c.i}</div>
            <div style="flex:1; margin-left:15px"><b>${c.n}</b><br><small>+${c.pr}/s ${c.cur=='d'?'ğŸ’':'ğŸ“€'}</small></div>
            <button class="btn" style="background:var(--gold); width:auto; padding:8px 15px;" onclick="buyCard(${c.id})" ${bought?'disabled':''}>
                ${bought?'MAX':(c.cur=='d'?'ğŸ’':'ğŸ“€') + c.p.toLocaleString()}
            </button>
        </div>`;
    });
    document.getElementById('cards-container').innerHTML = h;
}

function buyCard(id) {
    runAd(() => {
        let c = cards.find(x => x.id === id);
        if(c.cur == 'd') {
            if(s.d >= c.p) { s.d -= c.p; s.dpph += c.pr; finishBuy(id); }
            else notify("Olmos kam!", "ruby");
        } else {
            if(s.c >= c.p) { s.c -= c.p; s.pph += c.pr; finishBuy(id); }
            else notify("Tanga kam!", "ruby");
        }
    });
}
function finishBuy(id) { if(!s.items) s.items={}; s.items[id]=true; save(); notify("Muvaffaqiyatli!"); }

// BONUS SISTEMASI
function dailyBonus() {
    runAd(() => { s.c += 50000; notify("50,000 Tanga olindi! ğŸ"); save(); });
}

function chest(n) {
    let win = Math.floor(Math.random()*3)+1;
    if(n == win) { document.getElementById('ch'+n).innerText="ğŸ’°"; s.c += 1000000; notify("1,000,000 TANGA! ğŸ‰"); }
    else { document.getElementById('ch'+n).innerText="âŒ"; notify("Bo'sh..."); }
    document.getElementById('res-ch').style.display = "block"; save();
}
function resChest() { runAd(() => { for(let i=1;i<=3;i++) document.getElementById('ch'+i).innerText="ğŸ“¦"; document.getElementById('res-ch').style.display="none"; }); }

// RANKING
function loadRank() {
    db.ref('users').orderByChild('c').limitToLast(50).once('value', snap => {
        let l = []; snap.forEach(u => l.push(u.val())); l.reverse();
        let h = '';
        l.forEach((u, i) => {
            let m = (i+1)==1?'ğŸ¥‡':(i+1)==2?'ğŸ¥ˆ':(i+1)==3?'ğŸ¥‰':(i+1);
            h += `<div class="rank-row">
                <div class="rank-medal">${m}</div>
                <div class="rank-info"><b>${u.first_name || 'Player'}</b><br><small>LVL ${u.lvl || 1}</small></div>
                <div class="rank-val">ğŸ“€ ${Math.floor(u.c).toLocaleString()}</div>
            </div>`;
        });
        document.getElementById('rank-list').innerHTML = h;
    });
}

// UTILS
function save() { s.lastS = Date.now(); db.ref('users/' + user.id).update(s); }
function openP(id) { runAd(() => { if(id=='p-rank') loadRank(); document.getElementById(id).style.display='block'; }); }
function closeP(id) { document.getElementById(id).style.display='none'; }
function notify(m, c) { let t = document.getElementById('toast'); t.innerText=m; t.style.borderColor=c=='ruby'?'red':'var(--gold)'; t.style.display='block'; setTimeout(()=>t.style.display='none', 2500); }
function createPop(e) { let p = document.createElement('div'); p.innerText="+"+s.tap; p.style.cssText=`position:fixed; left:${e.clientX}px; top:${e.clientY}px; font-weight:900; color:white; pointer-events:none; transition:0.6s; z-index:2000;`; document.body.appendChild(p); setTimeout(()=>{p.style.transform="translateY(-100px)"; p.style.opacity="0";},10); setTimeout(()=>p.remove(), 700); }
function runAd(cb) { if(typeof show_10558007 === 'function') show_10558007().then(cb).catch(cb); else cb(); }

// AIRDROP TIMER
const target = new Date().getTime() + (99 * 24 * 60 * 60 * 1000);
setInterval(() => {
    let diff = target - new Date().getTime();
    let d = Math.floor(diff/86400000), h = Math.floor((diff%86400000)/3600000), m = Math.floor((diff%3600000)/60000), sec = Math.floor((diff%60000)/1000);
    document.getElementById('air-timer').innerText = `${d}d ${h}h ${m}m ${sec}s Airdrop Countdown!`;
}, 1000);

// Passive & AutoSave
setInterval(() => { s.c += (s.pph/3600); s.d += (s.dpph/3600); s.e = Math.min(s.maxE, s.e + 1); updateUI(); }, 1000);
setInterval(save, 30000);

new TON_CONNECT_UI.TonConnectUI({ manifestUrl: 'https://ganiyevdiyorbek700-dotcom.github.io/Oltin-Tanga-/tonconnect-manifest.json', buttonRootId: 'ton-connect-button' });
init();
tg.expand();
</script>
</body>
        </html>
        
        
    
        
    
    
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

