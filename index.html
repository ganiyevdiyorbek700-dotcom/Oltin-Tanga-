<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga: Web3 Empire</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="//libtl.com/sdk.js" data-zone="10558007" data-sdk="show_10558007"></script>

    <style>
        :root {
            --gold: #ffd700; --bg: #07090f; --card: #161a2e; 
            --cyan: #00f2fe; --purple: #7d5fff; --ruby: #ff4757;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Inter', sans-serif; }
        body { margin: 0; background: var(--bg); color: white; overflow: hidden; }

        /* Timer & Header */
        .air-banner { background: linear-gradient(90deg, #6c5ce7, #a29bfe); padding: 10px; text-align: center; font-weight: 800; font-size: 13px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }

        /* Stats Grid */
        .top-nav { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 10px; }
        .stat-card { background: var(--card); padding: 8px; border-radius: 12px; text-align: center; border: 1px solid #2d3436; }
        .stat-card small { font-size: 10px; color: #aaa; display: block; }
        .stat-card b { color: var(--gold); font-size: 12px; }

        /* Level Section */
        .level-box { padding: 0 15px; margin-top: 10px; }
        .lvl-header { display: flex; justify-content: space-between; font-size: 12px; margin-bottom: 5px; color: var(--cyan); font-weight: bold; }
        .lvl-bar { width: 100%; height: 10px; background: #1e272e; border-radius: 10px; overflow: hidden; border: 1px solid #2d3436; }
        #lvl-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #00f2fe, #7d5fff); transition: 0.8s ease-out; }

        /* Main Game Area */
        .main-container { height: 55vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .main-balance { font-size: 50px; font-weight: 900; color: var(--gold); text-shadow: 0 0 30px rgba(255,215,0,0.3); margin: 0; }
        
        .coin-btn { width: 240px; height: 240px; position: relative; cursor: pointer; transition: transform 0.05s; }
        .coin-btn:active { transform: scale(0.92); }
        .coin-circle { 
            width: 100%; height: 100%; border-radius: 50%; 
            background: radial-gradient(circle, #ffe066 0%, #cc8e00 100%);
            border: 10px solid #8a6200; display: flex; align-items: center; justify-content: center; font-size: 90px;
            transition: all 0.5s;
        }
        
        /* Tap & SuperTap Badge */
        .tap-badge { position: absolute; top: 0; right: 0; background: var(--ruby); padding: 5px 12px; border-radius: 20px; font-weight: 900; border: 2px solid #fff; z-index: 10; animation: float 2s infinite; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        /* Nav Bar */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #0f111a; display: flex; padding: 15px 0; border-top: 1px solid #2d3436; z-index: 1000; }
        .nav-item { flex: 1; text-align: center; font-size: 10px; color: #636e72; }
        .nav-item i { font-size: 24px; display: block; margin-bottom: 5px; font-style: normal; }
        .nav-item.active { color: var(--gold); }

        /* Pages */
        .page { position: fixed; inset: 0; background: var(--bg); z-index: 2000; padding: 20px; display: none; overflow-y: auto; padding-bottom: 120px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #2d3436; margin-bottom: 20px; }
        
        /* Cards */
        .card-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        .card-item { background: var(--card); border-radius: 18px; padding: 15px; display: flex; align-items: center; justify-content: space-between; border: 1px solid #2d3436; }
        
        /* Profile Info List */
        .prof-list { background: var(--card); border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #3d4466; }
        .prof-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #2d3436; font-size: 14px; }
        .prof-row b { color: var(--cyan); }

        /* Ranking Medals */
        .rank-item { display: flex; align-items: center; padding: 12px; background: #1a1f36; border-radius: 12px; margin-bottom: 10px; border-left: 4px solid var(--gold); }
        
        #toast { position: fixed; top: 30px; left: 50%; transform: translateX(-50%); background: #fff; color: #000; padding: 12px 25px; border-radius: 50px; font-weight: bold; z-index: 9999; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
    </style>
</head>
<body>

<div id="toast"></div>
<div class="air-banner" id="air-timer">99d 00h 00m 00s</div>

<div class="top-nav">
    <div class="stat-card"><small>ğŸ“€ PPH</small><b id="st-pph">0</b></div>
    <div class="stat-card"><small>ğŸ’ PPH</small><b id="st-dpph">0</b></div>
    <div class="stat-card"><small>âš¡ ENERGY</small><b id="st-en">1000</b></div>
</div>

<div class="level-section">
    <div class="level-box">
        <div class="lvl-header"><span id="lvl-name">Yangi Konchi</span> <span id="lvl-num">LVL 1/15</span></div>
        <div class="lvl-bar"><div id="lvl-fill"></div></div>
    </div>
</div>

<div class="main-container">
    <h1 class="main-balance" id="main-bal">0</h1>
    <div class="coin-btn" onclick="handleTap(event)">
        <div class="tap-badge" id="tap-val">+1</div>
        <div class="coin-circle" id="main-coin">ğŸ“€</div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item" onclick="openP('p-cards', true)"><i>ğŸƒ</i>Kartalar</div>
    <div class="nav-item" onclick="openP('p-bonus', true)"><i>ğŸ”¥</i>Bonus</div>
    <div class="nav-item" onclick="openP('p-exchange', false)"><i>ğŸ’±</i>Birja</div>
    <div class="nav-item" onclick="openP('p-rank', false)"><i>ğŸ†</i>Rank</div>
    <div class="nav-item" onclick="openP('p-profile', true)"><i>ğŸ‘¤</i>Profil</div>
</div>

<div id="p-cards" class="page">
    <div class="page-header"><h2>Mining Magazini</h2><h2 onclick="closeP('p-cards')">âœ–</h2></div>
    <div class="card-grid" id="cards-container"></div>
</div>

<div id="p-bonus" class="page">
    <div class="page-header"><h2>Super Bonuslar</h2><h2 onclick="closeP('p-bonus')">âœ–</h2></div>
    <div class="card-item" style="flex-direction:column; gap:10px;">
        <h3>Super Tap ğŸ”¥</h3>
        <p>30 soniya davomida Tap kuchi 100 ga o'zgaradi!</p>
        <button id="btn-supertap" style="width:100%; background:var(--ruby); color:white; padding:15px; border-radius:12px; border:none; font-weight:bold;" onclick="startSuperTap()">Hozir Yoqish ğŸ¬</button>
    </div>
    <div class="card-item" style="margin-top:15px; flex-direction:column;">
        <h3>Omadli Sandiq ğŸ“¦</h3>
        <div style="display:flex; justify-content:space-around; width:100%; font-size:50px; margin:15px 0;">
            <div onclick="chest(1)" id="ch1">ğŸ“¦</div><div onclick="chest(2)" id="ch2">ğŸ“¦</div><div onclick="chest(3)" id="ch3">ğŸ“¦</div>
        </div>
        <button id="res-ch" style="display:none; background:var(--cyan); border:none; padding:10px; border-radius:10px;" onclick="resChest()">Qayta ğŸ¬</button>
    </div>
</div>

<div id="p-exchange" class="page">
    <div class="page-header"><h2>Birja ğŸ’±</h2><h2 onclick="closeP('p-exchange')">âœ–</h2></div>
    <div class="card-item" style="flex-direction:column;">
        <p>10,000 ğŸ“€ = 1 ğŸ’</p>
        <input type="number" id="ex-val" style="width:100%; padding:15px; background:#000; color:#fff; border:1px solid #444; border-radius:10px;" placeholder="Olmos miqdori">
        <button style="width:100%; background:var(--gold); padding:15px; border-radius:10px; border:none; margin-top:10px; font-weight:bold;" onclick="doEx()">Almashtirish</button>
    </div>
</div>

<div id="p-rank" class="page">
    <div class="page-header"><h2>Global Top 50</h2><h2 onclick="closeP('p-rank')">âœ–</h2></div>
    <div id="rank-list"></div>
</div>

<div id="p-profile" class="page">
    <div class="page-header"><h2>Mening Profilim</h2><h2 onclick="closeP('p-profile')">âœ–</h2></div>
    <div class="prof-list">
        <div class="prof-row"><span>Ism:</span> <b id="pr-name">...</b></div>
        <div class="prof-row"><span>ID:</span> <b id="pr-id">...</b></div>
        <div class="prof-row"><span>Tangalar:</span> <b id="pr-c">0</b></div>
        <div class="prof-row"><span>Olmoslar:</span> <b id="pr-d">0</b></div>
        <div class="prof-row"><span>Daraja:</span> <b id="pr-lvl">1/15</b></div>
        <div class="prof-row"><span>Kartalar:</span> <b id="pr-items">0</b></div>
        <div class="prof-row" style="border:none;"><span>Hamyon:</span> <b id="pr-wall" style="font-size:10px;">Ulanmagan</b></div>
    </div>
    <div class="card-item" style="flex-direction:column; background:linear-gradient(45deg, #1a1f36, #2d3436);">
        <p style="font-size:12px; text-align:center;">Timer tugagandan keyin o'yinchilarga faolligi, darajasi, olmos va tangalar soni qo'shib hisoblanadi va Airdrop ajratiladi.</p>
        <div id="ton-connect-button"></div>
    </div>
</div>

<script>
// --- SOUNDS ---
const snd = {
    tap: new Audio('https://www.soundjay.com/buttons/sounds/button-16.mp3'),
    buy: new Audio('https://www.soundjay.com/buttons/sounds/button-09.mp3'),
    bonus: new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3')
};

// --- CORE ---
const tg = window.Telegram.WebApp;
const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const user = tg.initDataUnsafe?.user || { id: "888888", first_name: "Mega Player" };

let s = { c: 0, d: 0, pph: 0, dpph: 0, e: 1000, maxE: 1000, tap: 1, lvl: 1, items: {}, wall: '' };
let isSuper = false;

// 15 TA DARAJA KONFIGI
const lvls = [0, 10000, 50000, 200000, 1000000, 5000000, 20000000, 100000000, 500000000, 1000000000, 5000000000, 20000000000, 100000000000, 500000000000, 1000000000000];
const lvlNames = ["Yangi", "Havaskor", "Ishchi", "Usta", "Katta Usta", "Menejer", "Direktor", "Boy", "Millioner", "Multimillioner", "Milliarder", "Trillioner", "Web3 Qiroli", "Tanga Imperatori", "Oltin Xudo"];

// 25 TA KARTA HAR XIL RANGLAR BILAN
const cardData = [
    {n:"Ketmon", p:1000, pr:20, col:"#55efc4"}, {n:"Kurak", p:5000, pr:110, col:"#81ecec"},
    {n:"Araba", p:25000, pr:600, col:"#74b9ff"}, {n:"Chiroq", p:100000, pr:2500, col:"#a29bfe"},
    {n:"Burg'u", p:500000, pr:12000, col:"#ffeaa7"}, {n:"Zavod", p:2000000, pr:50000, col:"#fab1a0"},
    {n:"Bank", p:10000000, pr:280000, col:"#ff7675"}, {n:"Orol", p:50000000, pr:1500000, col:"#fd79a8"},
    {n:"Raketa", p:250000000, pr:8000000, col:"#6c5ce7"}, {n:"Sayyora", p:1000000000, pr:35000000, col:"#00b894"}
]; // Misol uchun 10 ta, mantiqan 25 tagacha generatsiya bo'ladi.

function init() {
    db.ref('users/' + user.id).on('value', snap => {
        if(snap.exists()) s = {...s, ...snap.val()};
        updateUI();
        renderCards();
    });
    const tonUI = new TON_CONNECT_UI.TonConnectUI({ manifestUrl: 'https://ganiyevdiyorbek700-dotcom.github.io/Oltin-Tanga-/tonconnect-manifest.json', buttonRootId: 'ton-connect-button' });
    tonUI.onStatusChange(w => { if(w) { s.wall = w.account.address; save(); } });
    
    startAirdropTimer();
    tg.expand();
}

function updateUI() {
    document.getElementById('main-bal').innerText = Math.floor(s.c).toLocaleString();
    document.getElementById('st-pph').innerText = Math.floor(s.pph).toLocaleString();
    document.getElementById('st-dpph').innerText = Math.floor(s.dpph).toLocaleString();
    document.getElementById('st-en').innerText = Math.floor(s.e);
    document.getElementById('tap-val').innerText = isSuper ? "+100 ğŸ”¥" : "+" + s.tap;

    // Lvl Calculation
    let ci = 0; lvls.forEach((v,i) => { if(s.c >= v) ci = i; });
    s.lvl = ci + 1;
    document.getElementById('lvl-name').innerText = lvlNames[ci];
    document.getElementById('lvl-num').innerText = `LVL ${s.lvl}/15`;
    let nextVal = lvls[ci+1] || s.c;
    document.getElementById('lvl-fill').style.width = ((s.c - lvls[ci])/(nextVal - lvls[ci])*100) + "%";

    // Energy
    document.getElementById('en-fill').style.width = (s.e/s.maxE*100) + "%";

    // Profile
    document.getElementById('pr-name').innerText = user.first_name;
    document.getElementById('pr-id').innerText = user.id;
    document.getElementById('pr-c').innerText = Math.floor(s.c).toLocaleString();
    document.getElementById('pr-d').innerText = s.d.toLocaleString();
    document.getElementById('pr-lvl').innerText = s.lvl + "/15";
    document.getElementById('pr-items').innerText = Object.keys(s.items || {}).length;
    if(s.wall) document.getElementById('pr-wall').innerText = s.wall.substring(0,8)+"..."+s.wall.slice(-4);
}

function handleTap(e) {
    let power = isSuper ? 100 : s.tap;
    if(s.e >= (isSuper ? 1 : power)) {
        s.c += power; if(!isSuper) s.e -= power;
        snd.tap.cloneNode().play();
        createPop(e, power);
        updateUI();
    } else {
        notify("Energiya yo'q!", "ruby");
        runAd(() => { s.e = s.maxE; updateUI(); });
    }
}

function startSuperTap() {
    runAd(() => {
        isSuper = true;
        snd.bonus.play();
        notify("SUPER TAP YOQILDI! ğŸ”¥", "gold");
        document.getElementById('btn-supertap').disabled = true;
        document.getElementById('main-coin').style.boxShadow = "0 0 50px #ff4757";
        setTimeout(() => {
            isSuper = false;
            document.getElementById('btn-supertap').disabled = false;
            document.getElementById('main-coin').style.boxShadow = "none";
            notify("Super Tap tugadi");
            updateUI();
        }, 30000);
    });
}

function renderCards() {
    let h = '';
    cardData.forEach((c, i) => {
        let id = i + 1;
        let bought = s.items && s.items[id];
        h += `<div class="card-item" style="border-right: 8px solid ${c.col}">
            <div><b>${c.n}</b><br><small>+${c.pr}/s</small></div>
            <button style="background:${c.col}; color:#000; border:none; padding:10px 15px; border-radius:10px; font-weight:900;" 
                onclick="buyCard(${id}, '${c.col}')" ${bought?'disabled':''}>
                ${bought ? 'MAX' : c.p.toLocaleString()}
            </button>
        </div>`;
    });
    document.getElementById('cards-container').innerHTML = h;
}

function buyCard(id, color) {
    let c = cardData[id-1];
    if(s.c >= c.p) {
        s.c -= c.p; if(!s.items) s.items = {}; s.items[id] = true;
        s.pph += c.pr;
        document.getElementById('main-coin').style.background = `radial-gradient(circle, #fff 0%, ${color} 100%)`;
        snd.buy.play();
        notify("Upgrade qilindi! âœ¨");
        save();
    } else notify("Mablag' yetarli emas!");
}

function doEx() {
    let v = parseInt(document.getElementById('ex-val').value);
    if(v > 0 && s.c >= v*10000) { s.c -= v*10000; s.d += v; notify("Muvaffaqiyatli!"); save(); }
    else notify("Yetarli emas!");
}

function loadRank() {
    db.ref('users').orderByChild('c').limitToLast(50).once('value', snap => {
        let list = []; snap.forEach(u => list.push(u.val())); list.reverse();
        let h = '';
        list.forEach((u, i) => {
            let m = (i+1)==1?'ğŸ¥‡':(i+1)==2?'ğŸ¥ˆ':(i+1)==3?'ğŸ¥‰':(i+1);
            h += `<div class="rank-item">
                <div style="width:40px; font-weight:bold;">${m}</div>
                <div style="flex:1"><b>${u.first_name || 'Player'}</b><br><small>LVL ${u.lvl || 1}</small></div>
                <div style="color:var(--gold)">${Math.floor(u.c).toLocaleString()} ğŸ“€</div>
            </div>`;
        });
        document.getElementById('rank-list').innerHTML = h;
    });
}

// SYSTEM
function save() { db.ref('users/' + user.id).update(s); }
function openP(id, needsAd) {
    if(needsAd) { runAd(() => { if(id=='p-rank') loadRank(); document.getElementById(id).style.display='block'; }); }
    else { if(id=='p-rank') loadRank(); document.getElementById(id).style.display='block'; }
}
function closeP(id) { document.getElementById(id).style.display='none'; }
function notify(m, col) { let t=document.getElementById('toast'); t.innerText=m; t.style.background=col=='gold'?'var(--gold)':'#fff'; t.style.display='block'; setTimeout(()=>t.style.display='none', 2500); }
function createPop(e, p) { 
    let d = document.createElement('div'); d.innerText="+"+p; 
    d.style.cssText=`position:fixed; left:${e.clientX}px; top:${e.clientY}px; font-weight:900; color:${isSuper?'#ff4757':'#fff'}; pointer-events:none; transition:0.7s; z-index:9999; font-size:24px;`;
    document.body.appendChild(d); setTimeout(()=>{d.style.transform="translateY(-120px) scale(1.5)"; d.style.opacity="0";},10); setTimeout(()=>d.remove(), 800);
}
function runAd(cb) { if(typeof show_10558007==='function') show_10558007().then(cb).catch(cb); else cb(); }

function startAirdropTimer() {
    const target = new Date().getTime() + (99 * 24 * 60 * 60 * 1000);
    setInterval(() => {
        let diff = target - new Date().getTime();
        let d=Math.floor(diff/86400000), h=Math.floor((diff%86400000)/3600000), m=Math.floor((diff%3600000)/60000), s=Math.floor((diff%60000)/1000);
        document.getElementById('air-timer').innerText = `${d}d ${h}h ${m}m ${s}s Airdrop Countdown!`;
    }, 1000);
}

// Chest Game
function chest(n) { let w=Math.floor(Math.random()*3)+1; if(n==w){s.c+=1000000; notify("1,000,000 ğŸ“€!");} document.getElementById('res-ch').style.display='block'; save(); }
function resChest() { runAd(() => { document.getElementById('res-ch').style.display='none'; }); }

setInterval(() => { s.c += (s.pph/3600); s.d += (s.dpph/3600); s.e = Math.min(s.maxE, s.e + 1); updateUI(); }, 1000);
setInterval(save, 30000);

init();
</script>
</body>
                                 </html>
            
        
        
    
        
    
    
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

