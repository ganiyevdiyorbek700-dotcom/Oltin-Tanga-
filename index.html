<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga: Web3 Edition</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="//libtl.com/sdk.js" data-zone="10558007" data-sdk="show_10558007"></script>

    <style>
        :root {
            --gold: #ffd700; --bg: #0b0d17; --card: #1c222d; --green: #2ecc71; 
            --blue: #0088cc; --purple: #9b59b6; --ruby: #e74c3c; --platinum: #e5e4e2;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', Roboto, sans-serif; }
        body { margin: 0; background: var(--bg); color: white; overflow: hidden; touch-action: manipulation; }

        /* Background Effects */
        .stars { position: fixed; width: 100%; height: 100%; z-index: -1; background: radial-gradient(ellipse at bottom, #1B2735 0%, #090A0F 100%); overflow: hidden; }

        /* Top Stats */
        .top-nav { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; padding: 10px; background: rgba(0,0,0,0.5); border-bottom: 1px solid #333; }
        .stat-card { background: var(--card); padding: 5px; border-radius: 8px; text-align: center; font-size: 11px; border: 1px solid #444; }
        .stat-card b { display: block; color: var(--gold); font-size: 13px; }

        /* Airdrop Timer Banner */
        .airdrop-banner { background: linear-gradient(90deg, #9b59b6, #3498db); padding: 8px; text-align: center; font-weight: bold; font-size: 14px; text-shadow: 0 1px 3px rgba(0,0,0,0.5); }

        /* Main Game Area */
        .main-container { height: calc(100vh - 180px); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        .balance-group { text-align: center; margin-bottom: 20px; }
        .main-balance { font-size: 42px; font-weight: 900; color: var(--gold); text-shadow: 0 0 20px rgba(255,215,0,0.4); }
        .diamond-balance { font-size: 18px; color: #00f2fe; }

        .coin-btn { width: 220px; height: 220px; position: relative; cursor: pointer; user-select: none; }
        .coin-circle { 
            width: 100%; height: 100%; border-radius: 50%; 
            background: radial-gradient(circle, #ffe066 0%, #cc8e00 100%);
            border: 8px solid #8a6200; box-shadow: 0 0 40px rgba(255,215,0,0.2), inset 0 0 20px rgba(0,0,0,0.3);
            display: flex; align-items: center; justify-content: center; font-size: 80px;
        }
        .coin-btn:active { transform: scale(0.95); }

        /* Energy Bar */
        .energy-box { width: 80%; margin-top: 30px; text-align: center; }
        .energy-bar { width: 100%; height: 12px; background: #222; border-radius: 6px; margin-top: 5px; overflow: hidden; border: 1px solid #444; }
        #energy-fill { height: 100%; background: linear-gradient(90deg, #ffd700, #f39c12); width: 100%; transition: width 0.2s; }

        /* Pages System */
        .page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 1000; padding: 20px; display: none; overflow-y: auto; padding-bottom: 100px; }
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px; }
        .close-btn { font-size: 30px; cursor: pointer; color: #888; }

        /* Cards Grid */
        .cards-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .card-item { background: var(--card); border-radius: 15px; padding: 15px; text-align: center; border: 1px solid #333; position: relative; }
        .card-item img { font-size: 40px; margin-bottom: 10px; display: block; }
        .card-name { font-weight: bold; font-size: 14px; margin-bottom: 5px; }
        .card-profit { font-size: 11px; color: #2ecc71; margin-bottom: 8px; }
        .card-price { font-size: 13px; font-weight: bold; color: var(--gold); }
        
        /* Rarity Colors */
        .silver-border { border-color: #bdc3c7; }
        .gold-border { border-color: #f1c40f; }
        .ruby-border { border-color: #e74c3c; }
        .premium-border { border-color: #00f2fe; box-shadow: 0 0 10px #00f2fe; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 0.8; } 50% { opacity: 1; } 100% { opacity: 0.8; } }

        /* Exchange UI */
        .exchange-panel { background: #161b22; border-radius: 15px; padding: 20px; text-align: center; border: 1px solid #00d2ff; }
        .exchange-input { width: 100%; padding: 12px; border-radius: 10px; border: none; background: #0b0d17; color: white; margin: 15px 0; text-align: center; font-size: 18px; }

        /* Navigation Bar */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #07090c; display: flex; justify-content: space-around; padding: 12px 0; border-top: 1px solid #222; z-index: 500; }
        .nav-item { text-align: center; font-size: 10px; color: #666; cursor: pointer; flex: 1; }
        .nav-item i { font-style: normal; font-size: 22px; display: block; margin-bottom: 4px; }
        .nav-item.active { color: var(--gold); }

        /* Rank Style */
        .rank-row { display: flex; align-items: center; justify-content: space-between; padding: 12px; background: var(--card); border-radius: 12px; margin-bottom: 8px; border: 1px solid #333; }
        
        /* Utility */
        .btn { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; margin-top: 5px; }
        .btn-gold { background: var(--gold); color: black; }
        .btn-blue { background: var(--blue); color: white; }
        
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); padding: 10px 20px; border-radius: 20px; border: 1px solid var(--gold); z-index: 5000; display: none; }
    </style>
</head>
<body>

<div id="toast"></div>
<div class="stars"></div>

<div class="airdrop-banner" id="airdrop-timer">99d 00h 00m 00s gacha Airdrop! ğŸš€</div>

<div class="top-nav">
    <div class="stat-card"><small>âš¡ PPH</small><b id="stat-pph">0</b></div>
    <div class="stat-card"><small>ğŸ’ Olmos PPH</small><b id="stat-dpph">0</b></div>
    <div class="stat-card"><small>ğŸ† Daraja</small><b id="stat-lvl">1</b></div>
</div>

<div class="main-container">
    <div class="balance-group">
        <div class="main-balance" id="coin-balance">0</div>
        <div class="diamond-balance">ğŸ’ <span id="diam-balance">0</span></div>
    </div>

    <div class="coin-btn" onclick="handleTap(event)">
        <div class="coin-circle">ğŸ“€</div>
    </div>

    <div class="energy-box">
        <span id="energy-text">1000/1000</span>
        <div class="energy-bar"><div id="energy-fill"></div></div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-item" onclick="openPage('p-cards')"><i>ğŸƒ</i>Kartalar</div>
    <div class="nav-item" onclick="openPage('p-exchange')"><i>ğŸ’±</i>Birja</div>
    <div class="nav-item" onclick="openPage('p-game')"><i>ğŸ</i>O'yin</div>
    <div class="nav-item" onclick="openPage('p-rank')"><i>ğŸ†</i>Rank</div>
    <div class="nav-item" onclick="openPage('p-profile')"><i>ğŸ‘¤</i>Profil</div>
</div>

<div id="p-cards" class="page">
    <div class="page-header"><h2>Upgrade Kartalar ğŸƒ</h2><span class="close-btn" onclick="closePage('p-cards')">âœ–</span></div>
    <div class="cards-grid" id="cards-container">
        </div>
</div>

<div id="p-exchange" class="page">
    <div class="page-header"><h2>Valyuta Ayirboshlash ğŸ’±</h2><span class="close-btn" onclick="closePage('p-exchange')">âœ–</span></div>
    <div class="exchange-panel">
        <p>Kurs: 10,000 ğŸ“€ = 1 ğŸ’</p>
        <input type="number" id="ex-amount" class="exchange-input" placeholder="Miqdorni kiriting">
        <button class="btn btn-gold" onclick="exchange('c2d')">ğŸ“€ â” ğŸ’ Almashtirish</button>
        <button class="btn btn-blue" onclick="exchange('d2c')" style="margin-top:10px">ğŸ’ â” ğŸ“€ Almashtirish</button>
    </div>
</div>

<div id="p-game" class="page">
    <div class="page-header"><h2>Sandiqlar O'yini ğŸ</h2><span class="close-btn" onclick="closePage('p-game')">âœ–</span></div>
    <div style="text-align:center">
        <p>Bitta sandiqda 1,000,000 tanga bor!</p>
        <div style="display:flex; justify-content: space-around; font-size:60px; margin-top:30px;">
            <div onclick="playChest(1)" id="ch1">ğŸ“¦</div>
            <div onclick="playChest(2)" id="ch2">ğŸ“¦</div>
            <div onclick="playChest(3)" id="ch3">ğŸ“¦</div>
        </div>
        <button id="btn-reset-game" class="btn btn-gold" style="margin-top:40px; display:none" onclick="resetChests()">Reklama ko'rib qayta o'ynash ğŸ¬</button>
    </div>
</div>

<div id="p-rank" class="page">
    <div class="page-header"><h2>Global Reyting ğŸ†</h2><span class="close-btn" onclick="closePage('p-rank')">âœ–</span></div>
    <div id="rank-list">Yuklanmoqda...</div>
</div>

<div id="p-profile" class="page">
    <div class="page-header"><h2>Mening Profilim ğŸ‘¤</h2><span class="close-btn" onclick="closePage('p-profile')">âœ–</span></div>
    <div class="card-item" style="text-align:left; margin-bottom:20px">
        <p>Ism: <b id="prof-name">...</b></p>
        <p>Telegram ID: <b id="prof-id">...</b></p>
        <p>Jami Daromad (PPH): <b id="prof-pph">0</b></p>
    </div>

    <div class="exchange-panel" style="border-color: #9b59b6;">
        <h3>ğŸ’ Airdrop Hamyoni</h3>
        <p style="font-size:12px; color:#aaa">Hamyonni ulang va 99 kundan keyin reklamadan tushgan 15% pulni TONda oling!</p>
        <div id="ton-connect-button" style="display:flex; justify-content:center"></div>
    </div>
</div>

<script>
// --- FIREBASE & TG INIT ---
const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tg = window.Telegram.WebApp;
const user = tg.initDataUnsafe?.user || { id: "GUEST_" + Math.random().toString(36).substr(2, 5), first_name: "O'yinchi" };

// --- GAME STATE ---
let s = {
    c: 0, d: 0, pph: 0, dpph: 0, 
    e: 1000, maxE: 1000, tap: 1,
    lvl: 1, lastS: Date.now(),
    wallet: '', items: []
};

// --- CARDS DATA (25 TA) ---
const cards = [
    {id:1, n:"Bolg'a", p:500, pr:10, t:"silver", i:"ğŸ”¨"},
    {id:2, n:"Kurak", p:2000, pr:50, t:"silver", i:"â›"},
    {id:3, n:"Xalta", p:5000, pr:150, t:"silver", i:"ğŸ’°"},
    {id:4, n:"Araba", p:10000, pr:350, t:"silver", i:"ğŸ›’"},
    {id:5, n:"G'alvir", p:25000, pr:900, t:"silver", i:"ğŸ”"},
    {id:6, n:"Konchi", p:60000, pr:2500, t:"gold", i:"ğŸ‘·"},
    {id:7, n:"Burg'u", p:150000, pr:6500, t:"gold", i:"ğŸšœ"},
    {id:8, n:"Xarita", p:400000, pr:18000, t:"gold", i:"ğŸ—º"},
    {id:9, n:"Sandiq", p:1000000, pr:45000, t:"gold", i:"ğŸ"},
    {id:10, n:"Ombor", p:2500000, pr:120000, t:"gold", i:"ğŸ "},
    {id:11, n:"Zavod", p:6000000, pr:300000, t:"ruby", i:"ğŸ­"},
    {id:12, n:"Bank", p:15000000, pr:800000, t:"ruby", i:"ğŸ¦"},
    {id:13, n:"Orol", p:40000000, pr:2000000, t:"ruby", i:"ğŸ"},
    {id:14, n:"Piramida", p:100000000, pr:5500000, t:"ruby", i:"ğŸ›"},
    {id:15, n:"Samolyot", p:250000000, pr:15000000, t:"ruby", i:"ğŸ›©"},
    {id:16, n:"Raketa", p:600000000, pr:40000000, t:"ruby", i:"ğŸš€"},
    {id:17, n:"Sayyora", p:1500000000, pr:100000000, t:"ruby", i:"ğŸª"},
    {id:18, n:"Galaktika", p:4000000000, pr:300000000, t:"ruby", i:"ğŸŒŒ"},
    {id:19, n:"Vaqt", p:10000000000, pr:800000000, t:"ruby", i:"â³"},
    {id:20, n:"Qora Teshik", p:25000000000, pr:2000000000, t:"ruby", i:"ğŸŒ€"},
    {id:21, n:"TON King", p:10000, pr:50, t:"premium", i:"ğŸ’", cur:"d"},
    {id:22, n:"Durov's Star", p:50000, pr:300, t:"premium", i:"â­", cur:"d"},
    {id:23, n:"Crypto Whale", p:200000, pr:1500, t:"premium", i:"ğŸ‹", cur:"d"},
    {id:24, n:"Web3 God", p:1000000, pr:10000, t:"premium", i:"âš¡", cur:"d"},
    {id:25, n:"Tanga Creator", p:5000000, pr:60000, t:"premium", i:"ğŸ‘‘", cur:"d"}
];

// --- CORE FUNCTIONS ---
function init() {
    db.ref('users/' + user.id).on('value', snap => {
        if(snap.exists()) {
            s = {...s, ...snap.val()};
        } else {
            save();
        }
        renderCards();
        updateUI();
    });

    // TonConnect
    const tonUI = new TON_CONNECT_UI.TonConnectUI({
        manifestUrl: 'https://ganiyevdiyorbek700-dotcom.github.io/Oltin-Tanga-/tonconnect-manifest.json',
        buttonRootId: 'ton-connect-button'
    });
    tonUI.onStatusChange(w => { if(w) { s.wallet = w.account.address; save(); notify("Hamyon ulandi!"); }});
}

function updateUI() {
    document.getElementById('coin-balance').innerText = Math.floor(s.c).toLocaleString();
    document.getElementById('diam-balance').innerText = Math.floor(s.d).toLocaleString();
    document.getElementById('stat-pph').innerText = Math.floor(s.pph).toLocaleString();
    document.getElementById('stat-dpph').innerText = Math.floor(s.dpph).toLocaleString();
    document.getElementById('energy-text').innerText = `${Math.floor(s.e)}/${s.maxE}`;
    document.getElementById('energy-fill').style.width = (s.e/s.maxE*100) + "%";
    
    document.getElementById('prof-name').innerText = user.first_name;
    document.getElementById('prof-id').innerText = user.id;
    document.getElementById('prof-pph').innerText = Math.floor(s.pph).toLocaleString();
}

function handleTap(ev) {
    if(s.e >= s.tap) {
        s.c += s.tap; s.e -= s.tap;
        createTapAnim(ev);
        updateUI();
    } else {
        notify("Energiya yo'q!", "red");
        runAd(() => { s.e = s.maxE; updateUI(); });
    }
}

function renderCards() {
    const container = document.getElementById('cards-container');
    container.innerHTML = '';
    cards.forEach(card => {
        const div = document.createElement('div');
        div.className = `card-item ${card.t}-border`;
        const costType = card.cur === 'd' ? 'ğŸ’' : 'ğŸ“€';
        div.innerHTML = `
            <img>${card.i}</img>
            <div class="card-name">${card.n}</div>
            <div class="card-profit">+${card.pr.toLocaleString()}/s</div>
            <div class="card-price">${costType} ${card.p.toLocaleString()}</div>
            <button class="btn btn-gold" onclick="buyCard(${card.id})">Upgrade</button>
        `;
        container.appendChild(div);
    });
}

function buyCard(id) {
    const card = cards.find(x => x.id === id);
    if(card.cur === 'd') {
        if(s.d >= card.p) { s.d -= card.p; s.dpph += card.pr; notify("Upgrade qilindi!"); save(); }
        else notify("Olmos yetarli emas!", "red");
    } else {
        if(s.c >= card.p) { s.c -= card.p; s.pph += card.pr; notify("Upgrade qilindi!"); save(); }
        else notify("Tanga yetarli emas!", "red");
    }
}

function exchange(type) {
    let val = parseInt(document.getElementById('ex-amount').value);
    if(!val || val <= 0) return;
    if(type === 'c2d') {
        if(s.c >= val * 10000) { s.c -= (val*10000); s.d += val; notify("Almashtirildi!"); }
        else notify("Tanga yetarli emas!", "red");
    } else {
        if(s.d >= val) { s.d -= val; s.c += (val*8000); notify("Almashtirildi!"); }
        else notify("Olmos yetarli emas!", "red");
    }
    save(); updateUI();
}

// --- MINI GAME ---
let chestLock = false;
function playChest(n) {
    if(chestLock) return;
    chestLock = true;
    const win = Math.floor(Math.random() * 3) + 1;
    const el = document.getElementById('ch'+n);
    if(n === win) {
        el.innerText = "ğŸ’°"; s.c += 1000000; notify("1,000,000 Tanga yutdingiz! ğŸ‰");
    } else {
        el.innerText = "âŒ"; notify("Bo'sh...");
    }
    document.getElementById('btn-reset-game').style.display = 'block';
    save(); updateUI();
}
function resetChests() {
    runAd(() => {
        chestLock = false;
        for(let i=1; i<=3; i++) document.getElementById('ch'+i).innerText = "ğŸ“¦";
        document.getElementById('btn-reset-game').style.display = 'none';
    });
}

// --- AIRDROP TIMER ---
const targetDate = new Date().getTime() + (99 * 24 * 60 * 60 * 1000);
setInterval(() => {
    const now = new Date().getTime();
    const d = targetDate - now;
    const days = Math.floor(d / (1000 * 60 * 60 * 24));
    const hours = Math.floor((d % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    const minutes = Math.floor((d % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((d % (1000 * 60)) / 1000);
    document.getElementById('airdrop-timer').innerText = `${days}d ${hours}h ${minutes}m ${seconds}s gacha Airdrop! ğŸš€`;
}, 1000);

// --- UTILS ---
function openPage(id) { 
    document.getElementById(id).style.display = 'block'; 
    if(id === 'p-rank') loadRank();
}
function closePage(id) { document.getElementById(id).style.display = 'none'; }

function notify(m, color = "gold") {
    const t = document.getElementById('toast');
    t.innerText = m; t.style.display = 'block'; t.style.borderColor = color === 'red' ? '#e74c3c' : '#ffd700';
    setTimeout(() => t.style.display = 'none', 2500);
}

function loadRank() {
    db.ref('users').orderByChild('c').limitToLast(10).once('value', snap => {
        let h = '';
        snap.forEach(u => {
            const d = u.val();
            h = `<div class="rank-row"><span>${d.first_name || 'O\'yinchi'}</span><b>${Math.floor(d.c).toLocaleString()} ğŸ“€</b></div>` + h;
        });
        document.getElementById('rank-list').innerHTML = h;
    });
}

function save() { db.ref('users/' + user.id).update({...s, first_name: user.first_name}); }

function createTapAnim(e) {
    const el = document.createElement('div');
    el.innerText = `+${s.tap}`;
    el.style.position = 'fixed'; el.style.left = e.clientX + 'px'; el.style.top = e.clientY + 'px';
    el.style.color = 'white'; el.style.fontWeight = 'bold'; el.style.pointerEvents = 'none';
    el.style.zIndex = '2000'; el.style.transition = 'all 0.5s';
    document.body.appendChild(el);
    setTimeout(() => { el.style.transform = 'translateY(-50px)'; el.style.opacity = '0'; }, 10);
    setTimeout(() => el.remove(), 600);
}

function runAd(cb) {
    if(typeof show_10558007 === 'function') show_10558007().then(cb).catch(cb);
    else if(cb) cb();
}

// Passive Income
setInterval(() => {
    s.c += (s.pph / 3600);
    s.d += (s.dpph / 3600);
    s.e = Math.min(s.maxE, s.e + 1);
    updateUI();
}, 1000);

// AutoSave
setInterval(save, 30000);

init();
tg.expand();
</script>
</body>
        </html>
        
    
    
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

