<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga - Passive Pro</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://alwingulla.com/tag.min.js" data-zone="10558007" async></script>
    
    <style>
        :root { --bg: #0b101b; --card: #151c2c; --accent: #f39c12; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; text-align: center; user-select: none; overflow-x: hidden; }
        
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 15px; }
        .stat-card { background: var(--card); border: 1.5px solid #2c3e50; border-radius: 12px; padding: 8px; }
        .stat-label { font-size: 10px; color: #888; display: block; }
        .stat-val { color: var(--accent); font-weight: bold; font-size: 13px; }

        .main-score { font-size: 55px; font-weight: 900; color: #f1c40f; margin-top: 15px; }
        .diamond-info { color: #3498db; margin-bottom: 15px; font-weight: bold; }
        
        .tanga-wrapper { position: relative; display: inline-block; margin: 15px auto; }
        .tanga-btn { 
            width: 220px; height: 220px; border-radius: 50%; 
            background: radial-gradient(circle, #f1c40f 0%, #d4ac0d 100%);
            border: 8px solid #91760b; display: flex; align-items: center; justify-content: center;
            font-size: 75px; font-weight: bold; transition: 0.1s;
        }
        .tanga-btn:active { transform: scale(0.95); }

        .side-icon { position: absolute; width: 60px; height: 60px; border-radius: 50%; border: 3px solid #d4ac0d; top: 50%; transform: translateY(-50%); display: flex; align-items: center; justify-content: center; font-size: 28px; background: #111; z-index: 10; }
        .icon-left { left: -25px; } .icon-right { right: -25px; background: conic-gradient(red, yellow, green, blue, red); }

        .energy-section { width: 85%; margin: 20px auto; }
        .energy-bar-bg { width: 100%; height: 12px; background: #2c3e50; border-radius: 10px; overflow: hidden; }
        .energy-fill { height: 100%; background: linear-gradient(to right, #f1c40f, #e67e22); width: 100%; transition: 0.3s; }

        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #0a0e17; border-top: 1px solid #1a2533; padding: 12px 0; }
        .nav-item { flex: 1; font-size: 11px; color: #666; }
        .nav-item b { font-size: 20px; display: block; margin-bottom: 3px; }

        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 100; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .modal.active { display: block; }
        .item-card { background: var(--card); border-radius: 15px; padding: 15px; margin-bottom: 12px; border: 1px solid #2c3e50; text-align: left; }
        .btn-gold { background: #f39c12; color: black; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; margin-top: 8px; }

        .leader-item { background: var(--card); padding: 12px; border-radius: 10px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .me { border: 2px solid #f1c40f; background: rgba(243, 156, 18, 0.1); }
    </style>
</head>
<body>

    <audio id="bgMusic" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"></audio>

    <div id="game-ui">
        <div class="stats-grid">
            <div class="stat-card"><span class="stat-label">STATUS</span><span id="st-val" class="stat-val">Bronza</span></div>
            <div class="stat-card"><span class="stat-label">SOATIGA</span><span id="h-val" class="stat-val">0</span></div>
            <div class="stat-card"><span class="stat-label">TAP KUCHI</span><span id="p-val" class="stat-val">1</span></div>
        </div>

        <div class="main-score" id="score-ui">0</div>
        <div class="diamond-info">üíé <span id="diam-ui">0</span></div>

        <div class="tanga-wrapper">
            <div class="side-icon icon-left" onclick="showModal('daily')">üéÅ</div>
            <div class="tanga-btn" id="tanga-main" onclick="handleTap(event)">1</div>
            <div class="side-icon icon-right" onclick="showModal('spin')">üé°</div>
        </div>

        <div class="energy-section">
            <div style="margin-bottom:5px;">‚ö° <span id="e-current">500</span> / <span id="e-max">500</span></div>
            <div class="energy-bar-bg"><div id="e-fill" class="energy-fill"></div></div>
        </div>
    </div>

    <div id="booster-modal" class="modal">
        <h2>‚ö° Boosterlar</h2>
        <div class="item-card"><b>Tap Kuchi (+1)</b><br><small>Narxi: 500 üí∞</small><button class="btn-gold" onclick="buy('tap', 500)">LEVEL UP</button></div>
        <div class="item-card"><b>Soatbay Foyda (+100)</b><br><small>Narxi: 1000 üí∞</small><button class="btn-gold" onclick="buy('hour', 1000)">LEVEL UP</button></div>
        <div class="item-card"><b>Max Energiya (+500)</b><br><small>Narxi: 2000 üí∞</small><button class="btn-gold" onclick="buy('energy', 2000)">LEVEL UP</button></div>
        <button class="btn-gold" style="background:#444; color:white;" onclick="closeAll()">YOPISH</button>
    </div>

    <div id="leader-modal" class="modal">
        <h2>üìä Reyting (Top O'yinchilar)</h2>
        <div id="leader-list"></div>
        <button class="btn-gold" style="background:#444; color:white; margin-top:20px;" onclick="closeAll()">YOPISH</button>
    </div>

    <div class="nav">
        <div class="nav-item" onclick="alert('Market tez kunda!')"><b>üõí</b>MARKET</div>
        <div class="nav-item" onclick="alert('Referal tez kunda!')"><b>üë•</b>REFERAL</div>
        <div class="nav-item" onclick="showModal('leader')"><b>üìä</b>REYTING</div>
        <div class="nav-item" onclick="showModal('booster')"><b>‚ö°</b>BOOSTER</div>
        <div class="nav-item" onclick="alert('Uyim tez kunda!')"><b>üè†</b>UYIM</div>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIza...", databaseURL: "https://your-db.firebaseio.com" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const tg = window.Telegram.WebApp;
        const user = tg.initDataUnsafe.user || { id: "7462622808", first_name: "Ganiyev Diyorbek" };
        
        let s = { coins: 0, diams: 0, energy: 500, maxE: 500, power: 1, hourly: 0, lastSeen: Date.now() };

        function init() {
            tg.expand();
            loadData();
            setInterval(loop, 1000);
            document.addEventListener('click', () => { document.getElementById('bgMusic').play().catch(()=>{}); }, {once: true});
        }

        function loop() {
            s.coins += (s.hourly / 3600);
            if(s.energy < s.maxE) s.energy += 0.5;
            s.lastSeen = Date.now(); // Har soniyada vaqtni yangilash
            updateUI();
            if(Math.floor(s.coins) % 10 === 0) saveData(); // Har 10 tangada bir marta bazaga yozish (yuklamani kamaytirish uchun)
        }

        function handleTap(e) {
            if(s.energy >= s.power) {
                s.coins += s.power;
                s.energy -= s.power;
                updateUI();
                saveData();
            }
        }

        function buy(type, price) {
            if(s.coins >= price) {
                s.coins -= price;
                if(type==='tap') s.power++;
                if(type==='hour') s.hourly += 100;
                if(type==='energy') { s.maxE += 500; s.energy += 500; }
                saveData(); updateUI();
            } else { alert("Mablag' yetarli emas!"); }
        }

        function updateUI() {
            document.getElementById('score-ui').innerText = Math.floor(s.coins).toLocaleString();
            document.getElementById('diam-ui').innerText = s.diams;
            document.getElementById('e-current').innerText = Math.floor(s.energy);
            document.getElementById('e-max').innerText = s.maxE;
            document.getElementById('e-fill').style.width = (s.energy / s.maxE * 100) + "%";
            document.getElementById('p-val').innerText = s.power;
            document.getElementById('h-val').innerText = s.hourly;
            document.getElementById('tanga-main').innerText = s.power;
        }

        function saveData() {
            db.ref('users/' + user.id).set(s);
            db.ref('leaderboard/' + user.id).set({name: user.first_name, coins: Math.floor(s.coins)});
        }

        function loadData() {
            db.ref('users/' + user.id).once('value', (snap) => {
                if(snap.exists()) {
                    let data = snap.val();
                    let now = Date.now();
                    let diff = (now - data.lastSeen) / 1000; // Yo'q bo'lgan vaqt (soniya)
                    let offlineEarnings = (data.hourly / 3600) * diff;

                    if(offlineEarnings > 1) {
                        alert(`Siz yo'qligingizda soatbay daromad hisobiga ${Math.floor(offlineEarnings)} üí∞ yig'ildi!`);
                        data.coins += offlineEarnings;
                    }
                    s = {...s, ...data};
                    updateUI();
                }
            });

            // Reyting faqat bazadagi foydalanuvchilar
            db.ref('leaderboard').orderByChild('coins').limitToLast(15).on('value', (snap) => {
                let list = [];
                snap.forEach(c => { if(c.key !== String(user.id)) list.push(c.val()); });
                list.reverse();
                let html = `<div class="leader-item me">1. ${user.first_name} (Siz) <b>${Math.floor(s.coins).toLocaleString()}</b></div>`;
                list.forEach((p, i) => {
                    html += `<div class="leader-item">${i+2}. ${p.name} <b>${p.coins.toLocaleString()}</b></div>`;
                });
                document.getElementById('leader-list').innerHTML = html;
            });
        }

        function showModal(id) { closeAll(); document.getElementById(id + '-modal').classList.add('active'); }
        function closeAll() { document.querySelectorAll('.modal').forEach(x => x.classList.remove('active')); }

        init();
    </script>
</body>
    </html>
    
                                        
                                                                                 </html>

    
    
    
                                                                                              

        

    
                                                           </html>
            
                                                      
                

