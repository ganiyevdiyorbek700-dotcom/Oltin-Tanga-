<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga - Pro Max</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <script src="//libtl.com/sdk.js" data-zone="10558007" data-sdk="show_10558007"></script>

    <style>
        :root { --gold: #ffd700; --bg: #0b0d17; --card: #1c222d; --green: #2ecc71; --red: #e74c3c; --blue: #0088cc; --orange: #ffa500; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }

        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; pointer-events: none; }
        .moon-bg { background: radial-gradient(circle at top right, #f5f3ce, transparent 40%); }
        .ice-bg { background: linear-gradient(to bottom, #a5f3fc, transparent); }
        .space-bg { background: url('https://www.transparenttextures.com/patterns/stardust.png'), #000; }

        .top-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 12px; background: rgba(0,0,0,0.6); }
        .stat-box { background: var(--card); padding: 6px; border-radius: 8px; text-align: center; border: 1px solid #333; }
        .stat-box small { font-size: 10px; color: #aaa; display: block; }
        .stat-box b { font-size: 13px; color: var(--gold); }

        .game-area { display: flex; flex-direction: column; align-items: center; justify-content: flex-end; height: 62vh; padding-bottom: 30px; }
        #balance-main { color: var(--gold); font-size: 38px; margin-bottom: 10px; font-weight: bold; text-shadow: 0 0 10px rgba(255,215,0,0.3); }
        .coin-wrapper { width: 230px; height: 230px; cursor: pointer; transition: transform 0.05s; }
        .coin-main { width: 100%; height: 100%; background: radial-gradient(circle, #ffe066, #ffb300); border-radius: 50%; border: 10px solid #cc8e00; display: flex; align-items: center; justify-content: center; font-size: 40px; color: #4d3300; box-shadow: 0 0 30px rgba(255,215,0,0.2); }
        .coin-wrapper:active { transform: scale(0.92); }

        .energy-container { width: 80%; text-align: center; margin-top: 15px; }
        .energy-bar-bg { width: 100%; height: 10px; background: #222; border-radius: 5px; overflow: hidden; margin-top: 5px; }
        #energy-fill { height: 100%; background: var(--gold); width: 100%; transition: width 0.2s; }

        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #07090c; display: flex; justify-content: space-around; padding: 15px 5px; border-top: 1px solid #222; z-index: 100; }
        .nav-btn { color: #666; text-align: center; font-size: 11px; flex: 1; cursor: pointer; }
        .nav-btn.active { color: var(--gold); }

        .page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 200; padding: 20px; display: none; overflow-y: auto; padding-bottom: 110px; }
        .card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #333; position: relative; }
        .btn { width: 100%; padding: 14px; border: none; border-radius: 10px; font-weight: bold; background: var(--gold); color: #000; cursor: pointer; margin-top: 8px; font-size: 15px; }
        .lock-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); border-radius:15px; display:flex; align-items:center; justify-content:center; color: #ff4d4d; font-weight:bold; z-index: 5; text-align: center;}

        #notify { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 12px 20px; border-radius: 30px; z-index: 3000; display: none; font-weight: bold; text-align: center; color: white; }
    </style>
</head>
<body>

<div id="notify"></div>
<div id="bg-fx" class="bg-overlay"></div>

<div class="top-stats">
    <div class="stat-box"><small>ğŸ“€ Tanga/soat</small><b id="coin-pph-val">0</b></div>
    <div class="stat-box"><small>ğŸ’ Olmos/soat</small><b id="diam-pph-val">0</b></div>
    <div class="stat-box"><small>ğŸ’ Olmoslar</small><b id="diam-total-val">0</b></div>
    <div class="stat-box"><small>â­ Daraja</small><b id="lvl-val">1</b></div>
</div>

<div class="game-area">
    <div id="balance-main">0</div>
    <div class="coin-wrapper" onclick="handleTap(event)">
        <div class="coin-main" id="tap-power-val">+1</div>
    </div>
    <div class="energy-container">
        <span>âš¡ <span id="e-text">500/500</span></span>
        <div class="energy-bar-bg"><div id="energy-fill"></div></div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-btn" onclick="openPage('p-market')">Market</div>
    <div class="nav-btn" onclick="openPage('p-bonus')">Bonus</div>
    <div class="nav-btn" onclick="openPage('p-rank')">Rank</div>
    <div class="nav-btn" onclick="openPage('p-boost')">Booster</div>
    <div class="nav-btn" onclick="openPage('p-home')">Profil</div>
</div>

<div id="p-market" class="page">
    <span style="float:right; font-size:30px;" onclick="closePage('p-market')">âœ–</span>
    <h2>Market ğŸ›’</h2>
    <div class="card"><b>ğŸŸ« Bronza</b><p>+10 ğŸ’/soat. Narxi: 100 ğŸ’</p><button class="btn" onclick="buyItem('bronze', 100)">Sotib olish</button></div>
    <div class="card"><b>â¬œ Kumush</b><p>+15 ğŸ’/soat. Narxi: 200 ğŸ’</p><button class="btn" onclick="buyItem('silver', 200)">Sotib olish</button></div>
    <div class="card"><div id="lock-gold" class="lock-overlay">Lvl 3 kerak!</div><b>ğŸŸ¨ Oltin</b><p>+25 ğŸ’/soat. Narxi: 350 ğŸ’</p><button class="btn" onclick="buyItem('gold', 350)">Sotib olish</button></div>
    <div class="card"><div id="lock-emerald" class="lock-overlay">Lvl 3 kerak!</div><b>ğŸŸ© Zumrad</b><p>+35 ğŸ’/soat. Narxi: 500 ğŸ’</p><button class="btn" onclick="buyItem('emerald', 500)">Sotib olish</button></div>
    <div class="card"><div id="lock-plat" class="lock-overlay">Lvl 7 kerak!</div><b>ğŸ’ Platina</b><p>+100 ğŸ’/soat. Narxi: 1000 ğŸ’</p><button class="btn" onclick="buyItem('platinum', 1000)">Sotib olish</button></div>
    <div class="card"><div id="lock-cosmic" class="lock-overlay">Lvl 7 kerak!</div><b>ğŸŒŒ Kosmik</b><p>+250 ğŸ’/soat. Narxi: 5000 ğŸ’</p><button class="btn" onclick="buyItem('cosmic', 5000)">Sotib olish</button></div>
</div>

<div id="p-bonus" class="page">
    <span style="float:right; font-size:30px;" onclick="closePage('p-bonus')">âœ–</span>
    <h2>Bonuslar ğŸ</h2>
    <div class="card"><h3>Kanal Vazifasi</h3><button class="btn" onclick="goTask()">Kanalga o'tish</button><button class="btn" style="background:var(--green);" onclick="checkTask()">Tekshirish & Olish</button></div>
    <div class="card"><h3>Kunlik Bonus ğŸ¬</h3><button class="btn" onclick="claimDaily()">5,000 ğŸ“€ Olish</button></div>
    <div class="card"><h3>Omadli Tanga ğŸ¬</h3><p id="lucky-count">Imkoniyat: 3/3</p><button class="btn" onclick="claimLucky()">Yutib olish</button></div>
</div>

<div id="p-rank" class="page"><span style="float:right; font-size:30px;" onclick="closePage('p-rank')">âœ–</span><h2>Reyting ğŸ†</h2><div id="rank-list"></div></div>

<div id="p-boost" class="page">
    <span style="float:right; font-size:30px;" onclick="closePage('p-boost')">âœ–</span>
    <h2>Booster âš¡</h2>
    <div class="card"><b>Mining</b> (PPH) <button class="btn" onclick="buyBoost('pph')">Narxi: <span id="c-pph">500</span></button></div>
    <div class="card"><b>Energiya</b> <button class="btn" onclick="buyBoost('energy')">Narxi: <span id="c-e">500</span></button></div>
    <div class="card"><b>Tap</b> <button class="btn" onclick="buyBoost('tap')">Narxi: <span id="c-tap">500</span></button></div>
</div>

<div id="p-home" class="page">
    <span style="float:right; font-size:30px;" onclick="closePage('p-home')">âœ–</span>
    <h2>Profil ğŸ‘¤</h2>
    <div class="card">Ism: <b id="u-name">...</b><br>ID: <b id="u-id">...</b><br>Tangalar: <b id="p-coins">0</b><br>Olmoslar: <b id="p-diams">0</b></div>
    <button class="btn" style="background:var(--blue); color:white;" onclick="showNotify('Tez kunda! Minimal 5 TON','orange')">TON Chiqarish</button>
</div>

<script>
// Firebase sozlamalari
const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" };
if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tg = window.Telegram.WebApp;
const user = tg.initDataUnsafe?.user || { id: "12345", first_name: "Mehmon" };

let s = { coins: 0, diamonds: 0, lvl: 1, pphCoin: 0, pphDiam: 0, energy: 500, maxE: 500, tap: 1, tapLvl: 1, pphLvl: 1, eLvl: 1, lastD: 0, luckyC: 3, skin: 'default', taskDone: false, lastTime: Date.now() };

// REKLAMA FUNKSIYASI (Siz bergan koddan)
function runAd(callback) {
    if (typeof show_10558007 === 'function') {
        show_10558007().then(() => { if(callback) callback(); });
    } else { if(callback) callback(); }
}

// Ma'lumotlarni yuklash
db.ref('users/' + user.id).on('value', snap => {
    if(snap.exists()) {
        let data = snap.val();
        let now = Date.now();
        // Offline mining
        if(data.lastTime) {
            let diff = Math.floor((now - data.lastTime)/1000);
            if(diff > 10) {
                s.coins = (data.coins || 0) + (data.pphCoin / 3600) * Math.min(diff, 86400);
                s.diamonds = (data.diamonds || 0) + (data.pphDiam / 3600) * Math.min(diff, 86400);
                s.energy = Math.min(data.maxE || 500, (data.energy || 0) + diff);
            } else { Object.assign(s, data); }
        } else { Object.assign(s, data); }
    }
    updateUI();
});

function updateUI() {
    // Level tizimi
    const levels = [0, 50000, 100000, 500000, 1000000, 10000000, 50000000, 100000000];
    let clvl = 1; levels.forEach((v, i) => { if(s.coins >= v) clvl = i+1; });
    s.lvl = clvl;

    document.getElementById('balance-main').innerText = Math.floor(s.coins).toLocaleString();
    document.getElementById('coin-pph-val').innerText = s.pphCoin;
    document.getElementById('diam-pph-val').innerText = s.pphDiam;
    document.getElementById('diam-total-val').innerText = Math.floor(s.diamonds).toLocaleString();
    document.getElementById('lvl-val').innerText = s.lvl;
    document.getElementById('tap-power-val').innerText = "+" + s.tap;
    document.getElementById('e-text').innerText = Math.floor(s.energy) + "/" + s.maxE;
    document.getElementById('energy-fill').style.width = (s.energy/s.maxE*100) + "%";
    
    document.getElementById('u-name').innerText = user.first_name;
    document.getElementById('u-id').innerText = user.id;
    document.getElementById('p-coins').innerText = Math.floor(s.coins).toLocaleString();
    document.getElementById('p-diams').innerText = Math.floor(s.diamonds).toLocaleString();
    document.getElementById('lucky-count').innerText = `Imkoniyat: ${s.luckyC}/3`;

    // Boster narxlari
    document.getElementById('c-pph').innerText = (500 * Math.pow(2, s.pphLvl-1)).toLocaleString();
    document.getElementById('c-e').innerText = (500 * Math.pow(2, s.eLvl-1)).toLocaleString();
    document.getElementById('c-tap').innerText = (500 * Math.pow(2, s.tapLvl-1)).toLocaleString();

    // Qulflar
    document.getElementById('lock-gold').style.display = s.lvl >= 3 ? 'none' : 'flex';
    document.getElementById('lock-emerald').style.display = s.lvl >= 3 ? 'none' : 'flex';
    document.getElementById('lock-plat').style.display = s.lvl >= 7 ? 'none' : 'flex';
    document.getElementById('lock-cosmic').style.display = s.lvl >= 7 ? 'none' : 'flex';

    // Skinlar
    const bg = document.getElementById('bg-fx');
    bg.className = 'bg-overlay';
    if(s.skin === 'gold') bg.classList.add('moon-bg');
    if(s.skin === 'platinum') bg.classList.add('ice-bg');
    if(s.skin === 'cosmic') bg.classList.add('space-bg');
}

function handleTap(e) {
    if(s.energy >= s.tap) {
        s.coins += s.tap; s.energy -= s.tap; updateUI();
    } else {
        showNotify("Energiya tugadi! Reklama ko'rib to'ldiring", "red");
        runAd(() => { s.energy = s.maxE; updateUI(); showNotify("Energiya tiklandi!âš¡", "green"); });
    }
}

function buyItem(id, price) {
    if(s.diamonds >= price) {
        s.diamonds -= price;
        if(id === 'bronze') s.pphDiam += 10;
        if(id === 'silver') s.pphDiam += 15;
        if(id === 'gold') { s.pphDiam += 25; s.skin = 'gold'; }
        if(id === 'emerald') s.pphDiam += 35;
        if(id === 'platinum') { s.pphDiam += 100; s.skin = 'platinum'; }
        if(id === 'cosmic') { s.pphDiam += 250; s.skin = 'cosmic'; }
        save(); showNotify("Sotib olindi! âœ…", "green");
    } else showNotify("Olmos yetarli emas!", "red");
}

function buyBoost(type) {
    let cost = 0;
    if(type==='pph') cost = 500 * Math.pow(2, s.pphLvl-1);
    if(type==='energy') cost = 500 * Math.pow(2, s.eLvl-1);
    if(type==='tap') cost = 500 * Math.pow(2, s.tapLvl-1);

    if(s.coins >= cost) {
        s.coins -= cost;
        if(type==='pph') { s.pphLvl++; s.pphCoin += 100; }
        if(type==='energy') { s.eLvl++; s.maxE += 500; s.energy = s.maxE; }
        if(type==='tap') { s.tapLvl++; s.tap++; }
        save(); updateUI();
    } else showNotify("Tangalar yetarli emas!", "red");
}

function claimDaily() {
    let now = Date.now();
    if(now - s.lastD > 86400000) {
        runAd(() => { s.coins += 5000; s.lastD = now; save(); showNotify("+5,000 ğŸ“€ berildi!", "green"); });
    } else showNotify("Hali vaqt bor!", "red");
}

function claimLucky() {
    if(s.luckyC > 0) {
        runAd(() => {
            let win = Math.floor(Math.random()*10001);
            s.coins += win; s.luckyC--; save();
            showNotify(`+${win} ğŸ“€ yutdingiz!`, "green");
        });
    } else showNotify("Imkoniyat qolmadi!", "red");
}

function goTask() { tg.openTelegramLink("https://t.me/Telefon_bozor_uz_n1"); s.clicked = true; }
function checkTask() {
    if(!s.taskDone && s.clicked) {
        s.coins += 10000; s.diamonds += 10; s.taskDone = true; save();
        showNotify("Vazifa bajarildi! âœ…", "green");
    } else showNotify("Avval kanalga o'ting!", "red");
}

function loadRank() {
    db.ref('users').orderByChild('coins').limitToLast(15).once('value', snap => {
        let list = []; snap.forEach(c => {
            let d = c.val();
            list.push({name: d.first_name || "User", id: c.key, coins: d.coins || 0, lvl: d.lvl || 1, diam: d.diamonds || 0});
        });
        list.sort((a,b) => b.coins - a.coins);
        let h = '';
        list.forEach((u, i) => {
            h += `<div style="background:#161b22; padding:10px; border-radius:10px; margin-bottom:8px; border:1px solid #333; display:flex; justify-content:space-between; align-items:center;">
                <div><b>#${i+1} ${u.name}</b><br><small style="color:#666">ID:${u.id} | Lvl:${u.lvl}</small></div>
                <div style="text-align:right"><b>${Math.floor(u.coins).toLocaleString()} ğŸ“€</b><br><small>ğŸ’${Math.floor(u.diam)}</small></div>
            </div>`;
        });
        document.getElementById('rank-list').innerHTML = h;
    });
}

function openPage(id) { 
    document.getElementById(id).style.display = 'block'; 
    if(id === 'p-rank') loadRank();
    if(['p-market', 'p-boost', 'p-bonus'].includes(id)) runAd(); // Bo'limga o'tganda reklama
}
function closePage(id) { document.getElementById(id).style.display = 'none'; }

function showNotify(m, c) {
    let n = document.getElementById('notify'); n.innerText = m;
    n.style.background = c === 'green' ? '#2ecc71' : (c === 'orange' ? '#ffa500' : '#e74c3c');
    n.style.display = 'block'; setTimeout(() => n.style.display = 'none', 2500);
}

function save() { s.lastTime = Date.now(); db.ref('users/' + user.id).update(s); }

// Avtomatik tiklanish va mining
setInterval(() => {
    if(s.energy < s.maxE) s.energy = Math.min(s.maxE, s.energy + 1);
    if(s.pphCoin > 0) s.coins += (s.pphCoin / 3600);
    if(s.pphDiam > 0) s.diamonds += (s.pphDiam / 3600);
    updateUI();
}, 1000);

setInterval(save, 30000); // Har 30 soniyada saqlash
tg.expand();
</script>
</body>
                          </html>
    
    
    
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

