<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga Platinum - Final</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://alwingulla.com/tag.min.js" data-zone="10558007" async></script>
    
    <style>
        :root { --bg: #0b0f19; --card: #161d2b; --accent: #f1c40f; }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; text-align: center; user-select: none; overflow-x: hidden; }
        
        /* Stats Grid */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 15px; }
        .stat-card { background: var(--card); border: 1px solid #2c3e50; border-radius: 12px; padding: 10px; }
        .stat-label { font-size: 10px; color: #888; display: block; margin-bottom: 4px; }
        .stat-val { color: var(--accent); font-weight: bold; font-size: 14px; }

        /* Tanga Dynamic Styles */
        .tanga-btn { 
            width: 230px; height: 230px; border-radius: 50%; margin: 25px auto;
            display: flex; align-items: center; justify-content: center;
            font-size: 70px; font-weight: bold; border: 10px solid rgba(255,255,255,0.1);
            transition: transform 0.1s, background 0.5s; cursor: pointer;
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
        }
        .tanga-btn:active { transform: scale(0.92); }
        
        /* Tanga Ranglari */
        .tanga-gold { background: radial-gradient(circle, #f1c40f, #d4ac0d); }
        .tanga-red { background: radial-gradient(circle, #e74c3c, #c0392b); box-shadow: 0 0 30px rgba(231, 76, 60, 0.4); }
        .tanga-green { background: radial-gradient(circle, #2ecc71, #27ae60); box-shadow: 0 0 30px rgba(46, 204, 113, 0.4); }
        .tanga-blue { background: radial-gradient(circle, #3498db, #2980b9); box-shadow: 0 0 30px rgba(52, 152, 219, 0.4); }
        .tanga-purple { background: radial-gradient(circle, #9b59b6, #8e44ad); box-shadow: 0 0 30px rgba(155, 89, 182, 0.4); }
        .tanga-black { background: radial-gradient(circle, #2c3e50, #000000); box-shadow: 0 0 35px rgba(255, 255, 255, 0.1); }

        /* Modals */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 1000; padding: 20px; box-sizing: border-box; overflow-y: auto; }
        .modal.active { display: block; }
        .item-card { background: var(--card); border-radius: 15px; padding: 18px; margin-bottom: 12px; border: 1px solid #2c3e50; text-align: left; }
        .btn-main { background: var(--accent); color: black; border: none; padding: 14px; border-radius: 10px; width: 100%; font-weight: bold; margin-top: 10px; cursor: pointer; font-size: 16px; }
        
        /* Navigation */
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #0a0e17; border-top: 1px solid #1a2533; padding: 12px 0; z-index: 99; }
        .nav-item { flex: 1; font-size: 10px; color: #888; cursor: pointer; }
        .nav-item b { font-size: 18px; display: block; margin-bottom: 2px; }

        /* Energy Bar */
        .energy-box { width: 85%; margin: 20px auto; }
        .energy-bar { width: 100%; height: 10px; background: #1a2332; border-radius: 10px; overflow: hidden; margin-top: 8px; }
        .energy-fill { height: 100%; background: linear-gradient(90deg, #f1c40f, #e67e22); transition: 0.3s; }
    </style>
</head>
<body>

<audio id="bgMusic" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"></audio>

<div id="main-ui">
    <div class="stats-grid">
        <div class="stat-card"><span class="stat-label">STATUS</span><span id="st-val" class="stat-val">Bronza</span></div>
        <div class="stat-card"><span class="stat-label">SOATIGA</span><span id="h-val" class="stat-val">0</span></div>
        <div class="stat-card"><span class="stat-label">OLMOS</span><span id="d-val" class="stat-val" style="color:#3498db">0</span></div>
    </div>

    <h1 style="font-size: 55px; margin: 25px 0 5px;" id="score">0</h1>
    <p style="color: #888; letter-spacing: 1px; margin-bottom: 15px;">üí∞ BALANS</p>

    <div id="tanga" class="tanga-btn tanga-gold" onclick="tap(event)">1</div>

    <div class="energy-box">
        <div style="display:flex; justify-content:space-between; font-size:13px;">
            <span>‚ö° <span id="e-cur">500</span> / <span id="e-max">500</span></span>
            <span id="p-text">Tap: 1</span>
        </div>
        <div class="energy-bar"><div id="e-fill" class="energy-fill" style="width: 100%;"></div></div>
    </div>
</div>

<div id="daily-modal" class="modal">
    <h2 style="color:var(--accent)">üéÅ Kunlik Bonus</h2>
    <div class="item-card">
        Har 24 soatda bepul bonus oling! <br>
        <span id="d-timer" style="color:#e74c3c; font-weight:bold; font-size:18px; display:block; margin:10px 0;">00:00:00</span>
        <button class="btn-main" id="d-btn" onclick="claimDaily(false)">5,000 üí∞ OLISH</button>
        <button class="btn-main" style="background:#e67e22" onclick="claimDaily(true)">10,000 üí∞ (REKLAMA)</button>
    </div>
    <button class="btn-main" style="background:#333; color:white" onclick="closeAll()">YOPISH</button>
</div>

<div id="ref-modal" class="modal">
    <h2 style="color:var(--accent)">üë• Referal Tizimi</h2>
    <div class="item-card">Taklif uchun: <b>25,000 üí∞</b><br>Do'stlaringiz: <b id="ref-count">0</b></div>
    <div class="item-card">
        <small>Sizning havolangiz:</small><br>
        <code id="ref-link" style="color:var(--accent); word-break: break-all;">...</code>
        <button class="btn-main" onclick="copyRef()">NUSXALASH</button>
    </div>
    <button class="btn-main" style="background:#27ae60; color:white" onclick="alert('Referal tangalar bazaga qo\'shildi!')">OLISH</button>
    <button class="btn-main" style="background:#333; color:white" onclick="closeAll()">YOPISH</button>
</div>

<div id="leader-modal" class="modal">
    <h2 style="color:var(--accent)">üìä Reyting (Top 20)</h2>
    <div id="leader-list"></div>
    <button class="btn-main" style="background:#333; color:white" onclick="closeAll()">YOPISH</button>
</div>

<div id="home-modal" class="modal">
    <h2 style="color:var(--accent)">üè† Mening Uyim</h2>
    <div class="item-card">Ism: <b id="u-name">...</b><br>ID: <b id="u-id">...</b></div>
    <div class="item-card">üí∞ Tanga: <span id="u-c">0</span><br>üíé Olmos: <span id="u-d">0</span></div>
    <button class="btn-main" style="background:linear-gradient(45deg, #8e44ad, #c33d7b); color:white">üöÄ AIRDROP (YAQINDA)</button>
    <button class="btn-main" style="background:#333; color:white" onclick="closeAll()">YOPISH</button>
</div>

<nav class="nav">
    <div class="nav-item" onclick="openM('ref')"><b>üë•</b>REF</div>
    <div class="nav-item" onclick="openM('leader')"><b>üìä</b>REYTING</div>
    <div class="nav-item" onclick="openM('daily')"><b>üéÅ</b>BONUS</div>
    <div class="nav-item" onclick="alert('Market yaqinda ochiq!')"><b>üõí</b>MARKET</div>
    <div class="nav-item" onclick="openM('home')"><b>üè†</b>UYIM</div>
</nav>

<script>
    // --- SIZNING FIREBASE MA'LUMOTLARINGIZ ---
    const firebaseConfig = {
      apiKey: "AIzaSyDbttlr-oGJeDbjMbrubcuspgg9gk-7Gxs",
      authDomain: "oltin-tanga-d2c80.firebaseapp.com",
      databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com",
      projectId: "oltin-tanga-d2c80",
      storageBucket: "oltin-tanga-d2c80.firebasestorage.app",
      messagingSenderId: "954210050924",
      appId: "1:954210050924:web:f57b75568c66216c49c949",
      measurementId: "G-EWL8L281KQ"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const tg = window.Telegram.WebApp;
    const user = tg.initDataUnsafe.user || { id: "8009403510", first_name: "Diyorbek" };

    let s = { coins: 0, diams: 0, power: 1, hourly: 0, energy: 500, maxE: 500, lastDaily: 0, lastSeen: Date.now() };

    function init() {
        tg.expand();
        document.getElementById('u-name').innerText = user.first_name;
        document.getElementById('u-id').innerText = user.id;
        document.getElementById('ref-link').innerText = `t.me/OltinTanga1_bot?start=${user.id}`;
        
        loadData();
        setInterval(gameLoop, 1000);
        
        // Musiqa va Reklama integratsiyasi
        document.addEventListener('click', () => { 
            document.getElementById('bgMusic').play().catch(()=>{}); 
        }, {once:true});
    }

    function gameLoop() {
        s.coins += (s.hourly / 3600);
        if(s.energy < s.maxE) s.energy += 0.5;
        updateUI();
        if(Math.floor(s.coins) % 25 === 0) saveData();
    }

    function tap(e) {
        if(s.energy >= s.power) {
            s.coins += s.power; s.energy -= s.power;
            updateUI();
        }
    }

    function updateUI() {
        let c = Math.floor(s.coins);
        document.getElementById('score').innerText = c.toLocaleString();
        document.getElementById('u-c').innerText = c.toLocaleString();
        document.getElementById('d-val').innerText = s.diams;
        document.getElementById('u-d').innerText = s.diams;
        document.getElementById('e-cur').innerText = Math.floor(s.energy);
        document.getElementById('e-fill').style.width = (s.energy/s.maxE*100) + "%";
        document.getElementById('h-val').innerText = s.hourly;
        document.getElementById('p-text').innerText = "Tap: " + s.power;

        // Tanga Rangi
        let t = document.getElementById('tanga');
        t.className = "tanga-btn";
        if(c >= 5000000) t.classList.add('tanga-black');
        else if(c >= 1000000) t.classList.add('tanga-purple');
        else if(c >= 500000) t.classList.add('tanga-blue');
        else if(c >= 100000) t.classList.add('tanga-green');
        else if(c >= 50000) t.classList.add('tanga-red');
        else t.classList.add('tanga-gold');

        document.getElementById('st-val').innerText = getStatus(c);
        
        // Bonus Taymer
        let dDiff = 86400000 - (Date.now() - s.lastDaily);
        if(dDiff > 0) {
            document.getElementById('d-timer').innerText = formatTime(dDiff);
            document.getElementById('d-btn').disabled = true;
            document.getElementById('d-btn').style.opacity = "0.5";
        } else {
            document.getElementById('d-timer').innerText = "Tayyor!";
            document.getElementById('d-btn').disabled = false;
            document.getElementById('d-btn').style.opacity = "1";
        }
    }

    function getStatus(c) {
        if(c > 1000000) return "Qirol";
        if(c > 100000) return "Oltin";
        if(c > 50000) return "Kumush";
        return "Bronza";
    }

    function formatTime(ms) {
        let h = Math.floor(ms/3600000); let m = Math.floor((ms%3600000)/60000); let sec = Math.floor((ms%60000)/1000);
        return `${h}:${m < 10 ? '0'+m : m}:${sec < 10 ? '0'+sec : sec}`;
    }

    async function claimDaily(ad) {
        if(ad && window.show_10558007) {
            await window.show_10558007();
            s.coins += 10000;
        } else {
            s.coins += 5000;
        }
        s.lastDaily = Date.now();
        saveData();
        alert("Bonus qabul qilindi!");
        closeAll();
    }

    function copyRef() {
        navigator.clipboard.writeText(document.getElementById('ref-link').innerText);
        alert("Havola nusxalandi!");
    }

    function saveData() {
        db.ref('users/' + user.id).set({...s, lastSeen: Date.now()});
        db.ref('leaderboard/' + user.id).set({
            name: user.first_name, coins: Math.floor(s.coins), diams: s.diams, status: getStatus(s.coins)
        });
    }

    function loadData() {
        db.ref('users/' + user.id).once('value', (snap) => {
            if(snap.exists()) {
                let d = snap.val();
                let earned = (d.hourly / 3600) * ((Date.now() - (d.lastSeen || Date.now()))/1000);
                if(earned > 5) alert("Siz yo'qligingizda " + Math.floor(earned) + " üí∞ yig'ildi!");
                s = {...s, ...d, coins: (d.coins || 0) + earned};
            }
            updateUI();
        });

        db.ref('leaderboard').orderByChild('coins').limitToLast(20).on('value', (snap) => {
            let list = [];
            snap.forEach(c => { list.unshift({id: c.key, ...c.val()}); });
            
            // SIZNI HAR DOIM 1-O'RINGA QO'YISH MANTIQI
            let meIndex = list.findIndex(p => p.id == user.id);
            if(meIndex > -1) {
                let meData = list.splice(meIndex, 1)[0];
                list.unshift(meData);
            }

            let h = "";
            list.forEach((p, i) => {
                let isMe = p.id == user.id ? "border:2px solid gold; background:#1a2533;" : "";
                h += `<div class="item-card" style="display:flex; justify-content:space-between; align-items:center; ${isMe}">
                    <div><b>${i+1}. ${p.name}</b><br><small style="color:#888">${p.status}</small></div>
                    <div style="text-align:right">üí∞ ${Math.floor(p.coins).toLocaleString()}<br><small style="color:#3498db">üíé ${p.diams || 0}</small></div>
                </div>`;
            });
            document.getElementById('leader-list').innerHTML = h;
        });
    }

    function openM(id) { closeAll(); document.getElementById(id + '-modal').classList.add('active'); }
    function closeAll() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('active')); }

    init();
</script>
</body>
            </html>
            
        
    
    
                                        
                                                                                 </html>

    
    
    
                                                                                              

        

    
                                                           </html>
            
                                                      
                

