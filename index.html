<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga - Monetag Edition</title>
    
    <script src="https://alwingulla.com/88/pfe/current/tag.min.js?z=10558007" data-cfasync="false" async></script>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root { --gold: #ffd700; --bg: #0b0d17; --green: #2ecc71; --red: #e74c3c; }
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none; }
        body { margin: 0; background: var(--bg); color: white; font-family: sans-serif; overflow: hidden; }

        #toast { 
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%); 
            padding: 12px 25px; border-radius: 30px; z-index: 1000; font-weight: bold;
            display: none; box-shadow: 0 10px 20px rgba(0,0,0,0.5); 
        }

        .page { display: none; height: 100vh; padding: 20px; overflow-y: auto; padding-bottom: 110px; }
        .active { display: block; }

        /* Stats */
        .status-header { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .status-box { background: rgba(255,255,255,0.05); padding: 8px; border-radius: 10px; text-align: center; border: 1px solid #333; }
        .status-box small { font-size: 10px; color: #888; }
        .status-box b { color: var(--gold); font-size: 12px; display: block; }

        /* Coin */
        .coin-wrap { text-align: center; margin-top: 20px; }
        .main-coin { 
            width: 220px; height: 220px; border-radius: 50%; margin: 0 auto;
            background: url('goku.webp') center/cover; /* Rasm nomini tekshiring */
            border: 8px solid var(--gold); cursor: pointer; position: relative;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3); transition: 0.1s;
        }
        .main-coin:active { transform: scale(0.95); }

        .energy-bar { width: 80%; height: 12px; background: #222; border-radius: 10px; margin: 20px auto; overflow: hidden; }
        .energy-fill { height: 100%; background: linear-gradient(90deg, var(--gold), #e67e22); width: 100%; }

        /* Navigation */
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #070912; padding: 10px 0; border-top: 1px solid #222; z-index: 100; }
        .nav-item { flex: 1; text-align: center; font-size: 11px; color: #666; cursor: pointer; }
        .nav-active { color: var(--gold); }
        .nav-item i { font-style: normal; font-size: 20px; display: block; margin-bottom: 2px; }

        /* Cards */
        .card { background: #161b22; padding: 15px; border-radius: 12px; border: 1px solid #333; margin-bottom: 10px; }
        .btn { background: var(--gold); border: none; padding: 12px; border-radius: 8px; font-weight: bold; width: 100%; cursor: pointer; color: #000; }
    </style>
</head>
<body>

<div id="toast"></div>

<div id="p-home" class="page active">
    <div class="status-header">
        <div class="status-box"><small>Status</small><b id="st-status">Bronza</b></div>
        <div class="status-box"><small>Soatiga</small><b id="st-rate">0</b></div>
        <div class="status-box"><small>Tap Kuchi</small><b id="st-power">1</b></div>
    </div>
    
    <div style="text-align: center; font-size: 28px; font-weight: bold; margin: 15px 0;">
        ğŸ“€ <span id="coins">0</span><br>
        <small style="font-size: 14px; color: #aaa;">ğŸ’ <span id="diams">0</span></small>
    </div>

    <div class="coin-wrap">
        <div id="coin-btn" class="main-coin" onclick="handleTap()"></div>
        <div class="energy-bar"><div id="en-fill" class="energy-fill"></div></div>
        <div style="text-align:center; font-size:14px;" id="en-text">âš¡ 1000 / 1000</div>
    </div>
</div>

<div id="p-market" class="page">
    <h3>ğŸ›’ Bozor</h3>
    <div class="card">
        <p>1000 ğŸ“€ = 1 ğŸ’</p>
        <input type="number" id="swapIn" placeholder="Tanga miqdori" style="width:100%; padding:10px; margin-bottom:10px; border-radius:5px; border:none; background:#222; color:white;">
        <button class="btn" onclick="swap()">Almashtirish</button>
    </div>
    <div id="market-list"></div>
</div>

<div id="p-bonus" class="page">
    <h3>ğŸ Bonuslar</h3>
    <div class="card">
        <h4>Kunlik Sovg'a</h4>
        <button class="btn" onclick="claimDaily()">Bonusni olish</button>
    </div>
    <div class="card">
        <h4>Omadli Tanga</h4>
        <p>Reklama ko'rib 25,000 gacha yuting!</p>
        <button class="btn" style="background:#ff9f43;" onclick="luckyAd()">Reklama ko'rish ğŸ¬</button>
    </div>
</div>

<div id="p-rank" class="page">
    <h3>ğŸ† Top O'yinchilar</h3>
    <div id="leaderboard"></div>
</div>

<div id="p-uy" class="page">
    <h3>âš¡ Bosterlar</h3>
    <div id="booster-list"></div>
    <hr style="border:0.5px solid #333; margin:20px 0;">
    <div class="card" style="text-align:center;">
        <h2 id="u-name">O'yinchi</h2>
        <p id="u-id">ID: 000000</p>
        <button class="btn" style="background:var(--red); color:white;" onclick="tg.showAlert('Tez kunda!')">ğŸš€ AIRDROP</button>
    </div>
</div>

<div class="nav">
    <div class="nav-item nav-active" onclick="tab('home', this)"><i>ğŸ </i>Uy</div>
    <div class="nav-item" onclick="tab('market', this)"><i>ğŸ›’</i>Bozor</div>
    <div class="nav-item" onclick="tab('bonus', this)"><i>ğŸ</i>Bonus</div>
    <div class="nav-item" onclick="tab('rank', this)"><i>ğŸ†</i>Reyting</div>
    <div class="nav-item" onclick="tab('uy', this)"><i>âš¡</i>Boster</div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const tg = window.Telegram.WebApp;
    const user = tg.initDataUnsafe.user || { id: "test_user", first_name: "O'yinchi" };

    let s = { 
        coins: 0, diams: 0, energy: 1000, maxE: 1000, power: 1, regen: 1, hRate: 0, 
        lastDaily: 0, lastActive: Date.now(), b: { p:1, e:1, r:1 }
    };

    // Firebase ulanishi va NaN xatosini tuzatish
    db.ref('users/' + user.id).on('value', snap => {
        if(snap.exists()){
            const d = snap.val();
            s = {
                ...s, ...d,
                coins: Number(d.coins) || 0,
                diams: Number(d.diams) || 0,
                hRate: Number(d.hRate) || 0,
                energy: Number(d.energy) || 1000
            };
            updateUI();
        } else { save(); }
    });

    function handleTap() {
        if(s.energy >= s.power) {
            s.coins += s.power; s.energy -= s.power;
            updateUI();
        } else { notify("Energiya yo'q!", 'error'); }
    }

    // Reklama funksiyasi (Faqat "Activate" qilingan bo'lsa ishlaydi)
    function luckyAd() {
        if(typeof show_10558007 === 'function') {
            show_10558007().then(() => {
                const win = Math.floor(Math.random() * 25001);
                s.coins += win;
                save();
                notify(`+${win} ğŸ“€ Reklama uchun!`, 'success');
            }).catch(() => notify("Reklama tayyor emas! (Activate bosing)", 'error'));
        }
    }

    function tab(id, el) {
        // Sahifa almashganda Interstitial reklama chaqirish
        if(typeof show_10558007 === 'function') show_10558007().catch(()=>{});

        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('p-' + id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('nav-active'));
        el.classList.add('nav-active');
    }

    function updateUI() {
        document.getElementById('coins').innerText = Math.floor(s.coins).toLocaleString();
        document.getElementById('diams').innerText = Math.floor(s.diams).toLocaleString();
        document.getElementById('st-rate').innerText = s.hRate;
        document.getElementById('st-power').innerText = s.power;
        document.getElementById('en-text').innerText = `âš¡ ${Math.floor(s.energy)} / ${s.maxE}`;
        document.getElementById('en-fill').style.width = (s.energy/s.maxE*100) + "%";
    }

    function swap() {
        const v = Number(document.getElementById('swapIn').value);
        if(v >= 1000 && s.coins >= v) {
            s.coins -= v; s.diams += Math.floor(v/1000);
            save(); notify("Muvaffaqiyatli!", 'success');
        } else { notify("Xato miqdor!", 'error'); }
    }

    function notify(m, t) {
        const toast = document.getElementById('toast');
        toast.innerText = m; toast.style.background = t === 'success' ? 'var(--green)' : 'var(--red)';
        toast.style.display = 'block'; setTimeout(() => toast.style.display = 'none', 3000);
    }

    function save() { s.lastActive = Date.now(); db.ref('users/' + user.id).set(s); }

    document.getElementById('u-name').innerText = user.first_name;
    document.getElementById('u-id').innerText = "ID: " + user.id;
    setInterval(() => { s.energy = Math.min(s.maxE, s.energy + (s.regen/10)); s.coins += (s.hRate/3600); updateUI(); }, 1000);
    setInterval(save, 15000);
    tg.expand();
</script>
</body>
        </html>
    
    

                                                                                   
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

