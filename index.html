<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga - Pro</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="//libtl.com/sdk.js" data-zone="10558007" data-sdk="show_10558007"></script>

    <style>
        :root { --gold: #ffd700; --bg: #0b0d17; --card: #1c222d; --green: #2ecc71; --red: #e74c3c; --blue: #0088cc; --glass: rgba(255, 255, 255, 0.05); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; height: 100vh; }

        /* Asosiy Tanga - DUMALOQ VA ISHLAYDIGAN */
        .game-area { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 55vh; gap: 20px; }
        #balance-main { color: var(--gold); font-size: 45px; font-weight: 900; }
        
        .coin-wrapper { 
            width: 240px; height: 240px; 
            position: relative; cursor: pointer;
            transition: transform 0.1s active;
        }
        .coin-main { 
            width: 100%; height: 100%; 
            background: radial-gradient(circle, #ffe066, #ffb300); 
            border-radius: 50%; /* DUMALOQ */
            border: 10px solid #cc8e00; 
            display: flex; align-items: center; justify-content: center; 
            font-size: 40px; color: #000; font-weight: 900;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.2);
        }
        .coin-wrapper:active { transform: scale(0.95); }

        /* Reyting - IXCHAM VA MEDAL BILAN */
        .rank-item { 
            display: flex; align-items: center; background: var(--card); 
            padding: 10px 15px; border-radius: 12px; margin-bottom: 8px; font-size: 14px;
        }
        .rank-medal { width: 30px; font-size: 20px; }
        .rank-info { flex: 1; margin-left: 10px; }
        .rank-stats { text-align: right; font-size: 12px; color: var(--gold); }

        /* Navigatsiya */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: #07090c; display: flex; padding: 10px 0; border-top: 1px solid #1c222d; }
        .nav-btn { flex: 1; text-align: center; font-size: 10px; color: #888; text-decoration: none; }
        .nav-btn i { display: block; font-size: 20px; margin-bottom: 3px; font-style: normal; }

        /* Sahifalar */
        .page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 200; padding: 20px; display: none; overflow-y: auto; padding-bottom: 80px; }
        .card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 12px; border: 1px solid var(--glass); }
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: bold; background: var(--gold); color: #000; cursor: pointer; }
        
        .floating-text { position: fixed; color: white; font-weight: bold; font-size: 24px; pointer-events: none; animation: floatUp 0.6s ease-out forwards; z-index: 1000; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-100px); opacity: 0; } }
        
        .top-stats { display: flex; justify-content: space-around; padding: 10px; background: rgba(0,0,0,0.3); }
        .stat { text-align: center; font-size: 12px; }
        .stat b { display: block; color: var(--gold); }
    </style>
</head>
<body>

<div id="notify" style="position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:9999; padding:10px 20px; border-radius:20px; display:none;"></div>
<audio id="bg-music" loop><source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" type="audio/mpeg"></audio>

<div class="top-stats">
    <div class="stat">ğŸ“€ Tanga/S<b id="coin-pph-val">0</b></div>
    <div class="stat">ğŸ’ Olmos/S<b id="diam-pph-val">0</b></div>
    <div class="stat">ğŸ† Daraja<b id="lvl-val">1</b></div>
</div>

<div class="game-area">
    <div id="balance-main">0</div>
    <div class="coin-wrapper" id="coin-btn">
        <div class="coin-main" id="center-tap-val">+1</div>
    </div>
    <div style="width:80%">
        <div style="display:flex; justify-content:space-between; font-size:12px; margin-bottom:5px;">
            <span>Energiya</span><span id="e-text">500/500</span>
        </div>
        <div style="width:100%; height:8px; background:#222; border-radius:5px;">
            <div id="energy-fill" style="height:100%; background:var(--gold); width:100%; border-radius:5px;"></div>
        </div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-btn" onclick="openPage('p-market')"><i>ğŸ›’</i>Market</div>
    <div class="nav-btn" onclick="openPage('p-bonus')"><i>ğŸ</i>Bonus</div>
    <div class="nav-btn" onclick="openPage('p-rank')"><i>ğŸ†</i>Rank</div>
    <div class="nav-btn" onclick="openPage('p-boost')"><i>âš¡</i>Booster</div>
    <div class="nav-btn" onclick="openPage('p-home')"><i>ğŸ‘¤</i>Profil</div>
</div>

<div id="p-home" class="page">
    <div style="display:flex; justify-content:space-between;"><h2>Profil</h2><h2 onclick="closePage('p-home')">Ã—</h2></div>
    <div class="card">
        <p>Ism: <b id="u-name">...</b></p>
        <p>Tangalar: <b id="p-coins">0</b> ğŸ“€</p>
        <p>Olmoslar: <b id="p-diams">0</b> ğŸ’</p>
    </div>

    <div class="card" style="border: 1px solid var(--blue);">
        <h3>ğŸ’± Birja (Exchange)</h3>
        <p>10,000 ğŸ“€ â†’ 1 ğŸ’</p>
        <button class="btn" onclick="exchange('c2d')" style="background:var(--blue); color:white; margin-bottom:10px;">Tanga â†’ Olmos</button>
        <p>10 ğŸ’ â†’ 5,000 ğŸ“€</p>
        <button class="btn" onclick="exchange('d2c')" style="background:var(--blue); color:white;">Olmos â†’ Tanga</button>
    </div>

    <div class="card">
        <h3>ğŸ’ TON Chiqarish</h3>
        <p>100M ğŸ“€ + 10k ğŸ’ = 1 TON</p>
        <p>Minimal: 5 TON</p>
        <button class="btn" onclick="withdraw()">PULNI CHIQARISH</button>
    </div>
</div>

<div id="p-rank" class="page">
    <div style="display:flex; justify-content:space-between;"><h2>Reyting ğŸ†</h2><h2 onclick="closePage('p-rank')">Ã—</h2></div>
    <div id="leaderboard-list">Yuklanmoqda...</div>
</div>

<div id="p-boost" class="page">
    <div style="display:flex; justify-content:space-between;"><h2>Bosterlar</h2><h2 onclick="closePage('p-boost')">Ã—</h2></div>
    <div class="card"><b>â› Tanga Mining</b><p>Lvl: <span id="b-pph-lvl">1</span></p><button class="btn" onclick="buyBoost('pph')">Narxi: <span id="b-pph-cost">1000</span></button></div>
    <div class="card"><b>ğŸ‘† Tap Kuchi</b><p>Lvl: <span id="b-tap-lvl">1</span></p><button class="btn" onclick="buyBoost('tap')">Narxi: <span id="b-tap-cost">500</span></button></div>
    <div class="card"><b>ğŸ”‹ Energiya Sig'imi</b><p>Lvl: <span id="b-energy-lvl">1</span></p><button class="btn" onclick="buyBoost('energy')">Narxi: <span id="b-energy-cost">1500</span></button></div>
</div>

<div id="p-market" class="page">
    <div style="display:flex; justify-content:space-between;"><h2>Market</h2><h2 onclick="closePage('p-market')">Ã—</h2></div>
    <div id="market-items"></div>
</div>

<div id="p-bonus" class="page">
    <div style="display:flex; justify-content:space-between;"><h2>Bonuslar</h2><h2 onclick="closePage('p-bonus')">Ã—</h2></div>
    <div class="card"><b>Kunlik Bonus</b><button class="btn" onclick="claimDailyBonus()">OLISH</button></div>
</div>

<script>
const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tg = window.Telegram.WebApp;
const user = tg.initDataUnsafe?.user || { id: "12345", first_name: "O'yinchi" };

let s = {
    coins: 0, diamonds: 0, lvl: 1, pphDiam: 0, pphCoin: 0,
    energy: 500, maxE: 500, tap: 1, tapLvl: 1, pphLvl: 1, energyLvl: 1, lastSeen: Date.now()
};

// Ma'lumotlarni yuklash va Mining (Offline ishlaydi)
db.ref('users/' + user.id).once('value', snap => {
    if(snap.exists()) {
        let data = snap.val();
        let diff = Math.floor((Date.now() - (data.lastSeen || Date.now())) / 1000);
        let offlineLimit = Math.min(diff, 7200); // Max 2 soat offline mining
        data.coins = (data.coins || 0) + (data.pphCoin / 3600) * offlineLimit;
        data.diamonds = (data.diamonds || 0) + (data.pphDiam / 3600) * offlineLimit;
        s = {...s, ...data};
    }
    updateUI();
});

function updateUI() {
    document.getElementById('balance-main').innerText = Math.floor(s.coins).toLocaleString();
    document.getElementById('coin-pph-val').innerText = s.pphCoin;
    document.getElementById('diam-pph-val').innerText = s.pphDiam;
    document.getElementById('lvl-val').innerText = s.lvl;
    document.getElementById('p-coins').innerText = Math.floor(s.coins).toLocaleString();
    document.getElementById('p-diams').innerText = Math.floor(s.diamonds).toLocaleString();
    document.getElementById('u-name').innerText = user.first_name;
    document.getElementById('e-text').innerText = `${Math.floor(s.energy)}/${s.maxE}`;
    document.getElementById('energy-fill').style.width = (s.energy/s.maxE*100) + "%";
    
    // Bosterlar darajasi va narxi
    document.getElementById('b-tap-lvl').innerText = s.tapLvl;
    document.getElementById('b-tap-cost').innerText = (500 * Math.pow(2, s.tapLvl-1)).toLocaleString();
    document.getElementById('b-pph-lvl').innerText = s.pphLvl;
    document.getElementById('b-pph-cost').innerText = (1000 * Math.pow(2, s.pphLvl-1)).toLocaleString();
    document.getElementById('b-energy-lvl').innerText = s.energyLvl;
    document.getElementById('b-energy-cost').innerText = (1500 * Math.pow(2, s.energyLvl-1)).toLocaleString();
}

// TAP ISHLASHI
document.getElementById('coin-btn').addEventListener('click', (e) => {
    if(s.energy >= s.tap) {
        s.coins += s.tap;
        s.energy -= s.tap;
        createFx(e);
        updateUI();
        // Musiqani birinchi bosishda chalish
        let music = document.getElementById('bg-music');
        if(music.paused) music.play();
    } else {
        showNotify("Energiya yetarli emas!", "red");
    }
});

function createFx(e) {
    let x = e.clientX || e.touches[0].clientX;
    let y = e.clientY || e.touches[0].clientY;
    let div = document.createElement('div');
    div.className = 'floating-text';
    div.innerText = `+${s.tap}`;
    div.style.left = x + 'px'; div.style.top = y + 'px';
    document.body.appendChild(div);
    setTimeout(() => div.remove(), 600);
}

// BOSTERLAR DARAJASI ISHLASHI
function buyBoost(type) {
    let cost = 0;
    if(type==='tap') cost = 500 * Math.pow(2, s.tapLvl-1);
    else if(type==='pph') cost = 1000 * Math.pow(2, s.pphLvl-1);
    else cost = 1500 * Math.pow(2, s.energyLvl-1);

    if(s.coins >= cost) {
        s.coins -= cost;
        if(type==='tap') { s.tapLvl++; s.tap++; }
        else if(type==='pph') { s.pphLvl++; s.pphCoin += 250; }
        else { s.energyLvl++; s.maxE += 500; s.energy = s.maxE; }
        save(); updateUI();
        showNotify("Daraja oshirildi!", "green");
    } else showNotify("Mablag' yetarli emas!", "red");
}

// EXCHANGE (BIRJA)
function exchange(type) {
    if(type === 'c2d') {
        if(s.coins >= 10000) { s.coins -= 10000; s.diamonds += 1; showNotify("+1 ğŸ’ olindi!", "green"); }
        else showNotify("10,000 tanga kerak!", "red");
    } else {
        if(s.diamonds >= 10) { s.diamonds -= 10; s.coins += 5000; showNotify("+5,000 ğŸ“€ olindi!", "green"); }
        else showNotify("10 olmos kerak!", "red");
    }
    save(); updateUI();
}

function withdraw() {
    showNotify("Tez kunda...", "orange");
}

// REYTING - IXCHAM
function loadRank() {
    db.ref('users').orderByChild('coins').limitToLast(20).once('value', snap => {
        let list = [];
        snap.forEach(child => { list.push(child.val()); });
        list.sort((a,b) => b.coins - a.coins);
        let h = '';
        list.forEach((u, i) => {
            let medal = i===0?'ğŸ¥‡':(i===1?'ğŸ¥ˆ':(i===2?'ğŸ¥‰':(i+1+'.')));
            h += `<div class="rank-item">
                <div class="rank-medal">${medal}</div>
                <div class="rank-info"><b>${u.first_name || 'O\'yinchi'}</b><br><small>Daraja: ${u.lvl || 1}</small></div>
                <div class="rank-stats">ğŸ“€ ${Math.floor(u.coins).toLocaleString()}<br>ğŸ’ ${Math.floor(u.diamonds || 0)}</div>
            </div>`;
        });
        document.getElementById('leaderboard-list').innerHTML = h;
    });
}

function openPage(id) { 
    document.querySelectorAll('.page').forEach(p => p.style.display='none'); 
    document.getElementById(id).style.display='block';
    if(id==='p-rank') loadRank();
}
function closePage(id) { document.getElementById(id).style.display='none'; }
function save() { s.lastSeen = Date.now(); db.ref('users/' + user.id).set(s); }
function showNotify(m, c) { 
    let n = document.getElementById('notify'); n.innerText = m; 
    n.style.background = c==='green'?'#2ecc71':(c==='orange'?'#ffa500':'#e74c3c');
    n.style.display='block'; setTimeout(()=>n.style.display='none', 2000); 
}

// Avtomatik Mining va Energiya tiklanishi
setInterval(() => {
    s.energy = Math.min(s.maxE, s.energy + 1);
    s.coins += (s.pphCoin / 3600);
    s.diamonds += (s.pphDiam / 3600);
    updateUI();
}, 1000);

setInterval(save, 15000);
tg.expand();
</script>
</body>
    </html>
    
    
    
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

