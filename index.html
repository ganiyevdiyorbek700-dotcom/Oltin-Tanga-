<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="monetag" content="6d6c27c8cb845b8dc1e72729aa2b63ab">
    <title>Oltin Tanga - Ultimate Pro</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="//libtl.com/sdk.js" data-zone="10558007" data-sdk="show_10558007"></script>

    <style>
        :root { --gold: #ffd700; --bg: #0b0d17; --card: #1c222d; --green: #2ecc71; --red: #e74c3c; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body {
            margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif;
            overflow: hidden; transition: background 0.5s;
        }

        /* Fon Effektlari */
        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; pointer-events: none; }
        .moon-bg { background: radial-gradient(circle at top right, #f5f3ce, transparent 40%); }
        .ice-bg { background: linear-gradient(to bottom, #a5f3fc, transparent); }
        .space-bg { background: url('https://www.transparenttextures.com/patterns/stardust.png'), #000; }

        /* Header Stats */
        .top-stats {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; padding: 15px; background: rgba(0,0,0,0.5);
        }
        .stat-box { background: var(--card); padding: 8px; border-radius: 10px; text-align: center; border: 1px solid #333; }
        .stat-box small { font-size: 10px; color: #aaa; display: block; }
        .stat-box b { font-size: 14px; color: var(--gold); }

        /* Main Coin Section */
        .game-area { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 65vh; position: relative; }
        .coin-wrapper { position: relative; width: 260px; height: 260px; z-index: 10; }
        .coin-main {
            width: 100%; height: 100%; background: radial-gradient(circle, #ffe066, #ffb300);
            border-radius: 50%; border: 10px solid #cc8e00; box-shadow: 0 0 40px rgba(255,215,0,0.4);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            transition: transform 0.05s ease; position: relative;
        }
        .coin-main:active { transform: scale(0.92) rotate(2deg); }
        .tap-power-text { font-size: 40px; font-weight: 900; color: #4d3300; text-shadow: 1px 1px 0px #fff; }

        /* Energy Bar */
        .energy-container { width: 80%; margin-top: 20px; text-align: center; }
        .energy-bar-bg { width: 100%; height: 12px; background: #222; border-radius: 6px; overflow: hidden; margin-top: 5px; }
        #energy-fill { height: 100%; background: var(--gold); width: 100%; transition: width 0.2s; }

        /* Navigation */
        .nav-bar {
            position: fixed; bottom: 0; width: 100%; background: #07090c;
            display: flex; justify-content: space-around; padding: 12px; border-top: 1px solid #222; z-index: 100;
        }
        .nav-btn { color: #666; text-align: center; font-size: 10px; cursor: pointer; border: none; background: none; }
        .nav-btn.active { color: var(--gold); }
        .nav-btn i { font-size: 20px; display: block; margin-bottom: 4px; }

        /* Modals / Pages */
        .page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg);
            z-index: 200; padding: 20px; display: none; overflow-y: auto; padding-bottom: 100px;
        }
        .close-page { float: right; font-size: 25px; color: #fff; cursor: pointer; padding: 10px; }
        .card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #333; position: relative; }
        .lock-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.8); border-radius:15px; display:flex; align-items:center; justify-content:center; color: #ff4d4d; font-weight:bold; text-align:center; padding:10px;}

        /* Buttons */
        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; background: var(--gold); color: #000; margin-top: 8px; }
        .btn:active { transform: scale(0.98); }

        /* Notification */
        #notify { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 12px 25px; border-radius: 30px; z-index: 1000; display: none; font-weight: bold; }
        
        /* Rank Styles */
        .rank-row { display: flex; justify-content: space-between; padding: 12px; border-radius: 10px; margin-bottom: 5px; }
        .rank-1 { background: linear-gradient(90deg, #ffd700, #b8860b); color: #000; font-weight: bold; }
        .rank-2 { background: silver; color: #000; }
        .rank-3 { background: #cd7f32; color: #000; }
    </style>
</head>
<body>

<div id="notify"></div>
<div id="bg-fx" class="bg-overlay"></div>

<div class="top-stats">
    <div class="stat-box"><small>ğŸ’ Mining/h</small><b id="pph-val">0</b></div>
    <div class="stat-box"><small>ğŸ’ Olmos</small><b id="diam-val">0</b></div>
    <div class="stat-box"><small>Daraja</small><b id="lvl-val">1</b></div>
</div>

<div class="game-area">
    <div class="coin-wrapper" onclick="handleTap(event)">
        <div class="coin-main" id="target-coin">
            <div class="tap-power-text" id="tap-power-val">+1</div>
        </div>
    </div>
    <div class="energy-container">
        <span>âš¡ <span id="e-text">500/500</span></span>
        <div class="energy-bar-bg"><div id="energy-fill"></div></div>
    </div>
    <h2 id="balance-main" style="color:var(--gold); font-size: 32px; margin-top: 15px;">0</h2>
</div>

<div class="nav-bar">
    <div class="nav-btn" onclick="openPage('p-market')">ğŸ›’<br>Market</div>
    <div class="nav-btn" onclick="openPage('p-bonus')">ğŸ<br>Bonus</div>
    <div class="nav-btn" onclick="openPage('p-rank')">ğŸ†<br>Rank</div>
    <div class="nav-btn" onclick="openPage('p-boost')">âš¡<br>Booster</div>
    <div class="nav-btn" onclick="openPage('p-home')">ğŸ‘¤<br>Profil</div>
</div>

<div id="p-market" class="page">
    <span class="close-page" onclick="closePage('p-market')">âœ–</span>
    <h2>Market ğŸ›’</h2>
    
    <h3>Oddiy Tangalar (Level 1)</h3>
    <div class="card">
        <b>ğŸŸ« Bronza Tanga</b>
        <p>+10 ğŸ’/soat. Tap effekti: Bronza.</p>
        <button class="btn" onclick="buyItem('bronze', 100)">100 ğŸ’</button>
    </div>
    <div class="card">
        <b>â¬œ Kumush Tanga</b>
        <p>+15 ğŸ’/soat. Tap effekti: Kumush.</p>
        <button class="btn" onclick="buyItem('silver', 200)">200 ğŸ’</button>
    </div>

    <h3>Epik Tangalar (Level 3)</h3>
    <div class="card">
        <div id="lock-epic" class="lock-overlay">Daraja 3 kerak!</div>
        <b>ğŸŸ¨ Oltin Tanga</b>
        <p>+25 ğŸ’/soat. Orqa fon: To'lin oy.</p>
        <button class="btn" onclick="buyItem('gold', 350)">350 ğŸ’</button>
    </div>
    <div class="card">
        <div id="lock-epic2" class="lock-overlay">Daraja 3 kerak!</div>
        <b>ğŸŸ© Zumrad Tanga</b>
        <p>+35 ğŸ’/soat. Effekti kuchliroq.</p>
        <button class="btn" onclick="buyItem('emerald', 500)">500 ğŸ’</button>
    </div>

    <h3>Maxsus Tangalar (Level 7)</h3>
    <div class="card">
        <div id="lock-special" class="lock-overlay">Daraja 7 kerak!</div>
        <b>ğŸ’ Platina Tanga</b>
        <p>+100 ğŸ’/soat. Orqa fon: Muzli.</p>
        <button class="btn" onclick="buyItem('platinum', 1000)">1000 ğŸ’</button>
    </div>
    <div class="card">
        <div id="lock-special2" class="lock-overlay">Daraja 7 kerak!</div>
        <b>ğŸŒŒ Kosmik Tanga</b>
        <p>+250 ğŸ’/soat. Orqa fon: Kosmos.</p>
        <button class="btn" onclick="buyItem('cosmic', 5000)">5000 ğŸ’</button>
    </div>

    <div class="card">
        <h3>Ayirboshlash</h3>
        <input type="number" id="swap-input" placeholder="Tanga miqdori" style="width:100%; padding:10px;">
        <button class="btn" onclick="swapCoins()">Olmosga almashtirish (1000:1)</button>
    </div>
</div>

<div id="p-bonus" class="page">
    <span class="close-page" onclick="closePage('p-bonus')">âœ–</span>
    <h2>Bonuslar ğŸ</h2>
    <div class="card">
        <h3>Kunlik Bonus</h3>
        <p>Har kuni oshib boruvchi sovg'a.</p>
        <button class="btn" id="daily-btn" onclick="claimDaily()">Olish ğŸ¬</button>
        <small id="daily-timer"></small>
    </div>
    <div class="card">
        <h3>Tasodifiy Tanga</h3>
        <p>Kuniga 3 imkoniyat (0 - 10,000 ğŸ“€)</p>
        <button class="btn" id="lucky-btn" onclick="claimLucky()">Omadni sinash ğŸ¬</button>
        <small id="lucky-count">Imkoniyat: 3/3</small>
    </div>
</div>

<div id="p-rank" class="page">
    <span class="close-page" onclick="closePage('p-rank')">âœ–</span>
    <h2>Top O'yinchilar ğŸ†</h2>
    <div id="leaderboard-list"></div>
</div>

<div id="p-boost" class="page">
    <span class="close-page" onclick="closePage('p-boost')">âœ–</span>
    <h2>Bosterlar âš¡</h2>
    <div class="card">
        <b>â› Soatbay Daromad (ğŸ’)</b>
        <p>Lvl: <span id="b-pph-lvl">1</span></p>
        <button class="btn" onclick="buyBoost('pph')">Narxi: <span id="b-pph-cost">500</span> ğŸ“€</button>
    </div>
    <div class="card">
        <b>âš¡ Energiya Sig'imi</b>
        <p>Lvl: <span id="b-e-lvl">1</span></p>
        <button class="btn" onclick="buyBoost('energy')">Narxi: <span id="b-e-cost">500</span> ğŸ“€</button>
    </div>
    <div class="card">
        <b>ğŸ‘† Tap Kuchi</b>
        <p>Lvl: <span id="b-tap-lvl">1</span></p>
        <button class="btn" onclick="buyBoost('tap')">Narxi: <span id="b-tap-cost">500</span> ğŸ“€</button>
    </div>
</div>

<div id="p-home" class="page">
    <span class="close-page" onclick="closePage('p-home')">âœ–</span>
    <h2>Profil ğŸ‘¤</h2>
    <div class="card">
        <p>Ism: <b id="u-name">...</b></p>
        <p>ID: <small id="u-id">...</small></p>
        <p>Balans: <span id="ton-bal">0</span> TON</p>
    </div>
    <div class="card">
        <h3>TON Ayirboshlash</h3>
        <p>1M ğŸ“€ + 10k ğŸ’ = 1 TON</p>
        <button class="btn" onclick="convertToTon()">Almashtirish</button>
        <button class="btn" style="background:#0088cc; color:white;" onclick="alert('Tez kunda! Minimal 5 TON')">Pul chiqarish</button>
    </div>
</div>

<audio id="click-sound" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop></audio>

<script>
// --- Firebase Config (Sizning ma'lumotlaringiz bilan) ---
const firebaseConfig = {
  apiKey: "AIzaSyDbttlr-oGJeDbjMbrubcuspgg9gk-7Gxs",
  authDomain: "oltin-tanga-d2c80.firebaseapp.com",
  databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com",
  projectId: "oltin-tanga-d2c80",
  storageBucket: "oltin-tanga-d2c80.firebasestorage.app",
  messagingSenderId: "954210050924",
  appId: "1:954210050924:web:f57b75568c66216c49c949"
};

// Initialize Firebase (Eskiroq versiya uchun moslangan)
if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
}
const db = firebase.database();
    

const tg = window.Telegram.WebApp;
const user = tg.initDataUnsafe.user || { id: "Guest", first_name: "O'yinchi" };

// --- O'yin holati ---
let s = {
    coins: 0, diamonds: 0, ton: 0,
    lvl: 1, pph: 0, 
    energy: 500, maxE: 500, 
    tap: 1, 
    tapLvl: 1, pphLvl: 1, eLvl: 1,
    lastD: 0, luckyC: 3, lastL: 0,
    skin: 'default'
};

const levels = [0, 50000, 100000, 500000, 1000000, 10000000, 50000000, 100000000, 5000000000, 15000000000];

// --- Yuklash ---
db.ref('users/' + user.id).on('value', snap => {
    if(snap.exists()) {
        const d = snap.val();
        Object.assign(s, d);
        updateUI();
    } else { save(); }
});

function handleTap(e) {
    if(s.energy >= s.tap) {
        s.coins += s.tap;
        s.energy -= s.tap;
        createTapFX(e);
        updateUI();
        document.getElementById('click-sound').play().catch(()=>{});
    } else {
        showNotify("Energiya tugadi!", "red");
        runAd('pop', () => { s.energy = s.maxE; updateUI(); });
    }
}

function createTapFX(e) {
    const fx = document.createElement('div');
    fx.innerText = `+${s.tap}`;
    fx.style.cssText = `position:fixed; left:${e.clientX}px; top:${e.clientY}px; color:var(--gold); font-weight:bold; pointer-events:none; animation: fly 0.6s forwards; z-index:999;`;
    document.body.appendChild(fx);
    setTimeout(() => fx.remove(), 600);
}

function updateUI() {
    // Darajani hisoblash
    let currentLvl = 1;
    for(let i=0; i<levels.length; i++) { if(s.coins >= levels[i]) currentLvl = i+1; }
    s.lvl = currentLvl;

    document.getElementById('balance-main').innerText = Math.floor(s.coins).toLocaleString();
    document.getElementById('diam-val').innerText = Math.floor(s.diamonds).toLocaleString();
    document.getElementById('pph-val').innerText = s.pph;
    document.getElementById('lvl-val').innerText = s.lvl;
    document.getElementById('e-text').innerText = `${Math.floor(s.energy)}/${s.maxE}`;
    document.getElementById('energy-fill').style.width = (s.energy/s.maxE*100) + "%";
    document.getElementById('tap-power-val').innerText = `+${s.tap}`;

    // Booster UI
    document.getElementById('b-tap-lvl').innerText = s.tapLvl;
    document.getElementById('b-tap-cost').innerText = (500 * Math.pow(2, s.tapLvl-1)).toLocaleString();
    document.getElementById('b-e-lvl').innerText = s.eLvl;
    document.getElementById('b-e-cost').innerText = (500 * Math.pow(2, s.eLvl-1)).toLocaleString();
    document.getElementById('b-pph-lvl').innerText = s.pphLvl;
    document.getElementById('b-pph-cost').innerText = (500 * Math.pow(2, s.pphLvl-1)).toLocaleString();

    // Profil
    document.getElementById('u-name').innerText = user.first_name;
    document.getElementById('u-id').innerText = user.id;
    document.getElementById('ton-bal').innerText = s.ton;

    // Qulflarni tekshirish
    document.getElementById('lock-epic').style.display = s.lvl >= 3 ? 'none' : 'flex';
    document.getElementById('lock-epic2').style.display = s.lvl >= 3 ? 'none' : 'flex';
    document.getElementById('lock-special').style.display = s.lvl >= 7 ? 'none' : 'flex';
    document.getElementById('lock-special2').style.display = s.lvl >= 7 ? 'none' : 'flex';

    applySkin();
}

function applySkin() {
    const bg = document.getElementById('bg-fx');
    bg.className = 'bg-overlay';
    const coin = document.getElementById('target-coin');
    
    if(s.skin === 'gold') bg.classList.add('moon-bg');
    if(s.skin === 'platinum') bg.classList.add('ice-bg');
    if(s.skin === 'cosmic') bg.classList.add('space-bg');
}

function buyItem(id, price) {
    if(s.diamonds >= price) {
        s.diamonds -= price;
        if(id === 'bronze') s.pph += 10;
        if(id === 'silver') s.pph += 15;
        if(id === 'gold') { s.pph += 25; s.skin = 'gold'; }
        if(id === 'emerald') s.pph += 35;
        if(id === 'platinum') { s.pph += 100; s.skin = 'platinum'; }
        if(id === 'cosmic') { s.pph += 250; s.skin = 'cosmic'; }
        showNotify("Sotib olindi!", "green");
        save();
    } else {
        showNotify("Mablag' yetarli emas!", "red");
    }
}

function buyBoost(type) {
    let cost = 0;
    if(type === 'tap') {
        cost = 500 * Math.pow(2, s.tapLvl-1);
        if(s.coins >= cost) { s.coins -= cost; s.tapLvl++; s.tap++; showNotify("Kuchaytirildi!", "green"); }
        else showNotify("Yetarli emas!", "red");
    }
    if(type === 'energy') {
        cost = 500 * Math.pow(2, s.eLvl-1);
        if(s.coins >= cost) { s.coins -= cost; s.eLvl++; s.maxE += 500; s.energy = s.maxE; showNotify("Kuchaytirildi!", "green"); }
        else showNotify("Yetarli emas!", "red");
    }
    if(type === 'pph') {
        cost = 500 * Math.pow(2, s.pphLvl-1);
        if(s.coins >= cost) { s.coins -= cost; s.pphLvl++; s.pph += 50; showNotify("Kuchaytirildi!", "green"); }
        else showNotify("Yetarli emas!", "red");
    }
    save();
}

function claimDaily() {
    let now = Date.now();
    if(now - s.lastD > 86400000) {
        runAd('reward', () => {
            let rewards = [500, 1000, 2000, 3000, 5000, 7500, 10000];
            let day = Math.floor((s.lastD % 604800000) / 86400000);
            let gift = rewards[day] || 500;
            s.coins += gift;
            s.lastD = now;
            showNotify(`Bonus: ${gift} ğŸ“€`, "green");
            save();
        });
    } else showNotify("Hali vaqt bor!", "red");
}

function swapCoins() {
    let val = parseInt(document.getElementById('swap-input').value);
    if(val >= 1000 && s.coins >= val) {
        s.coins -= val;
        s.diamonds += Math.floor(val / 1000);
        showNotify("Almashtirildi!", "green");
        save();
    } else showNotify("Xato miqdor!", "red");
}

function convertToTon() {
    if(s.coins >= 1000000 && s.diamonds >= 10000) {
        s.coins -= 1000000; s.diamonds -= 10000;
        s.ton += 1;
        showNotify("1 TON olindi!", "green");
        save();
    } else showNotify("Yetarli emas!", "red");
}

// --- Reklama & Tizim ---
function runAd(type, callback) {
    if(typeof show_10558007 === 'function') {
        if(type === 'pop') show_10558007('pop').then(callback).catch(callback);
        else show_10558007().then(callback).catch(callback);
    } else callback();
}

function openPage(id) { 
    document.getElementById(id).style.display = 'block'; 
    if(id === 'p-rank') loadRank();
    if(id === 'p-market' || id === 'p-boost') runAd('pop', ()=>{});
}
function closePage(id) { document.getElementById(id).style.display = 'none'; }

function showNotify(m, c) {
    const n = document.getElementById('notify');
    n.innerText = m; n.style.background = c === 'green' ? '#2ecc71' : '#e74c3c';
    n.style.display = 'block';
    setTimeout(() => n.style.display = 'none', 2000);
}

function loadRank() {
    db.ref('users').orderByChild('coins').limitToLast(20).once('value', snap => {
        let list = []; snap.forEach(u => list.push(u.val()));
        list.reverse();
        let html = '';
        list.forEach((u, i) => {
            html += `<div class="rank-row rank-${i+1}"><span>${i+1}. ${u.first_name || 'User'}</span><b>${Math.floor(u.coins).toLocaleString()}</b></div>`;
        });
        document.getElementById('leaderboard-list').innerHTML = html;
    });
}

function save() { 
    db.ref('users/' + user.id).update({...s, first_name: user.first_name}); 
}

// Mining interval
setInterval(() => {
    s.energy = Math.min(s.maxE, s.energy + 1.2);
    if(s.pph > 0) s.diamonds += (s.pph / 3600);
    updateUI();
}, 1000);

setInterval(save, 30000);
tg.expand();
</script>

<style>
@keyframes fly { 0% { opacity:1; transform: translateY(0); } 100% { opacity:0; transform: translateY(-100px); } }
</style>
</body>
                                                                       </html>
            
    
    

    
    
    

                                                                                   
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

