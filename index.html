<!DOCTYPE html>
<html lang="uz">
<head>
    <meta name="monetag" content="6d6c27c8cb845b8dc1e72729aa2b63ab">
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga - Pro Edition</title>
    
    <script src='//libtl.com/sdk.js' data-zone='10558007' data-sdk='show_10558007'></script>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <style>
        :root { --gold: #ffd700; --bg: #0b0d17; --card: #161b22; --text: #ffffff; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; overflow: hidden; }
        
        /* Toast Notification */
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 12px 25px; border-radius: 30px; z-index: 1000; display: none; font-weight: bold; text-align: center; min-width: 200px; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .success { background: #2ecc71; }
        .error { background: #e74c3c; }

        /* Layout */
        .page { display: none; height: 100vh; padding: 20px; box-sizing: border-box; overflow-y: auto; padding-bottom: 100px; }
        .active { display: block; }
        
        /* Stats Header */
        .stats { display: flex; justify-content: space-around; background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #333; }
        .stat-box { text-align: center; }
        .stat-box small { display: block; color: #888; font-size: 12px; }
        .stat-box b { color: var(--gold); font-size: 16px; }

        /* Main Clicker */
        .click-area { text-align: center; margin-top: 30px; }
        .main-btn { width: 200px; height: 200px; background: radial-gradient(circle, #f1c40f, #d35400); border-radius: 50%; margin: 0 auto; border: 8px solid #f39c12; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 80px; box-shadow: 0 0 30px rgba(241, 196, 15, 0.4); transition: 0.1s; }
        .main-btn:active { transform: scale(0.92); }

        /* Lists (Rating, Boosters) */
        .card-list { background: var(--card); border-radius: 15px; padding: 10px; border: 1px solid #333; margin-bottom: 10px; }
        .item { display: flex; justify-content: space-between; align-items: center; padding: 12px; border-bottom: 1px solid #222; }
        .item:last-child { border-bottom: none; }
        
        /* Buttons */
        .btn { background: var(--gold); color: black; border: none; padding: 12px; border-radius: 10px; font-weight: bold; width: 100%; cursor: pointer; margin-top: 10px; }
        .btn:disabled { background: #555; cursor: not-allowed; }

        /* Navigation */
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #070912; padding: 10px 0; border-top: 1px solid #222; }
        .nav-item { flex: 1; text-align: center; font-size: 12px; color: #666; cursor: pointer; }
        .nav-active { color: var(--gold); font-weight: bold; }
        .nav-item span { font-size: 20px; display: block; }
    </style>
</head>
<body>

<div id="toast"></div>

<div id="p-home" class="page active">
    <div class="stats">
        <div class="stat-box"><small>Tanga</small><b id="coins">0</b></div>
        <div class="stat-box"><small>Olmos</small><b id="diams">0</b></div>
        <div class="stat-box"><small>Mining/soat</small><b id="hrate">0</b></div>
    </div>
    
    <div class="click-area">
        <div class="main-btn" onclick="handleTap()">üìÄ</div>
        <h3 id="energy-text">‚ö° 1000 / 1000</h3>
        <div style="width:100%; background:#222; height:10px; border-radius:5px; overflow:hidden;">
            <div id="energy-bar" style="width:100%; height:100%; background:var(--gold);"></div>
        </div>
    </div>
</div>

<div id="p-bonus" class="page">
    <h2>Sovg'alar üéÅ</h2>
    <div class="card-list">
        <h3>Kunlik Bonus</h3>
        <p>Reklama ko'ring va 5,000 üìÄ oling!</p>
        <button class="btn" onclick="showAdReward('daily')">Bonusni olish üé¨</button>
    </div>
    <div class="card-list" style="margin-top:20px;">
        <h3>Tasodifiy Omad</h3>
        <p>0 - 25,000 üìÄ gacha yutuq!</p>
        <button class="btn" style="background:#e67e22;" onclick="showAdReward('lucky')">Omadni sinash üé¨</button>
    </div>
</div>

<div id="p-rank" class="page">
    <h2>Top O'yinchilar üèÜ</h2>
    <div class="card-list" id="leaderboard">
        <p style="text-align:center;">Yuklanmoqda...</p>
    </div>
</div>

<div id="p-boost" class="page">
    <h2>Bosterlar ‚ö°</h2>
    <div class="card-list">
        <div class="item">
            <div><b>Tap Kuchi</b><br><small>Level: <span id="lv-tap">1</span></small></div>
            <button onclick="buyUpgrade('tap')" id="btn-tap" style="padding:8px; border-radius:5px; border:none; background:var(--gold);">500 üìÄ</button>
        </div>
        <div class="item">
            <div><b>Avto-Mining</b><br><small>Level: <span id="lv-mine">1</span></small></div>
            <button onclick="buyUpgrade('mine')" id="btn-mine" style="padding:8px; border-radius:5px; border:none; background:var(--gold);">1000 üìÄ</button>
        </div>
    </div>
</div>

<div class="nav">
    <div class="nav-item nav-active" onclick="tab('home', this)"><span>üè†</span>Uy</div>
    <div class="nav-item" onclick="tab('bonus', this)"><span>üéÅ</span>Bonus</div>
    <div class="nav-item" onclick="tab('rank', this)"><span>üèÜ</span>Rank</div>
    <div class="nav-item" onclick="tab('boost', this)"><span>‚ö°</span>Boster</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const user = tg.initDataUnsafe.user || { id: "test_user", first_name: "O'yinchi" };

    let s = { 
        coins: 0, diams: 0, energy: 1000, maxE: 1000, 
        tap: 1, mine: 0, lastS: Date.now() 
    };

    // Ma'lumotlarni yuklash (NaN xatosini oldini olish)
    db.ref('users/' + user.id).on('value', snap => {
        if(snap.exists()) {
            const d = snap.val();
            s.coins = Number(d.coins) || 0;
            s.diams = Number(d.diams) || 0;
            s.energy = Number(d.energy) || 1000;
            s.tap = Number(d.tap) || 1;
            s.mine = Number(d.mine) || 0;
            updateUI();
        } else { save(); }
    });

    function handleTap() {
        if(s.energy >= s.tap) {
            s.coins += s.tap; s.energy -= s.tap;
            updateUI();
        } else { showToast("Energiya yetarli emas!", "error"); }
    }

    // REKLAMA VA MUKOFOT
    function showAdReward(type) {
        if (typeof show_10558007 === 'function') {
            show_10558007().then(() => {
                let prize = type === 'daily' ? 5000 : Math.floor(Math.random() * 25001);
                s.coins += prize;
                save();
                showToast(`Tabriklaymiz! +${prize.toLocaleString()} üìÄ berildi!`, "success");
            }).catch(() => {
                showToast("Reklama tayyor emas! (Saytni Verify qiling)", "error");
            });
        } else {
            showToast("Reklama tizimi yuklanmagan!", "error");
        }
    }

    // BOSTERLARNI SOTIB OLISH
    function buyUpgrade(u) {
        let price = u === 'tap' ? s.tap * 500 : (s.mine + 1) * 1000;
        if(s.coins >= price) {
            s.coins -= price;
            if(u === 'tap') s.tap++; else s.mine += 10;
            save();
            showToast("Boster yangilandi!", "success");
        } else { showToast("Mablag' yetarli emas!", "error"); }
    }

    // REYTING JADVALI
    function loadRank() {
        db.ref('users').orderByChild('coins').limitToLast(10).once('value', snap => {
            let html = '', list = [];
            snap.forEach(u => list.push(u.val()));
            list.reverse().forEach((u, i) => {
                html += `<div class="item"><span>${i+1}. ${u.first_name || 'Oyinchi'}</span><b>${Math.floor(u.coins).toLocaleString()}</b></div>`;
            });
            document.getElementById('leaderboard').innerHTML = html;
        });
    }

    function tab(id, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById('p-' + id).classList.add('active');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('nav-active'));
        el.classList.add('nav-active');
        if(id === 'rank') loadRank();
    }

    function updateUI() {
        document.getElementById('coins').innerText = Math.floor(s.coins).toLocaleString();
        document.getElementById('diams').innerText = Math.floor(s.diams).toLocaleString();
        document.getElementById('hrate').innerText = s.mine;
        document.getElementById('lv-tap').innerText = s.tap;
        document.getElementById('lv-mine').innerText = s.mine;
        document.getElementById('energy-text').innerText = `‚ö° ${Math.floor(s.energy)} / ${s.maxE}`;
        document.getElementById('energy-bar').style.width = (s.energy/s.maxE*100) + "%";
        
        document.getElementById('btn-tap').innerText = (s.tap * 500).toLocaleString() + " üìÄ";
        document.getElementById('btn-mine').innerText = ((s.mine/10 + 1) * 1000).toLocaleString() + " üìÄ";
    }

    function showToast(m, type) {
        const t = document.getElementById('toast');
        t.innerText = m; t.className = type; t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 3000);
    }

    function save() { 
        db.ref('users/' + user.id).update({
            coins: s.coins, diams: s.diams, energy: s.energy, 
            tap: s.tap, mine: s.mine, first_name: user.first_name
        }); 
    }

    // Avto-Mining va Energiya tiklanishi
    setInterval(() => {
        s.energy = Math.min(s.maxE, s.energy + 1.5);
        s.coins += (s.mine / 3600);
        updateUI();
    }, 1000);

    setInterval(save, 15000); // Har 15 sekunda avto-saqlash
    tg.expand();
</script>
</body>
            </html>

    
    
    

                                                                                   
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

