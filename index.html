<div id="spin-sec" class="section">
    <h2 style="color:var(--accent)">üéÅ Tasodifiy Tanga Olish</h2>
    <div id="spin-result" style="font-size:30px; font-weight:bold; margin:30px; color:#facc15;">üéÅ Omadingizni sinang!</div>
    
    <div id="spin-info" style="font-size:12px; margin-bottom:15px; opacity:0.8;">
        Bugungi reklamali urinishlar: <span id="ads-count">0</span> / 3
    </div>

    <button class="btn" id="spin-btn" style="width:100%; height:60px;" onclick="startSpin()">
        TEKIN IMKONIYAT
    </button>
    
    <button class="btn" style="width:100%; margin-top:20px; background:#555; color:white;" onclick="closeSec()">YOPISH</button>
</div>

<script type="module">
    // ... (Firebase va boshqa sozlamalar o'zgarishsiz qoladi)

    // Yangi state o'zgaruvchilari (Buni state obyektiga qo'shing)
    if (!state.adsUsed) state.adsUsed = 0; // Reklama ko'rilgan soni
    if (!state.lastResetDate) state.lastResetDate = new Date().toDateString();

    // Har kuni urinishlarni yangilash (Reset)
    function checkDailyReset() {
        const today = new Date().toDateString();
        if (state.lastResetDate !== today) {
            state.adsUsed = 0;
            state.lastResetDate = today;
            state.lastSpin = 0; // Tekin urinishni ham tiklash
            save();
        }
    }

    window.startSpin = () => {
        checkDailyReset();
        const now = Date.now();
        const oneDay = 24 * 60 * 60 * 1000;

        // 1. Tekin urinishni tekshirish
        if (now >= (state.lastSpin || 0) + oneDay) {
            executeSpin(true);
        } 
        // 2. Reklamali urinishni tekshirish (maksimum 3 marta)
        else if (state.adsUsed < 3) {
            show_10558007().then(() => {
                state.adsUsed++;
                executeSpin(false);
            }).catch(() => {
                showNotify("Reklama yuklanmadi!");
            });
        } 
        else {
            showNotify("Bugungi barcha imkoniyatlar tugadi!");
        }
    };

    function executeSpin(isFree) {
        // Siz aytgan tasodifiy summalar
        const rewards = [0, 500, 1000, 2000, 3000, 5000, 7500, 10000, 15000, 25000, 30000, 50000];
        const win = rewards[Math.floor(Math.random() * rewards.length)];
        
        state.coins += win;
        if (isFree) state.lastSpin = Date.now();
        
        // UI yangilash
        document.getElementById('spin-result').innerText = `Tabriklaymiz! +${win.toLocaleString()} üí∞`;
        updateUI();
        save();
        
        if (win > 0) {
            document.getElementById('buy-sound').play().catch(()=>{});
        }
        updateSpinUI();
    }

    function updateSpinUI() {
        checkDailyReset();
        const now = Date.now();
        const nextFree = (state.lastSpin || 0) + (24 * 60 * 60 * 1000);
        const btn = document.getElementById('spin-btn');
        const adsText = document.getElementById('ads-count');

        adsText.innerText = state.adsUsed;

        if (now < nextFree) {
            if (state.adsUsed < 3) {
                btn.innerText = "üì∫ REKLAMA KO'RIB OLISH";
                btn.style.background = "linear-gradient(to right, #facc15, #ff8c00)";
            } else {
                btn.innerText = "ERTAGA QAYTING";
                btn.style.background = "#334155";
                btn.disabled = true;
            }
        } else {
            btn.innerText = "TEKIN IMKONIYAT";
            btn.style.background = "var(--accent)";
            btn.disabled = false;
        }
    }

    // Buni setInterval ichiga yoki init ga qo'shing
    setInterval(updateSpinUI, 1000);
        </script>

    
                                                        
                                                                </html>
                                                      
                

