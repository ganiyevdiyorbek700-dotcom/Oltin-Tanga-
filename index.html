<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga Pro</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="//libtl.com/sdk.js" data-zone="10558007" data-sdk="show_10558007"></script>

    <style>
        :root { --p: #fbc531; --s: #4cd137; --err: #ff4757; --bg: #0a0e17; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: sans-serif; margin: 0; padding: 0; }
        body { background: var(--bg); color: white; height: 100vh; overflow: hidden; transition: 0.5s; background-size: cover; }

        /* DINAMIK FONLAR (KARTALAR UCHUN) */
        .theme-default { background: radial-gradient(circle, #1e272e, #000); }
        .theme-water { background: linear-gradient(to bottom, #0097e6, #000); }
        .theme-fire { background: linear-gradient(to bottom, #c23616, #000); }
        .theme-gold { background: linear-gradient(to bottom, #e1b12c, #000); }

        .header { padding: 15px; display: flex; justify-content: space-between; background: rgba(0,0,0,0.5); }
        .stat { background: rgba(255,255,255,0.1); padding: 5px 10px; border-radius: 8px; font-size: 12px; }

        /* ASOSIY TANGA */
        .main { height: 70vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .coin-btn { width: 250px; height: 250px; background: var(--p); border-radius: 50%; border: 10px solid #cc8e00; box-shadow: 0 0 50px rgba(251,197,49,0.4); display: flex; align-items: center; justify-content: center; font-size: 80px; cursor: pointer; position: relative; transition: 0.1s; }
        .coin-btn:active { transform: scale(0.92); }
        .tap-power { position: absolute; bottom: -40px; font-size: 20px; font-weight: bold; color: var(--p); }

        /* NAV */
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #000; padding: 15px 0; border-top: 1px solid #222; }
        .nav-item { flex: 1; text-align: center; font-size: 10px; color: #777; }
        .nav-item i { font-size: 22px; display: block; margin-bottom: 5px; font-style: normal; }
        .nav-item.active { color: var(--p); }

        /* PAGES */
        .page { position: fixed; inset: 0; background: var(--bg); z-index: 100; display: none; padding: 20px; overflow-y: auto; padding-bottom: 100px; }
        .card { background: rgba(255,255,255,0.05); border-radius: 15px; padding: 15px; margin-bottom: 10px; border: 1px solid #333; }
        .btn { width: 100%; padding: 12px; border-radius: 10px; border: none; font-weight: bold; margin-top: 10px; }
        
        #notif { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 10px 25px; border-radius: 50px; z-index: 1000; display: none; font-weight: bold; }
        
        /* RUNNER GAME CANVAS */
        #runner-zone { width: 100%; height: 300px; background: #111; border: 2px solid var(--p); position: relative; overflow: hidden; display: none; }
        .player { width: 40px; height: 40px; background: #00a8ff; position: absolute; bottom: 10px; left: 50%; transition: 0.2s; border-radius: 5px; }
    </style>
</head>
<body class="theme-default">

<div id="notif"></div>

<div class="header">
    <div class="stat">ğŸ“€ <b id="st-pph">0</b>/s</div>
    <div class="stat">ğŸ¤– Robot: <b id="st-rob">0</b></div>
    <div class="stat">ğŸ’ <b id="st-diam">0</b></div>
</div>

<div class="main">
    <div style="font-size: 40px; font-weight: 900; margin-bottom: 10px;" id="st-bal">0</div>
    <div class="coin-btn" onclick="handleTap(event)">
        ğŸ“€
        <div class="tap-power">TAP: +<span id="st-tap-val">1</span></div>
    </div>
    <div style="margin-top: 50px; background: rgba(0,0,0,0.4); padding: 8px 20px; border-radius: 20px; border: 1px solid var(--p);">
        âš¡ <span id="st-en">5000</span> / 5000
    </div>
</div>

<div class="nav">
    <div class="nav-item" onclick="openP('p-shop')"><i>ğŸƒ</i>Kartalar</div>
    <div class="nav-item" onclick="openP('p-bonus')"><i>ğŸ</i>Bonus</div>
    <div class="nav-item" onclick="openP('p-games')"><i>ğŸ®</i>O'yinlar</div>
    <div class="nav-item" onclick="openP('p-rank')"><i>ğŸ†</i>Reyting</div>
    <div class="nav-item" onclick="openP('p-prof')"><i>ğŸ‘¤</i>Profil</div>
</div>

<div id="p-shop" class="page">
    <div style="display:flex; justify-content:space-between"><h2>Kartalar & Robotlar</h2> <h2 onclick="closeP('p-shop')">âœ•</h2></div>
    <div id="shop-content"></div>
    <h3 style="margin: 20px 0 10px;">Robotlar (Avto-mining)</h3>
    <div id="robot-content"></div>
</div>

<div id="p-bonus" class="page">
    <h2>Bonuslar</h2>
    <div class="card">
        <h3>ğŸ”¥ Super Tap (10x)</h3>
        <p id="t-super">Tayyor</p>
        <button class="btn" style="background:var(--p)" onclick="startAd('super')">Reklama ko'rish</button>
    </div>
    <div class="card" style="text-align:center">
        <h3>ğŸ“¦ Omadli Sandiq</h3>
        <p id="t-chest">Tayyor</p>
        <div id="chest-anim" style="font-size:60px; display:none; cursor:pointer;" onclick="claimChest()">ğŸ</div>
        <button id="btn-chest" class="btn" style="background:var(--s)" onclick="startAd('chest')">Reklama ko'rish</button>
    </div>
</div>

<div id="p-games" class="page">
    <h2>O'yinlar</h2>
    <div class="card" onclick="startAd('runner')">ğŸƒâ€â™‚ï¸ Subway Tanga (Runner)</div>
    <div id="runner-zone">
        <div id="player" class="player"></div>
        <div id="r-score" style="position:absolute; top:10px; left:10px;">Tanga: 0</div>
    </div>
    <div class="card" onclick="openP('p-flip')">ğŸª™ Coin Flip (2x)</div>
</div>

<div id="p-flip" class="page">
    <div style="display:flex; justify-content:space-between"><h3>Coin Flip</h3> <h2 onclick="closeP('p-flip')">âœ•</h2></div>
    <div id="coin-ui" style="width:100px; height:100px; background:var(--p); border-radius:50%; margin:40px auto; display:flex; align-items:center; justify-content:center; font-size:40px;">ğŸ“€</div>
    <div style="display:flex; gap:10px;">
        <button class="btn" id="f-1" style="background:#333" onclick="selFlip(1)">GERB</button>
        <button class="btn" id="f-2" style="background:#333" onclick="selFlip(2)">RAQAM</button>
    </div>
    <button class="btn" style="background:var(--p); color:000; margin-top:20px;" onclick="playFlip()">TIKISH (100)</button>
</div>

<div id="p-rank" class="page">
    <h2>Global Reyting ğŸ†</h2>
    <div id="rank-list">Yuklanmoqda...</div>
</div>

<div id="p-prof" class="page">
    <h2>Profil & Airdrop</h2>
    <div class="card" style="text-align:center">
        <h2 id="u-name">...</h2>
        <p id="u-id">ID: ---</p>
        <hr style="margin:15px 0; opacity:0.1">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px">
            <div class="stat">ğŸ“€ <b id="u-c">0</b></div>
            <div class="stat">ğŸ’ <b id="u-d">0</b></div>
            <div class="stat">â­ Lvl: <b id="u-l">1</b></div>
            <div class="stat">ğŸ¤– Rob: <b id="u-r">0</b></div>
        </div>
        <div id="ton-btn" style="margin-top:20px"></div>
    </div>
    <div class="card" style="border:1px solid var(--s); background:rgba(76,209,55,0.05)">
        <h3 style="color:var(--s)">ğŸš€ Airdrop Countdown</h3>
        <h2 id="air-timer">---</h2>
        <p style="font-size:11px; margin-top:10px; border:1px solid rgba(255,255,255,0.1); padding:10px; border-radius:10px;">
            O'yinchilar 100 kun davomida faol bo'lganlar, darajalarini oshirgan, robot sotib olgan va hamyon ulaganlar uchun TON yuboriladi. Faol bo'ling!
        </p>
    </div>
</div>

<script>
// --- CORE SETUP ---
const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tg = window.Telegram.WebApp;
const user = tg.initDataUnsafe?.user || { id: "7462622808", first_name: "Ganiyev" };

// O'YIN DATA
let s = { c:0, d:0, pph:0, e:5000, tap:1, lvl:1, cards:[], robs:{}, lastOff:Date.now(), lastS:0, lastC:0 };

const themes = [
    { n: "Boshlang'ich", p:0, cls: "theme-default" },
    { n: "Suvli Karta ğŸ’§", p:50000, cls: "theme-water" },
    { n: "Olovli Karta ğŸ”¥", p:250000, cls: "theme-fire" },
    { n: "Oltin Karta ğŸ‘‘", p:1000000, cls: "theme-gold" }
];

const robotData = [];
for(let i=1; i<=10; i++) robotData.push({ id:i, n:"Robot v"+i, p:15000*i*i, c:3000*i, d:1*i });

function init() {
    db.ref('users/' + user.id).once('value', snap => {
        if(snap.val()) {
            let data = snap.val();
            // NaN oldini olish
            s.c = isNaN(data.c) ? 0 : data.c;
            s.d = isNaN(data.d) ? 0 : data.d;
            s.pph = isNaN(data.pph) ? 0 : data.pph;
            s.lvl = isNaN(data.lvl) ? 1 : data.lvl;
            s.cards = data.cards || [];
            s.robs = data.robs || {};
            s.lastOff = data.lastOff || Date.now();
        }
        calculateOff();
        updateUI();
        renderShop();
        setInterval(loop, 1000);
        setInterval(save, 10000);
    });
    const ton = new TON_CONNECT_UI.TonConnectUI({ manifestUrl: 'https://ganiyevdiyorbek700-dotcom.github.io/Oltin-Tanga-/tonconnect-manifest.json', buttonRootId: 'ton-btn' });
    tg.expand();
}

function calculateOff() {
    let diff = Math.floor((Date.now() - s.lastOff)/1000);
    if(diff > 60) {
        let rc=0, rd=0;
        Object.keys(s.robs).forEach(id => { 
            rc += (robotData[id-1].c/3600)*diff; 
            rd += (robotData[id-1].d/3600)*diff; 
        });
        s.c += rc; s.d += rd;
        if(rc > 1) notify(`Robotlar siz yo'qligingizda ${Math.floor(rc)} yig'di!`, 'green');
    }
}

function loop() {
    s.c += (s.pph/3600);
    Object.keys(s.robs).forEach(id => {
        s.c += robotData[id-1].c/3600;
        s.d += robotData[id-1].d/3600;
    });
    if(s.e < 5000) s.e += 2;
    updateUI();
    
    // Bonus Timers
    let now = Date.now();
    let s_rem = Math.max(0, 1800000 - (now - s.lastS));
    let c_rem = Math.max(0, 1800000 - (now - s.lastC));
    document.getElementById('t-super').innerText = s_rem > 0 ? Math.floor(s_rem/60000)+"m" : "Tayyor";
    document.getElementById('t-chest').innerText = c_rem > 0 ? Math.floor(c_rem/60000)+"m" : "Tayyor";
}

function handleTap(e) {
    if(s.e >= s.tap) {
        s.c += s.tap; s.e -= s.tap;
        // Daraja oshirish (Har 100k da)
        let next = 100000 * s.lvl;
        if(s.c >= next && s.lvl < 20) { s.lvl++; notify("YANGI DARAJA!", 'green'); }
        updateUI();
        createTapAnim(e);
    } else {
        startAd('energy');
    }
}

function updateUI() {
    document.getElementById('st-bal').innerText = Math.floor(s.c).toLocaleString();
    document.getElementById('st-diam').innerText = Math.floor(s.d).toLocaleString();
    document.getElementById('st-pph').innerText = Math.floor(s.pph);
    document.getElementById('st-en').innerText = Math.floor(s.e);
    document.getElementById('st-rob').innerText = Object.keys(s.robs).length;
    document.getElementById('st-tap-val').innerText = s.tap;

    // Profil
    document.getElementById('u-name').innerText = user.first_name;
    document.getElementById('u-id').innerText = "ID: " + user.id;
    document.getElementById('u-c').innerText = Math.floor(s.c).toLocaleString();
    document.getElementById('u-d').innerText = Math.floor(s.d).toLocaleString();
    document.getElementById('u-l').innerText = s.lvl;
    document.getElementById('u-r').innerText = Object.keys(s.robs).length;

    // Theme
    if(s.cards.length > 0) {
        let last = themes[s.cards[s.cards.length-1]];
        document.body.className = last.cls;
    }

    // Timer
    let end = new Date("2026-05-20").getTime();
    let diff = end - Date.now();
    let d=Math.floor(diff/(86400000)), h=Math.floor((diff%86400000)/3600000), m=Math.floor((diff%3600000)/60000), sec=Math.floor((diff%60000)/1000);
    document.getElementById('air-timer').innerText = `${d} KUN ${h}:${m}:${sec}`;
}

// SHOP & ROBOTS
function renderShop() {
    let h = '';
    themes.forEach((t, i) => {
        let has = s.cards.includes(i);
        h += `<div class="card"><b>${t.n}</b><br><small>Asosiy menyuni o'zgartiradi</small>
            <button class="btn" style="background:${has?'#444':'var(--p)'}" onclick="buyT(${i},${t.p})" ${has?'disabled':''}>${has?'OLINGAN':t.p.toLocaleString()}</button></div>`;
    });
    document.getElementById('shop-content').innerHTML = h;

    let rh = '';
    robotData.forEach(r => {
        let has = s.robs[r.id];
        rh += `<div class="card" style="border-left:4px solid var(--s)"><b>${r.n}</b><br><small>${r.c}ğŸ“€/s & ${r.d}ğŸ’/s</small>
            <button class="btn" style="background:${has?'#444':'var(--s)'}" onclick="buyR(${r.id},${r.p})" ${has?'disabled':''}>${has?'FAOL':r.p.toLocaleString()}</button></div>`;
    });
    document.getElementById('robot-content').innerHTML = rh;
}

function buyT(i, p) { if(s.c >= p) { s.c -= p; s.cards.push(i); save(); renderShop(); updateUI(); notify("Karta olindi!", 'green'); } else notify("Mablag' kam!", 'red'); }
function buyR(i, p) { if(s.c >= p) { s.c -= p; s.robs[i]=true; save(); renderShop(); updateUI(); notify("Robot ishga tushdi!", 'green'); } else notify("Mablag' kam!", 'red'); }

// AD & BONUS
function startAd(type) {
    if(typeof show_10558007 === 'function') {
        show_10558007().then(() => {
            if(type=='super') { s.lastS = Date.now(); s.tap = 10; setTimeout(()=>s.tap=1, 60000); notify("SUPER TAP YOQILDI!", 'green'); }
            if(type=='chest') { document.getElementById('chest-anim').style.display='block'; document.getElementById('btn-chest').style.display='none'; }
            if(type=='energy') { s.e = 5000; notify("ENERGIA TO'LDI!", 'green'); }
            if(type=='runner') startRunner();
        });
    } else {
        notify("Reklama topilmadi (Test rejimi)", 'red');
        if(type=='runner') startRunner();
        if(type=='chest') { document.getElementById('chest-anim').style.display='block'; document.getElementById('btn-chest').style.display='none'; }
    }
}

function claimChest() {
    let win = Math.floor(Math.random()*5000)+500; s.c += win; s.lastC = Date.now();
    document.getElementById('chest-anim').style.display='none';
    document.getElementById('btn-chest').style.display='block';
    notify(`${win} Tanga yutdingiz!`, 'green');
    updateUI(); save();
}

// SUBWAY RUNNER
function startRunner() {
    document.getElementById('runner-zone').style.display='block';
    let score = 0; let pos = 50;
    document.getElementById('runner-zone').onclick = (e) => {
        pos = e.clientX < window.innerWidth/2 ? 20 : 80;
        document.getElementById('player').style.left = pos + "%";
    };
    
    let gInt = setInterval(() => {
        let item = document.createElement('div');
        item.style.cssText = `position:absolute; top:-30px; left:${Math.random()>0.5?20:80}%; font-size:25px; transition:0.1s linear;`;
        item.innerText = "ğŸ“€";
        document.getElementById('runner-zone').appendChild(item);

        let fall = setInterval(() => {
            let t = parseInt(item.style.top || 0);
            item.style.top = (t + 5) + "px";
            if(t > 240 && t < 280 && parseInt(item.style.left) == pos) {
                s.c += 100; score += 100;
                document.getElementById('r-score').innerText = "Tanga: " + score;
                item.remove(); clearInterval(fall);
            }
            if(t > 300) { item.remove(); clearInterval(fall); }
        }, 30);
    }, 1000);

    setTimeout(() => { 
        clearInterval(gInt); 
        document.getElementById('runner-zone').style.display='none'; 
        notify(`O'yin tugadi: +${score}`, 'green'); 
    }, 20000);
}

// COIN FLIP
let fSel = 0;
function selFlip(n) { fSel=n; document.getElementById('f-1').style.background=n==1? 'var(--p)':'#333'; document.getElementById('f-2').style.background=n==2? 'var(--p)':'#333'; }
function playFlip() {
    if(s.c >= 100 && fSel > 0) {
        s.c -= 100;
        let c = document.getElementById('coin-ui');
        c.style.transform = "rotateY(720deg)";
        setTimeout(() => {
            let res = Math.random() > 0.5 ? 1 : 2;
            c.innerText = res==1?'ğŸ“€':'ğŸ”¢';
            c.style.transform = "rotateY(0deg)";
            if(res == fSel) { s.c += 200; notify("G'ALABA!", 'green'); } else notify("YO'QOTDINGIZ!", 'red');
            updateUI();
        }, 600);
    }
}

// RANKING
function loadRank() {
    db.ref('users').orderByChild('c').limitToLast(10).once('value', snap => {
        let h = ''; let players = [];
        snap.forEach(x => { let d = x.val(); if(d.c) players.push(d); });
        players.reverse().forEach((p, i) => {
            h += `<div class="card" style="display:flex; justify-content:space-between">
                <span>${i+1}. ${p.first_name || 'O'yinchi'}</span>
                <b>${Math.floor(p.c).toLocaleString()} ğŸ“€</b>
            </div>`;
        });
        document.getElementById('rank-list').innerHTML = h;
    });
}

function save() { s.lastOff = Date.now(); db.ref('users/' + user.id).update(s); }
function openP(id) { if(id=='p-rank') loadRank(); document.getElementById(id).style.display='block'; }
function closeP(id) { document.getElementById(id).style.display='none'; }
function notify(m, color) { 
    let n = document.getElementById('notif'); 
    n.innerText = m; n.style.background = color=='green'?'var(--s)':'var(--err)';
    n.style.display='block'; setTimeout(()=>n.style.display='none',3000); 
}
function createTapAnim(e) {
    let t = document.createElement('div'); t.innerText = "+"+s.tap;
    t.style.cssText = `position:fixed; left:${e.clientX}px; top:${e.clientY}px; color:var(--p); font-weight:bold; pointer-events:none; animation: tapup 0.8s forwards; z-index:9999;`;
    document.body.appendChild(t); setTimeout(()=>t.remove(),800);
}

init();
</script>
<style> @keyframes tapup { to { transform: translateY(-100px); opacity:0; } } </style>
</body>
    </html>
    
    
    
        
            
        
                                               
    
            
        
        
    
        
    
    
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

