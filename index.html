<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="monetag" content="6d6c27c8cb845b8dc1e72729aa2b63ab">
    <title>Oltin Tanga - Pro</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="//libtl.com/sdk.js" data-zone="10558007" data-sdk="show_10558007"></script>

    <style>
        :root { --gold: #ffd700; --bg: #0b0d17; --card: #1c222d; --green: #2ecc71; --red: #e74c3c; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; }

        .bg-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; opacity: 0.4; pointer-events: none; }
        .moon-bg { background: radial-gradient(circle at top right, #f5f3ce, transparent 40%); }
        .ice-bg { background: linear-gradient(to bottom, #a5f3fc, transparent); }
        .space-bg { background: url('https://www.transparenttextures.com/patterns/stardust.png'), #000; }

        /* Tepadagi 4 ta status */
        .top-stats {
            display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: auto auto; gap: 8px; padding: 12px; background: rgba(0,0,0,0.6);
        }
        .stat-box { background: var(--card); padding: 6px; border-radius: 8px; text-align: center; border: 1px solid #333; }
        .stat-box small { font-size: 9px; color: #aaa; display: block; margin-bottom: 2px; }
        .stat-box b { font-size: 13px; color: var(--gold); }

        .game-area { display: flex; flex-direction: column; align-items: center; justify-content: flex-end; height: 68vh; padding-bottom: 40px; }
        .coin-wrapper { position: relative; width: 250px; height: 250px; z-index: 10; margin-bottom: 15px; }
        .coin-main {
            width: 100%; height: 100%; background: radial-gradient(circle, #ffe066, #ffb300);
            border-radius: 50%; border: 8px solid #cc8e00; box-shadow: 0 0 40px rgba(255,215,0,0.3);
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            transition: transform 0.05s ease;
        }
        .coin-main:active { transform: scale(0.92); }
        .tap-power-text { font-size: 36px; font-weight: 900; color: #4d3300; }

        .energy-container { width: 80%; text-align: center; }
        .energy-bar-bg { width: 100%; height: 10px; background: #222; border-radius: 5px; overflow: hidden; margin-top: 5px; }
        #energy-fill { height: 100%; background: var(--gold); width: 100%; transition: width 0.2s; }

        .nav-bar {
            position: fixed; bottom: 0; width: 100%; background: #07090c;
            display: flex; justify-content: space-around; padding: 15px 5px; border-top: 1px solid #222; z-index: 100;
        }
        .nav-btn { color: #666; text-align: center; font-size: 11px; cursor: pointer; flex: 1; }
        .nav-btn i { font-size: 22px; display: block; margin-bottom: 4px; }
        .nav-btn.active { color: var(--gold); }

        .page {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg);
            z-index: 200; padding: 20px; display: none; overflow-y: auto; padding-bottom: 100px;
        }
        .close-page { float: right; font-size: 30px; color: #fff; cursor: pointer; }
        .card { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #333; position: relative; }
        .lock-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.85); border-radius:15px; display:flex; align-items:center; justify-content:center; color: #ff4d4d; font-weight:bold; z-index: 5;}

        .btn { width: 100%; padding: 12px; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; background: var(--gold); color: #000; margin-top: 8px; font-size: 15px; }
        #notify { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); padding: 10px 20px; border-radius: 20px; z-index: 3000; display: none; font-weight: bold; }
        
        .rank-row { display: flex; justify-content: space-between; padding: 12px; border-radius: 8px; margin-bottom: 6px; border: 1px solid #333; }
        .rank-1 { background: linear-gradient(90deg, #ffd700, #b8860b); color: #000; }
        .rank-2 { background: linear-gradient(90deg, #e0e0e0, #9e9e9e); color: #000; }
        .rank-3 { background: linear-gradient(90deg, #cd7f32, #8b4513); color: #000; }
    </style>
</head>
<body>

<div id="notify"></div>
<div id="bg-fx" class="bg-overlay"></div>

<div class="top-stats">
    <div class="stat-box"><small>ğŸ“€ Tanga/soat</small><b id="coin-pph-val">0</b></div>
    <div class="stat-box"><small>ğŸ’ Olmos/soat</small><b id="diam-pph-val">0</b></div>
    <div class="stat-box"><small>ğŸ’ Olmoslar</small><b id="diam-total-val">0</b></div>
    <div class="stat-box"><small>â­ Daraja (1-10)</small><b id="lvl-val">1</b></div>
</div>

<div class="game-area">
    <div id="balance-main" style="color:var(--gold); font-size: 36px; margin-bottom: 10px; font-weight: bold;">0</div>
    <div class="coin-wrapper" onclick="handleTap(event)">
        <div class="coin-main" id="target-coin">
            <div class="tap-power-text" id="tap-power-val">+1</div>
        </div>
    </div>
    <div class="energy-container">
        <span>âš¡ <span id="e-text">500/500</span></span>
        <div class="energy-bar-bg"><div id="energy-fill"></div></div>
    </div>
</div>

<div class="nav-bar">
    <div class="nav-btn" onclick="openPage('p-market')"><i>ğŸ›’</i>Market</div>
    <div class="nav-btn" onclick="openPage('p-bonus')"><i>ğŸ</i>Bonus</div>
    <div class="nav-btn" onclick="openPage('p-rank')"><i>ğŸ†</i>Rank</div>
    <div class="nav-btn" onclick="openPage('p-boost')"><i>âš¡</i>Booster</div>
    <div class="nav-btn" onclick="openPage('p-home')"><i>ğŸ‘¤</i>Profil</div>
</div>

<div id="p-market" class="page">
    <span class="close-page" onclick="closePage('p-market')">âœ–</span>
    <h2>Market ğŸ›’</h2>
    <div class="card"><b>ğŸŸ« Bronza Tanga</b><p>+10 ğŸ’/soat. Narxi: 100 ğŸ’</p><button class="btn" onclick="buyItem('bronze', 100)">Sotib olish</button></div>
    <div class="card"><b>â¬œ Kumush Tanga</b><p>+15 ğŸ’/soat. Narxi: 200 ğŸ’</p><button class="btn" onclick="buyItem('silver', 200)">Sotib olish</button></div>
    <div class="card"><div id="lock-epic" class="lock-overlay">Daraja 3 kerak!</div><b>ğŸŸ¨ Oltin Tanga</b><p>+25 ğŸ’/soat. Fon: Oy. Narxi: 350 ğŸ’</p><button class="btn" onclick="buyItem('gold', 350)">Sotib olish</button></div>
    <div class="card"><div id="lock-epic2" class="lock-overlay">Daraja 3 kerak!</div><b>ğŸŸ© Zumrad Tanga</b><p>+35 ğŸ’/soat. Narxi: 500 ğŸ’</p><button class="btn" onclick="buyItem('emerald', 500)">Sotib olish</button></div>
    <div class="card"><div id="lock-special" class="lock-overlay">Daraja 7 kerak!</div><b>ğŸ’ Platina Tanga</b><p>+100 ğŸ’/soat. Fon: Muz. Narxi: 1000 ğŸ’</p><button class="btn" onclick="buyItem('platinum', 1000)">Sotib olish</button></div>
    <div class="card"><div id="lock-special2" class="lock-overlay">Daraja 7 kerak!</div><b>ğŸŒŒ Kosmik Tanga</b><p>+250 ğŸ’/soat. Fon: Kosmos. Narxi: 5000 ğŸ’</p><button class="btn" onclick="buyItem('cosmic', 5000)">Sotib olish</button></div>
    <div class="card"><h3>Ayirboshlash</h3><input type="number" id="swap-input" placeholder="Tanga miqdori" style="width:100%; padding:10px;"><button class="btn" onclick="swapCoins()">1000 Tanga -> 1 Olmos</button></div>
</div>

<div id="p-bonus" class="page">
    <span class="close-page" onclick="closePage('p-bonus')">âœ–</span>
    <h2>Bonuslar ğŸ</h2>
    <div class="card"><h3>Kunlik Bonus</h3><button class="btn" onclick="claimDaily()">Olish ğŸ¬</button></div>
    <div class="card"><h3>Tasodifiy Tanga</h3><p id="lucky-count-text">Imkoniyat: 3/3</p><button class="btn" onclick="claimLucky()">Sinab ko'rish ğŸ¬</button></div>
</div>

<div id="p-rank" class="page">
    <span class="close-page" onclick="closePage('p-rank')">âœ–</span>
    <h2>Top O'yinchilar ğŸ†</h2>
    <div id="leaderboard-list"></div>
</div>

<div id="p-boost" class="page">
    <span class="close-page" onclick="closePage('p-boost')">âœ–</span>
    <h2>Bosterlar âš¡</h2>
    <div class="card"><b>â› Soatbay Tanga Daromadi</b><p>Lvl: <span id="b-pph-lvl">1</span></p><button class="btn" onclick="buyBoost('pph')">Narxi: <span id="b-pph-cost">500</span> ğŸ“€</button></div>
    <div class="card"><b>âš¡ Energiya Sig'imi</b><p>Lvl: <span id="b-e-lvl">1</span></p><button class="btn" onclick="buyBoost('energy')">Narxi: <span id="b-e-cost">500</span> ğŸ“€</button></div>
    <div class="card"><b>ğŸ‘† Tap Kuchi</b><p>Lvl: <span id="b-tap-lvl">1</span></p><button class="btn" onclick="buyBoost('tap')">Narxi: <span id="b-tap-cost">500</span> ğŸ“€</button></div>
</div>

<div id="p-home" class="page">
    <span class="close-page" onclick="closePage('p-home')">âœ–</span>
    <h2>Profil ğŸ‘¤</h2>
    <div class="card"><p>Ism: <b id="u-name">...</b></p><p>ID: <small id="u-id">...</small></p><p>Balans: <span id="ton-bal">0</span> TON</p></div>
    <button class="btn" onclick="convertToTon()">1M ğŸ“€ + 10k ğŸ’ = 1 TON</button>
</div>

<audio id="click-sound" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop></audio>

<script>
// --- Firebase Config qismini shunday qoldiring ---
const firebaseConfig = { 
    databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" 
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const tg = window.Telegram.WebApp;
// Foydalanuvchi ID sini tekshirish
const user = tg.initDataUnsafe && tg.initDataUnsafe.user ? tg.initDataUnsafe.user : { id: "000000", first_name: "O'yinchi" };

// Profil bo'limida ID ko'rinishi uchun:
document.getElementById('u-id').innerText = user.id;
document.getElementById('u-name').innerText = user.first_name;

// --- REYTING BO'LIMI (Undefined muammosini tuzatish) ---
function loadRank() {
    const listDiv = document.getElementById('leaderboard-list');
    listDiv.innerHTML = "Yuklanmoqda...";
    
    db.ref('users').orderByChild('coins').limitToLast(20).once('value', snap => {
        if(!snap.exists()) {
            listDiv.innerHTML = "Hozircha hech kim yo'q";
            return;
        }
        
        let list = []; 
        snap.forEach(u => {
            let data = u.val();
            // Agar ism undefined bo'lsa "Noma'lum" deb yozadi
            list.push({
                name: data.first_name || "Noma'lum",
                coins: data.coins || 0
            });
        });

        // Kattadan kichikka saralash
        list.sort((a, b) => b.coins - a.coins);
        
        let html = '';
        list.forEach((u, i) => {
            let cls = i === 0 ? 'rank-1' : (i === 1 ? 'rank-2' : (i === 2 ? 'rank-3' : ''));
            html += `<div class="rank-row ${cls}">
                <span>${i+1}. ${u.name}</span>
                <b>${Math.floor(u.coins).toLocaleString()}</b>
            </div>`;
        });
        listDiv.innerHTML = html;
    }).catch(err => {
        listDiv.innerHTML = "Xatolik: " + err.message;
    });
    }
                                                               
let s = {
    coins: 0, diamonds: 0, ton: 0,
    lvl: 1, pphDiam: 0, pphCoin: 0,
    energy: 500, maxE: 500, 
    tap: 1, tapLvl: 1, pphLvl: 1, eLvl: 1,
    lastD: 0, luckyC: 3, skin: 'default'
};

const levels = [0, 50000, 100000, 500000, 1000000, 10000000, 50000000, 100000000, 5000000000, 15000000000];

db.ref('users/' + user.id).on('value', snap => {
    if(snap.exists()) { Object.assign(s, snap.val()); updateUI(); }
    else save();
});

function handleTap(e) {
    if(s.energy >= s.tap) {
        s.coins += s.tap; s.energy -= s.tap;
        createTapFX(e); updateUI();
        document.getElementById('click-sound').play().catch(()=>{});
    } else {
        showNotify("Energiya tugadi!", "red");
        runAd('pop', () => { s.energy = s.maxE; updateUI(); });
    }
}

function createTapFX(e) {
    const fx = document.createElement('div');
    fx.innerText = `+${s.tap}`;
    fx.style.cssText = `position:fixed; left:${e.clientX}px; top:${e.clientY}px; color:var(--gold); font-weight:bold; pointer-events:none; animation: fly 0.6s forwards; z-index:999; font-size: 20px;`;
    document.body.appendChild(fx); setTimeout(() => fx.remove(), 600);
}

function updateUI() {
    let clvl = 1;
    for(let i=0; i<levels.length; i++) { if(s.coins >= levels[i]) clvl = i+1; }
    s.lvl = clvl;

    document.getElementById('balance-main').innerText = Math.floor(s.coins).toLocaleString();
    document.getElementById('coin-pph-val').innerText = Math.floor(s.pphCoin);
    document.getElementById('diam-pph-val').innerText = Math.floor(s.pphDiam);
    document.getElementById('diam-total-val').innerText = Math.floor(s.diamonds).toLocaleString();
    document.getElementById('lvl-val').innerText = s.lvl;
    document.getElementById('e-text').innerText = `${Math.floor(s.energy)}/${s.maxE}`;
    document.getElementById('energy-fill').style.width = (s.energy/s.maxE*100) + "%";
    document.getElementById('tap-power-val').innerText = `+${s.tap}`;
    
    document.getElementById('b-tap-lvl').innerText = s.tapLvl;
    document.getElementById('b-tap-cost').innerText = (500 * Math.pow(2, s.tapLvl-1)).toLocaleString();
    document.getElementById('b-e-lvl').innerText = s.eLvl;
    document.getElementById('b-e-cost').innerText = (500 * Math.pow(2, s.eLvl-1)).toLocaleString();
    document.getElementById('b-pph-lvl').innerText = s.pphLvl;
    document.getElementById('b-pph-cost').innerText = (500 * Math.pow(2, s.pphLvl-1)).toLocaleString();
    document.getElementById('lucky-count-text').innerText = `Imkoniyat: ${s.luckyC}/3`;
    document.getElementById('u-name').innerText = user.first_name;

    document.getElementById('lock-epic').style.display = s.lvl >= 3 ? 'none' : 'flex';
    document.getElementById('lock-epic2').style.display = s.lvl >= 3 ? 'none' : 'flex';
    document.getElementById('lock-special').style.display = s.lvl >= 7 ? 'none' : 'flex';
    document.getElementById('lock-special2').style.display = s.lvl >= 7 ? 'none' : 'flex';

    const bg = document.getElementById('bg-fx');
    bg.className = 'bg-overlay';
    if(s.skin === 'gold') bg.classList.add('moon-bg');
    if(s.skin === 'platinum') bg.classList.add('ice-bg');
    if(s.skin === 'cosmic') bg.classList.add('space-bg');
}

function buyBoost(type) {
    let cost = 0;
    if(type === 'tap') {
        cost = 500 * Math.pow(2, s.tapLvl-1);
        if(s.coins >= cost) { s.coins -= cost; s.tapLvl++; s.tap++; showNotify("Zarba oshdi!", "green"); }
    } else if(type === 'energy') {
        cost = 500 * Math.pow(2, s.eLvl-1);
        if(s.coins >= cost) { s.coins -= cost; s.eLvl++; s.maxE += 500; s.energy = s.maxE; showNotify("Sig'im oshdi!", "green"); }
    } else if(type === 'pph') {
        cost = 500 * Math.pow(2, s.pphLvl-1);
        if(s.coins >= cost) { s.coins -= cost; s.pphLvl++; s.pphCoin += 100; showNotify("Soatbay foyda oshdi!", "green"); }
    }
    save();
}

function buyItem(id, price) {
    if(s.diamonds >= price) {
        s.diamonds -= price;
        if(id === 'bronze') s.pphDiam += 10;
        if(id === 'silver') s.pphDiam += 15;
        if(id === 'gold') { s.pphDiam += 25; s.skin = 'gold'; }
        if(id === 'emerald') s.pphDiam += 35;
        if(id === 'platinum') { s.pphDiam += 100; s.skin = 'platinum'; }
        if(id === 'cosmic') { s.pphDiam += 250; s.skin = 'cosmic'; }
        showNotify("Sotib olindi!", "green"); save();
    } else showNotify("Olmos yetarli emas!", "red");
}

function claimLucky() {
    if(s.luckyC > 0) {
        runAd('reward', () => {
            let win = Math.floor(Math.random() * 10001);
            s.coins += win; s.luckyC--;
            showNotify(`+${win} Tanga!`, "green"); save();
        });
    } else showNotify("Imkoniyat tugadi!", "red");
}

function claimDaily() {
    let now = Date.now();
    if(now - s.lastD > 86400000) {
        runAd('reward', () => {
            s.coins += 1000; s.lastD = now;
            showNotify("+1000 Kunlik Bonus!", "green"); save();
        });
    } else showNotify("Ertaga kiring!", "red");
}

function swapCoins() {
    let v = parseInt(document.getElementById('swap-input').value);
    if(v >= 1000 && s.coins >= v) {
        s.coins -= v; s.diamonds += Math.floor(v/1000);
        showNotify("Almashtirildi!", "green"); save();
    }
}

function convertToTon() {
    if(s.coins >= 1000000 && s.diamonds >= 10000) {
        s.coins -= 1000000; s.diamonds -= 10000; s.ton += 1;
        showNotify("1 TON qo'shildi!", "green"); save();
    } else showNotify("Mablag' yetarli emas!", "red");
}

function loadRank() {
    db.ref('users').orderByChild('coins').limitToLast(20).once('value', snap => {
        let list = []; snap.forEach(u => list.push(u.val()));
        list.sort((a,b) => b.coins - a.coins);
        let h = '';
        list.forEach((u, i) => {
            let c = i<3 ? `rank-${i+1}` : '';
            h += `<div class="rank-row ${c}"><span>${i+1}. ${u.first_name}</span><b>${Math.floor(u.coins).toLocaleString()}</b></div>`;
        });
        document.getElementById('leaderboard-list').innerHTML = h;
    });
}

function openPage(id) { document.getElementById(id).style.display = 'block'; if(id==='p-rank') loadRank(); }
function closePage(id) { document.getElementById(id).style.display = 'none'; }
function save() { db.ref('users/' + user.id).update({...s, first_name: user.first_name}); }
function showNotify(m, c) {
    let n = document.getElementById('notify'); n.innerText = m;
    n.style.background = c === 'green' ? '#2ecc71' : '#e74c3c';
    n.style.display = 'block'; setTimeout(() => n.style.display = 'none', 2000);
}
function runAd(t, c) { if(typeof show_10558007 === 'function') show_10558007().then(c).catch(c); else c(); }

setInterval(() => {
    s.energy = Math.min(s.maxE, s.energy + 1.5);
    if(s.pphCoin > 0) s.coins += (s.pphCoin / 3600);
    if(s.pphDiam > 0) s.diamonds += (s.pphDiam / 3600);
    updateUI();
}, 1000);

tg.expand();
window.onclick = () => { document.getElementById('click-sound').play().catch(()=>{}); };
</script>

<style> @keyframes fly { 0% { opacity:1; transform:translateY(0); } 100% { opacity:0; transform:translateY(-120px); } } </style>
</body>
    </html>
                                                                                                                                                       
    

                                                                                   
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

