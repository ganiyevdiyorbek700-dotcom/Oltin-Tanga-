<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga: Mega Pro 2026</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

    <style>
        :root { --gold: #fbc531; --bg: #0c111c; --card: #1c2230; --green: #4cd137; --blue: #00d2ff; --ruby: #ff4757; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin:0; padding:0; font-family: 'Segoe UI', sans-serif; }
        
        body { background: var(--bg); color: white; height: 100vh; overflow: hidden; display: flex; flex-direction: column; transition: 0.5s; }

        /* Tepadagi Statuslar */
        .header-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; padding: 15px; position: relative; z-index: 5; }
        .s-box { background: var(--card); border: 1px solid #2f3640; border-radius: 12px; padding: 10px; text-align: center; }
        .s-box small { font-size: 10px; color: #888; display: block; }
        .s-box b { color: var(--green); font-size: 14px; }

        /* Level Bar */
        .lvl-section { padding: 0 15px; margin-top: 5px; }
        .lvl-info { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px; font-weight: bold; }
        .lvl-track { background: #1e272e; height: 8px; border-radius: 10px; overflow: hidden; border: 1px solid #333; }
        #lvl-fill { background: var(--gold); height: 100%; width: 0%; transition: 0.5s; box-shadow: 0 0 10px var(--gold); }

        /* Asosiy Markaz (Tanga) */
        .main-stage { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        .balance-h { font-size: 60px; font-weight: 900; color: var(--gold); text-shadow: 0 0 25px rgba(251,197,49,0.4); margin: 0; }
        .diamond-h { font-size: 20px; color: var(--blue); margin-bottom: 20px; font-weight: bold; }

        .big-coin {
            width: 280px; height: 280px;
            background: radial-gradient(circle, #fbc531, #cc8e00);
            border-radius: 50%; border: 10px solid #8a6200;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; position: relative; transition: transform 0.05s;
            box-shadow: 0 15px 50px rgba(0,0,0,0.6);
            z-index: 10;
        }
        .big-coin:active { transform: scale(0.92); }
        .tap-anim-val { font-size: 65px; font-weight: 900; color: white; pointer-events: none; text-shadow: 2px 2px 10px rgba(0,0,0,0.5); }

        /* Energiya */
        .energy-section { margin-bottom: 30px; text-align: center; }
        .energy-badge { background: rgba(0,0,0,0.5); padding: 8px 30px; border-radius: 30px; border: 1px solid #333; display: inline-flex; align-items: center; gap: 10px; }
        
        /* Navigatsiya */
        .navbar { display: flex; background: #0a0e17; padding: 12px 0; border-top: 1px solid #222; z-index: 100; }
        .nav-btn { flex: 1; text-align: center; font-size: 10px; color: #7f8fa6; cursor: pointer; }
        .nav-btn i { font-size: 24px; display: block; margin-bottom: 4px; font-style: normal; }
        .nav-btn.active { color: var(--gold); }

        /* Modallar (Sahifalar) */
        .modal { position: fixed; inset: 0; background: var(--bg); z-index: 1000; padding: 20px; display: none; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .x-btn { font-size: 30px; color: var(--ruby); cursor: pointer; }

        /* Kartalar & Grid */
        .card-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .item-card { background: var(--card); border-radius: 15px; padding: 15px; text-align: center; border: 1px solid #2f3640; position: relative; }
        .buy-btn { width: 100%; background: var(--gold); border: none; padding: 12px; border-radius: 10px; font-weight: bold; margin-top: 10px; cursor: pointer; color: #000; }
        .buy-btn:disabled { background: #444; color: #888; cursor: not-allowed; }

        /* Aviator Stili */
        #aviator-zone { background: #05080f; border-radius: 20px; padding: 20px; text-align: center; position: relative; overflow: hidden; border: 2px solid #222; min-height: 250px; }
        #av-multiplier { font-size: 50px; font-weight: 900; color: var(--gold); margin-top: 40px; }
        #av-rocket { font-size: 40px; position: absolute; bottom: 20px; left: 10%; transition: 0.1s; }

        /* Puzzle Stili */
        #puz-board { display: grid; grid-template-columns: repeat(6, 1fr); gap: 2px; background: #333; border: 2px solid #333; margin-top: 10px; }
        .puz-tile { width: 100%; aspect-ratio: 1; background: var(--card); display: flex; align-items: center; justify-content: center; font-size: 10px; cursor: pointer; }

        /* Reyting Stili */
        .rank-row { background: var(--card); padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; margin-bottom: 10px; border: 1px solid #2f3640; }

        #toast-msg { position: fixed; top: 40px; left: 50%; transform: translateX(-50%); background: white; color: black; padding: 12px 30px; border-radius: 50px; z-index: 10001; display: none; font-weight: bold; box-shadow: 0 5px 20px rgba(0,0,0,0.3); }

        /* Tabaqa Fonlari */
        body.tab-1 { background: var(--bg); }
        body.tab-2 { background: linear-gradient(180deg, #0c111c 0%, #1e3799 100%); }
        body.tab-3 { background: radial-gradient(circle, #2c3e50 0%, #000000 100%); }
        body.tab-4 { background: linear-gradient(180deg, #0c111c 0%, #b71c1c 100%); }
        body.tab-5 { background: linear-gradient(180deg, #0c111c 0%, #1b5e20 100%); }
    </style>
</head>
<body class="tab-1">

<div id="toast-msg"></div>

<div class="header-stats">
    <div class="s-box"><small>üìÄ Tanga Mining</small><b id="ui-pph">0 /s</b></div>
    <div class="s-box"><small>üíé Olmos Mining</small><b id="ui-dph">0 /s</b></div>
</div>

<div class="lvl-section">
    <div class="lvl-info"><span id="ui-lvl-name">Qishloq üè°</span> <span id="ui-lvl-perc">0%</span></div>
    <div class="lvl-track"><div id="lvl-fill"></div></div>
</div>

<div class="main-stage">
    <h1 class="balance-h" id="ui-bal">0</h1>
    <div class="diamond-h" id="ui-diam">üíé 0</div>
    <div class="big-coin" onclick="handleTap(event)">
        <span class="tap-anim-val" id="ui-tap-power">+1</span>
    </div>
</div>

<div class="energy-section">
    <div class="energy-badge"><i>‚ö°</i><b id="ui-en">5000 / 5000</b></div>
</div>

<div class="navbar">
    <div class="nav-btn" onclick="show('p-shop')"><i>üÉè</i>Do'kon</div>
    <div class="nav-btn" onclick="show('p-bonus')"><i>üéÅ</i>Bonus</div>
    <div class="nav-btn" onclick="show('p-games')"><i>üéÆ</i>O'yinlar</div>
    <div class="nav-btn" onclick="show('p-rank')"><i>üèÜ</i>Reyting</div>
    <div class="nav-btn" onclick="show('p-prof')"><i>üë§</i>Profil</div>
</div>

<div id="p-shop" class="modal">
    <div class="modal-header"><h2>Upgrade Kartalar</h2><span class="x-btn" onclick="hide('p-shop')">√ó</span></div>
    <div id="shop-container" class="card-grid"></div>
</div>

<div id="p-bonus" class="modal">
    <div class="modal-header"><h2>Bonus Markazi</h2><span class="x-btn" onclick="hide('p-bonus')">√ó</span></div>
    <div class="item-card" style="border-left: 5px solid var(--ruby); margin-bottom:15px;">
        <h3>Super Tap üî•</h3>
        <p>30 soniya davomida Tap = 1000!</p>
        <button class="buy-btn" onclick="startSuperTap()">Reklama Ko'rib Yoqish</button>
    </div>
    <div class="item-card" style="border-left: 5px solid var(--blue);">
        <h3>Omadli Sandiq üéÅ</h3>
        <p>1,000 - 100,000 gacha tanga!</p>
        <button class="buy-btn" onclick="openChest()">Reklama Ko'rib Ochish</button>
    </div>
</div>

<div id="p-games" class="modal">
    <div class="modal-header"><h2>Mini O'yinlar</h2><span class="x-btn" onclick="hide('p-games')">√ó</span></div>
    
    <div id="aviator-zone">
        <div id="av-multiplier">1.00x</div>
        <div id="av-rocket">üöÄ</div>
        <div style="margin-top: 100px;">
            <input type="number" id="av-bet" value="1000" style="width:80%; padding:10px; border-radius:10px; border:none; text-align:center;">
            <button id="av-btn-start" class="buy-btn" style="background:var(--green)" onclick="avStart()">TIKISH</button>
            <button id="av-btn-cash" class="buy-btn" style="background:var(--gold); display:none;" onclick="avCashout()">OLISH</button>
        </div>
    </div>
    <hr style="margin:20px 0; opacity:0.1;">
    <div class="item-card">
        <h3>üß© Puzzle 36</h3>
        <p>Rasm bo'laklarini yig'ing va 100K yuting!</p>
        <button class="buy-btn" onclick="startPuzzle()">O'yinni Boshlash</button>
    </div>
</div>

<div id="p-rank" class="modal">
    <div class="modal-header"><h2>Reyting</h2><span class="x-btn" onclick="hide('p-rank')">√ó</span></div>
    <div id="rank-content"></div>
</div>

<div id="p-prof" class="modal">
    <div class="modal-header"><h2>Mening Profilim</h2><span class="x-btn" onclick="hide('p-prof')">√ó</span></div>
    <div class="item-card" style="text-align:left;">
        <p>üë§ Foydalanuvchi: <b id="u-name">...</b></p>
        <p>üÜî ID: <b id="u-id">...</b></p>
        <hr style="margin:10px 0; opacity:0.1;">
        <h3>üíé TON Hamyon</h3>
        <div id="ton-connect-btn" style="margin:10px 0;"></div>
        <p id="u-wallet" style="font-size:10px; color:#888;">Hamyon ulanmagan</p>
        <hr style="margin:10px 0; opacity:0.1;">
        <p>üèÜ Daraja: <b id="u-lvl">1 / 5</b></p>
        <p>üöÄ Airdrop: <b id="u-timer" style="color:var(--green)">...</b></p>
    </div>
</div>

<script>
// --- ASOSIY SOZLAMALAR ---
const tg = window.Telegram.WebApp;
const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" }; // O'zgartiring
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const user = tg.initDataUnsafe?.user || { id: "GUEST_" + Math.floor(Math.random()*1000), first_name: "O'yinchi" };

let s = { c: 0, d: 0, pph: 0, dph: 0, e: 5000, tap: 1, tab: 1, items: {}, lS: 0, lC: 0, w: "" };
const tNames = ["Qishloq üè°", "Muzlik ‚ùÑÔ∏è", "Yulduzli Tun üåå", "Olovli Dunyo üî•", "Tabiat üåø"];

// --- TON CONNECT ---
const tonUI = new TON_CONNECT_UI.TonConnectUI({
    manifestUrl: 'https://ganiyevdiyorbek700-dotcom.github.io/Oltin-Tanga-/tonconnect-manifest.json',
    buttonRootId: 'ton-connect-btn'
});
tonUI.onStatusChange(w => { if(w) { s.w = w.account.address; document.getElementById('u-wallet').innerText = s.w; save(); } });

// --- O'YINNI ISHGA TUSHIRISH ---
function init() {
    db.ref('users/' + user.id).once('value', snap => {
        if(snap.val()) s = {...s, ...snap.val()};
        updateUI();
        renderShop();
    });
    tg.expand();
    setInterval(tick, 1000);
}

function tick() {
    s.c += (s.pph / 3600);
    s.d += ((s.dph || 0) / 3600);
    if(s.e < 5000) s.e = Math.min(5000, s.e + 2);
    updateUI();
    updateAirdrop();
}

function updateUI() {
    document.getElementById('ui-bal').innerText = Math.floor(s.c).toLocaleString();
    document.getElementById('ui-diam').innerText = "üíé " + Math.floor(s.d);
    document.getElementById('ui-pph').innerText = "+" + s.pph.toLocaleString() + " /s";
    document.getElementById('ui-dph').innerText = "+" + (s.dph || 0) + " /s";
    document.getElementById('ui-en').innerText = Math.floor(s.e) + " / 5000";
    document.getElementById('ui-tap-power').innerText = "+" + s.tap;

    let next = s.tab * 200000;
    let p = Math.min(100, (s.c % next) / next * 100);
    document.getElementById('lvl-fill').style.width = p + "%";
    document.getElementById('ui-lvl-perc').innerText = Math.floor(p) + "%";
    document.getElementById('ui-lvl-name').innerText = tNames[s.tab-1] || "Qirol";
    document.body.className = "tab-" + s.tab;

    document.getElementById('u-name').innerText = user.first_name;
    document.getElementById('u-id').innerText = user.id;
    document.getElementById('u-lvl').innerText = s.tab + " / 5";
}

function handleTap(e) {
    if(s.e >= s.tap) {
        s.c += s.tap; s.e -= s.tap;
        updateUI();
        createTapEf(e.pageX, e.pageY, "+" + s.tap);
    } else {
        toast("Energiya tugadi!");
    }
}

function createTapEf(x, y, txt) {
    const el = document.createElement('div');
    el.innerText = txt;
    el.style.cssText = `position:fixed; left:${x}px; top:${y}px; color:white; font-weight:bold; font-size:30px; pointer-events:none; z-index:2000;`;
    document.body.appendChild(el);
    el.animate([{transform:'translateY(0)', opacity:1},{transform:'translateY(-150px)', opacity:0}], 800).onfinish = () => el.remove();
}

// --- DO'KON ---
function renderShop() {
    let h = '';
    for(let i=1; i<=25; i++) {
        let cost = Math.floor(2500 * Math.pow(1.6, i));
        let pph = Math.floor(120 * Math.pow(1.5, i));
        let isD = i % 5 === 0;
        let has = s.items && s.items[i];
        h += `<div class="item-card">
            <small>${isD ? 'üíé PREMIUM' : 'üìÄ KARTA'}</small>
            <h4>Upgrade ${i}</h4>
            <b style="color:var(--green)">+${pph}/s</b>
            <button class="buy-btn" onclick="buyK(${i}, ${cost}, ${pph}, ${isD})" ${has?'disabled':''}>
                ${has ? 'MAX' : (isD ? '20 üíé' : cost.toLocaleString())}
            </button>
        </div>`;
    }
    document.getElementById('shop-container').innerHTML = h;
}

function buyK(id, cost, pph, isD) {
    if(isD) {
        if(s.d >= 20) { s.d -= 20; s.dph = (s.dph||0)+2; finalize(id, pph); }
        else toast("Olmos yetarli emas!");
    } else {
        if(s.c >= cost) { s.c -= cost; finalize(id, pph); }
        else toast("Tanga yetarli emas!");
    }
}
function finalize(id, pph) {
    s.pph += pph; if(!s.items) s.items = {}; s.items[id] = true;
    let t = Math.ceil(id/5); if(t > s.tab) s.tab = t;
    save(); updateUI(); renderShop();
}

// --- BONUSLAR ---
function startSuperTap() {
    if(Date.now() - s.lS < 1800000) return toast("30 daqiqa kuting!");
    toast("SUPER TAP YOQILDI!");
    let old = s.tap; s.tap = 1000; s.lS = Date.now();
    setTimeout(() => { s.tap = old; updateUI(); }, 30000);
    save();
}

function openChest() {
    if(Date.now() - s.lC < 1800000) return toast("30 daqiqa kuting!");
    let w = Math.floor(Math.random() * 90000) + 10000;
    s.c += w; s.lC = Date.now();
    toast(w.toLocaleString() + " tanga yutdingiz!");
    save(); updateUI();
}

// --- AVIATOR ---
let avRun = false, avX = 1.0, avB = 0, avI;
function avStart() {
    let amt = parseInt(document.getElementById('av-bet').value);
    if(s.c < amt) return toast("Mablag' kam!");
    s.c -= amt; avB = amt; avRun = true; avX = 1.0;
    document.getElementById('av-btn-start').style.display = 'none';
    document.getElementById('av-btn-cash').style.display = 'block';
    let cp = (Math.random() * 4 + 1).toFixed(2);
    avI = setInterval(() => {
        avX += 0.01;
        document.getElementById('av-multiplier').innerText = avX.toFixed(2) + "x";
        document.getElementById('av-rocket').style.left = Math.min(80, avX*10) + "%";
        if(avX >= cp) { clearInterval(avI); avRun = false; toast("BOOM!"); avReset(); }
    }, 100);
}
function avCashout() {
    if(!avRun) return; clearInterval(avI);
    let win = Math.floor(avB * avX); s.c += win;
    toast("YUTUQ: " + win); avRun = false; avReset(); updateUI(); save();
}
function avReset() {
    setTimeout(() => {
        document.getElementById('av-btn-start').style.display = 'block';
        document.getElementById('av-btn-cash').style.display = 'none';
        document.getElementById('av-multiplier').innerText = "1.00x";
    }, 2000);
}

// --- REYTING ---
function loadRank() {
    db.ref('users').orderByChild('c').limitToLast(10).once('value', snap => {
        let h = ''; let list = [];
        snap.forEach(u => list.push(u.val()));
        list.reverse().forEach((u, i) => {
            let m = (i==0)?'ü•á':(i==1)?'ü•à':(i==2)?'ü•â':(i+1);
            h += `<div class="rank-row"><span>${m}. ${u.first_name}</span><b>${Math.floor(u.c).toLocaleString()}</b></div>`;
        });
        document.getElementById('rank-content').innerHTML = h;
    });
}

function updateAirdrop() {
    let diff = new Date("2026-06-01") - new Date();
    let d = Math.floor(diff/(1000*60*60*24)), h = Math.floor((diff%(1000*60*60*24))/(1000*60*60)), m = Math.floor((diff%(1000*60*60))/(1000*60)), sec = Math.floor((diff%(1000*60))/1000);
    document.getElementById('u-timer').innerText = `${d}k ${h}:${m}:${sec}`;
}

function show(id) { if(id==='p-rank') loadRank(); document.getElementById(id).style.display = 'block'; }
function hide(id) { document.getElementById(id).style.display = 'none'; }
function toast(m) { let t=document.getElementById('toast-msg'); t.innerText=m; t.style.display='block'; setTimeout(()=>t.style.display='none',2500); }
function save() { db.ref('users/' + user.id).update(s); }

init();
</script>
</body>
    </html>
    
        
                                               
    
            
        
        
    
        
    
    
            
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

