<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://alwingulla.com/88/tag.min.js" data-zone="10558007" async></script>
    
    <style>
        :root { --bg: #0b111d; --card: #151f2c; --accent: #f39c12; --input: #0f1722; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; text-align: center; user-select: none; }
        
        /* Stats Table */
        .top-nav { display: flex; justify-content: center; gap: 5px; padding: 10px; }
        .s-item { background: var(--card); border: 1px solid #2c3e50; border-radius: 10px; padding: 5px; flex: 1; font-size: 11px; color: #888; }
        .s-item b { display: block; color: var(--accent); font-size: 14px; }

        /* Main */
        .score-main { font-size: 60px; font-weight: bold; margin-top: 20px; }
        .diam-main { color: #3498db; font-size: 20px; display: block; margin-bottom: 20px; }
        
        .tanga-wrap { position: relative; width: 260px; height: 260px; margin: 0 auto; }
        .tanga-btn { 
            width: 100%; height: 100%; border-radius: 50%;
            background: radial-gradient(circle, #f1c40f, #d4ac0d);
            border: 8px solid #b7950b; font-size: 100px;
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.1s;
        }
        .tanga-btn:active { transform: scale(0.95); }

        /* Energy */
        .energy-box { margin: 30px auto; width: 80%; }
        .eb-text { font-size: 14px; margin-bottom: 5px; }
        .eb-bar { height: 10px; background: #1a2332; border-radius: 10px; overflow: hidden; }
        .eb-fill { height: 100%; background: linear-gradient(90deg, #f1c40f, #e67e22); transition: 0.2s; }

        /* Market Input & Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 1000; padding: 20px; box-sizing: border-box; }
        .active { display: block; }
        .card { background: var(--card); border-radius: 15px; padding: 20px; border: 1px solid #2c3e50; margin-bottom: 15px; }
        
        input { 
            width: 100%; padding: 15px; border-radius: 10px; border: 1px solid #2c3e50;
            background: var(--input); color: white; margin: 15px 0; text-align: center; font-size: 16px;
        }
        .btn-gold { background: var(--accent); color: black; border: none; padding: 15px; border-radius: 10px; width: 100%; font-weight: bold; cursor: pointer; }
        .btn-close { background: #2c3e50; color: white; border: none; padding: 12px; border-radius: 10px; width: 100%; margin-top: 10px; }

        /* Bottom Nav */
        .nav { position: fixed; bottom: 0; width: 100%; display: flex; background: #0a0e17; padding: 10px 0; border-top: 1px solid #1a2533; }
        .nav-item { flex: 1; font-size: 10px; color: #888; cursor: pointer; }
    </style>
</head>
<body>

<audio id="bgMusic" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"></audio>

<div class="top-nav">
    <div class="s-item">STATUS <b id="u-status">Bronza</b></div>
    <div class="s-item">SOATIGA <b id="h-val">0</b></div>
    <div class="s-item">TAP KUCHI <b id="p-val">1</b></div>
</div>

<div class="score-main" id="score">0</div>
<div class="diam-main">üíé <span id="d-val">0</span></div>

<div class="tanga-wrap">
    <div class="tanga-btn" onclick="tap(event)">üí∞</div>
</div>

<div class="energy-box">
    <div class="eb-text">‚ö° <span id="e-now">500</span> / <span id="e-max">500</span></div>
    <div class="eb-bar"><div id="e-fill" class="eb-fill"></div></div>
</div>

<div id="market-modal" class="modal">
    <h2 style="display:flex; align-items:center; justify-content:center; gap:10px;">üõí Market</h2>
    <div class="card">
        <h3>1,000 üí∞ = 1 üíé</h3>
        <input type="number" id="market-input" placeholder="Qancha almashtirasiz?">
        <button class="btn-gold" onclick="exchange()">ALMASHTIRISH</button>
    </div>
    <button class="btn-close" onclick="closeAll()">YOPISH</button>
</div>

<div id="bonus-modal" class="modal">
    <h2>üéÅ Kunlik Bonus</h2>
    <div class="card">
        <p>Kunlik kirganingiz uchun bonus oling!</p>
        <button class="btn-gold" id="daily-btn" onclick="getDailyBonus()">5,000 üí∞ OLISH</button>
        <button class="btn-gold" style="background:#e67e22; margin-top:10px;" onclick="showAdBonus()">10,000 üí∞ (REKLAMA)</button>
    </div>
    <button class="btn-close" onclick="closeAll()">YOPISH</button>
</div>

<div id="leader-modal" class="modal"><h2>üìä Leaderboard</h2><div id="leader-list"></div><button class="btn-close" onclick="closeAll()">YOPISH</button></div>
<div id="booster-modal" class="modal"><h2>‚ö° Boosterlar</h2>
    <div class="card">Tap +1 | 500 üí∞ <button onclick="buy('p')" class="btn-gold">LEVEL UP</button></div>
    <div class="card">Soatiga +100 | 1000 üí∞ <button onclick="buy('h')" class="btn-gold">LEVEL UP</button></div>
    <button class="btn-close" onclick="closeAll()">YOPISH</button>
</div>

<nav class="nav">
    <div class="nav-item" onclick="openM('market')">üõí<br>MARKET</div>
    <div class="nav-item" onclick="openM('leader')">üìä<br>REYTING</div>
    <div class="nav-item" onclick="openM('booster')">‚ö°<br>BOOSTER</div>
    <div class="nav-item" onclick="openM('bonus')">üéÅ<br>BONUS</div>
    <div class="nav-item" onclick="alert('ID: '+user.id)">üè†<br>UYIM</div>
</nav>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDbttlr-oGJeDbjMbrubcuspgg9gk-7Gxs",
        databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com",
        projectId: "oltin-tanga-d2c80",
        appId: "1:954210050924:web:f57b75568c66216c49c949"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const tg = window.Telegram.WebApp;
    const user = tg.initDataUnsafe.user || { id: "8009403510", first_name: "Ganiyev" };

    let s = { coins: 0, diams: 0, power: 1, hourly: 0, energy: 500, maxE: 500, lastSeen: Date.now(), lastBonus: 0 };

    function init() {
        tg.expand();
        db.ref('users/' + user.id).once('value', (snap) => {
            if(snap.exists()) {
                let d = snap.val();
                let earned = (d.hourly / 3600) * ((Date.now() - d.lastSeen)/1000);
                s = {...s, ...d, coins: (d.coins || 0) + earned};
            }
            updateUI();
        });
        setInterval(() => { s.coins += (s.hourly / 3600); if(s.energy < s.maxE) s.energy += 0.5; updateUI(); }, 1000);
        setInterval(saveData, 15000);
    }

    function tap(e) {
        document.getElementById('bgMusic').play().catch(()=>{});
        if(s.energy >= s.power) { s.coins += s.power; s.energy -= s.power; updateUI(); }
    }

    // MARKET FUNKSIYASI (INPUT BILAN)
    function exchange() {
        let val = parseInt(document.getElementById('market-input').value);
        if(!val || val <= 0) return alert("Miqdorni kiriting!");
        let cost = val * 1000;
        if(s.coins >= cost) {
            s.coins -= cost;
            s.diams += val;
            saveData(); updateUI();
            alert("Muvaffaqiyatli almashtirildi!");
            document.getElementById('market-input').value = "";
        } else {
            alert("Mablag' yetarli emas!");
        }
    }

    // KUNLIK BONUS (SUTKADA 1 MARTA)
    function getDailyBonus() {
        let now = Date.now();
        let diff = now - (s.lastBonus || 0);
        if(diff >= 24 * 60 * 60 * 1000) {
            s.coins += 5000;
            s.lastBonus = now;
            saveData(); updateUI();
            alert("5,000 tanga bonus berildi!");
        } else {
            let left = Math.ceil((24 * 60 * 60 * 1000 - diff) / (60 * 60 * 1000));
            alert("Bonus olib bo'lingan! Yana " + left + " soatdan keyin keling.");
        }
    }

    // REKLAMA BONUSI
    function showAdBonus() {
        if(window.show_10558007) {
            window.show_10558007().then(() => {
                s.coins += 10000; saveData(); updateUI();
                alert("Reklama uchun 10,000 tanga berildi!");
            });
        } else {
            alert("Reklama yuklanmadi, birozdan keyin urinib ko'ring.");
        }
    }

    function buy(type) {
        if(type === 'p' && s.coins >= 500) { s.coins -= 500; s.power += 1; }
        if(type === 'h' && s.coins >= 1000) { s.coins -= 1000; s.hourly += 100; }
        saveData(); updateUI();
    }

    function updateUI() {
        document.getElementById('score').innerText = Math.floor(s.coins).toLocaleString();
        document.getElementById('h-val').innerText = s.hourly;
        document.getElementById('p-val').innerText = s.power;
        document.getElementById('d-val').innerText = s.diams;
        document.getElementById('e-now').innerText = Math.floor(s.energy);
        document.getElementById('e-max').innerText = s.maxE;
        document.getElementById('e-fill').style.width = (s.energy/s.maxE*100) + "%";
        
        // Statusni aniqlash
        if(s.coins > 1000000) document.getElementById('u-status').innerText = "Oltin";
        else if(s.coins > 100000) document.getElementById('u-status').innerText = "Kumush";
    }

    function openM(id) { document.getElementById(id + '-modal').classList.add('active'); if(id === 'leader') loadLeader(); }
    function closeAll() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('active')); }

    function loadLeader() {
        db.ref('users').orderByChild('coins').limitToLast(10).once('value', (snap) => {
            let list = "";
            snap.forEach(c => {
                let u = c.val();
                list = `<div class="card">${u.name || 'User'}: ${Math.floor(u.coins)} üí∞</div>` + list;
            });
            document.getElementById('leader-list').innerHTML = list;
        });
    }

    function saveData() {
        db.ref('users/' + user.id).update({...s, name: user.first_name, lastSeen: Date.now()});
    }

    init();
</script>
</body>
    </html>
    
                                                                          </html>
    
            
            
        
    
    
                                        
                                                                                 </html>

    
    
    
                                                                                              

        

    
                                                           </html>
            
                                                      
                

