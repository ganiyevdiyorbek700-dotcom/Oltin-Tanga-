<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Oltin Tanga: Moonlight</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://alwingulla.com/88/pfe/current/tag.min.js?z=10558007" data-cfasync="false" async></script>

    <style>
        :root {
            --gold: #ffcc00; --blue: #00d2ff; --bg: #020408; --card: #10141c;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background: var(--bg) url('https://www.transparenttextures.com/patterns/stardust.png');
            color: white; font-family: 'Ubuntu', sans-serif;
            height: 100vh; overflow: hidden;
            background-image: radial-gradient(circle at top, #1a1a2e 0%, #020408 100%);
        }

        /* Tutilgan oy effekti */
        .moon {
            position: absolute; top: 10%; left: 50%; transform: translateX(-50%);
            width: 150px; height: 150px; border-radius: 50%;
            background: #f1c40f; box-shadow: 0 0 50px #f1c40f, inset 20px 0 20px #000;
            z-index: -1; opacity: 0.6;
        }

        .header {
            display: grid; grid-template-columns: repeat(3, 1fr);
            padding: 10px; gap: 8px; background: rgba(0,0,0,0.4);
        }
        .stat { background: var(--card); padding: 8px; border-radius: 12px; text-align: center; border: 1px solid #222; }
        .stat small { font-size: 9px; color: #888; display: block; }
        .stat b { font-size: 13px; color: var(--gold); }

        .game-zone {
            height: 60vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .balance-box { font-size: 45px; font-weight: 900; margin-bottom: 20px; text-shadow: 0 0 20px var(--gold); }

        .main-btn {
            width: 240px; height: 240px; border-radius: 50%;
            background: radial-gradient(circle, #222, #000);
            border: 10px solid var(--eff-color, #1a1a1a);
            display: flex; align-items: center; justify-content: center;
            font-size: 100px; cursor: pointer; transition: 0.1s;
            box-shadow: 0 0 40px var(--eff-color, transparent);
        }
        .main-btn:active { transform: scale(0.92); }

        .energy-box { width: 70%; margin-top: 25px; text-align: center; }
        .progress { height: 12px; background: #111; border-radius: 10px; overflow: hidden; border: 1px solid #333; }
        #bar { width: 100%; height: 100%; background: linear-gradient(90deg, #ffcc00, #ff6600); transition: 0.2s; }

        .side-icons { position: absolute; width: 100%; display: flex; justify-content: space-between; padding: 0 20px; top: 50%; }
        .circle-tool { width: 65px; height: 65px; background: var(--card); border-radius: 50%; border: 2px solid var(--gold); display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 20px; }
        .circle-tool small { font-size: 8px; }

        nav { position: fixed; bottom: 0; width: 100%; height: 80px; background: var(--card); display: flex; border-top: 1px solid #333; }
        .nav-link { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; color: #666; }
        .nav-link.active { color: var(--gold); }
        .nav-link i { font-size: 24px; font-style: normal; margin-bottom: 4px; }

        .modal { display: none; position: fixed; inset: 0; background: var(--bg); z-index: 9999; padding: 20px; overflow-y: auto; }
        .modal-h { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .item { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #222; }
        .item-btn { background: var(--gold); color: black; border: none; padding: 10px 15px; border-radius: 10px; font-weight: bold; }
    </style>
</head>
<body>

    <div class="moon"></div>
    <div class="header">
        <div class="stat"><small>Soatbay</small><b>+<span id="h-hourly">0</span></b></div>
        <div class="stat"><small>Olmos</small><b style="color:var(--blue)">ğŸ’ <span id="h-diams">0</span></b></div>
        <div class="stat"><small>Daraja</small><b id="h-lvl">1</b></div>
    </div>

    <div class="game-zone">
        <div class="balance-box">ğŸ’° <span id="p-balance">0</span></div>
        <div class="side-icons">
            <div class="circle-tool" onclick="openM('m-daily')">ğŸ“…<small>Bonus</small></div>
            <div class="circle-tool" onclick="getGift()">ğŸ<small id="gift-timer">Tekin</small></div>
        </div>
        <div class="main-btn" id="tap-node">ğŸ“€</div>
        <div class="energy-box">
            <div class="progress"><div id="bar"></div></div>
            <small>âš¡ <span id="p-energy">1000</span> / <span id="p-max">1000</span></small>
        </div>
    </div>

    <div id="m-market" class="modal">
        <div class="modal-h"><h2>ğŸ›’ Bozor</h2><span onclick="closeM()">âŒ</span></div>
        <div style="display:flex; gap:10px; margin-bottom:20px;">
            <button class="item-btn" style="flex:1" onclick="showTab('swap')">ğŸ”„ Ayirboshlash</button>
            <button class="item-btn" style="flex:1" onclick="showTab('cards')">ğŸƒ Kartalar</button>
        </div>
        <div id="tab-swap">
            <div class="item"><div><b>1 Olmos almashtirish</b><br><small>+1000 Tanga</small></div><button class="item-btn" onclick="swap(1)">1 ğŸ’</button></div>
            <div class="item"><div><b>10 Olmos almashtirish</b><br><small>+10,000 Tanga</small></div><button class="item-btn" onclick="swap(10)">10 ğŸ’</button></div>
        </div>
        <div id="tab-cards" style="display:none">
            <h4 style="color:var(--gold)">Daraja 1 (Anime)</h4>
            <div class="item"><div><b>ğŸ”¥ Goku</b><br><small>Mining: +10ğŸ’/soat</small></div><button class="item-btn" onclick="buyCard('Goku', 100, 10, 'ğŸŸ ')">100 ğŸ’</button></div>
            <h4 style="color:var(--blue)">Daraja 2 (Futbol)</h4>
            <div class="item"><div><b>âš½ Messi</b><br><small>Mining: +300ğŸ’/soat</small></div><button class="item-btn" onclick="buyCard('Messi', 5000, 300, 'ğŸ”µ')">5000 ğŸ’</button></div>
            <h4 style="color:#ff0044">Daraja 3 (Marvel)</h4>
            <div class="item"><div><b>ğŸ•¸ï¸ Spider-Man</b><br><small>Mining: +700ğŸ’/soat</small></div><button class="item-btn" onclick="buyCard('Spider', 50000, 700, 'ğŸ”´')">50k ğŸ’</button></div>
        </div>
    </div>

    <div id="m-boost" class="modal">
        <div class="modal-h"><h2>âš¡ Boosterlar</h2><span onclick="closeM()">âŒ</span></div>
        <div id="boost-content"></div>
    </div>

    <div id="m-uy" class="modal">
        <div class="modal-h"><h2>ğŸ  Mening Uyim</h2><span onclick="closeM()">âŒ</span></div>
        <div class="item"><div><b>Mening ID:</b><br><span id="u-id">0</span></div></div>
        <div class="item"><div><b>ğŸ’° Jami Tangalar:</b></div><b id="u-coins">0</b></div>
        <div class="item"><div><b>ğŸ’ Jami Olmoslar:</b></div><b id="u-diams">0</b></div>
        <div class="item"><div><b>ğŸ“ˆ Mining darajasi:</b></div><b id="u-mine">0</b></div>
        <button class="item-btn" style="width:100%; height:50px; margin-top:20px" onclick="alert('Tez kunda Tonga almashtirish boshlanadi!')">ğŸš€ AIRDROP</button>
    </div>

    <nav>
        <div class="nav-link" onclick="openM('m-market')"><i>ğŸ›’</i>BOZOR</div>
        <div class="nav-link" onclick="openM('m-ref')"><i>ğŸ‘¥</i>REF</div>
        <div class="nav-link" onclick="openM('m-rank')"><i>ğŸ“Š</i>RANK</div>
        <div class="nav-link" onclick="openM('m-boost')"><i>âš¡</i>BOOST</div>
        <div class="nav-link" onclick="openM('m-uy')"><i>ğŸ </i>UYIM</div>
    </nav>

<script>
    // FIREBASE
    const firebaseConfig = { databaseURL: "https://oltin-tanga-d2c80-default-rtdb.firebaseio.com" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const tg = window.Telegram.WebApp;
    const user = tg.initDataUnsafe.user || { id: 777, first_name: "O'yinchi" };

    let s = {
        coins: 0, diams: 0, energy: 1000, maxE: 1000, power: 1, regen: 1, hourly: 0, mine: 0,
        lastGift: 0, lastDaily: 0, dailyDay: 0,
        color: '#1a1a1a', icon: 'ğŸ“€',
        bLvl: { p:1, e:1, r:1, h:1 }
    };

    function init() {
        tg.expand();
        db.ref('users/' + user.id).on('value', snap => {
            if(snap.exists()) s = {...s, ...snap.val()};
            updateUI();
        });

        // Mining & Energy Loop
        setInterval(() => {
            if(s.energy < s.maxE) s.energy = Math.min(s.maxE, s.energy + s.regen);
            s.coins += (s.hourly / 3600);
            s.diams += (s.mine / 3600);
            updateUI();
        }, 1000);

        renderBoosts();
    }

    function updateUI() {
        document.getElementById('p-balance').innerText = Math.floor(s.coins).toLocaleString();
        document.getElementById('h-diams').innerText = Math.floor(s.diams).toLocaleString();
        document.getElementById('h-hourly').innerText = s.hourly;
        document.getElementById('p-energy').innerText = Math.floor(s.energy);
        document.getElementById('p-max').innerText = s.maxE;
        document.getElementById('bar').style.width = (s.energy/s.maxE*100) + "%";
        
        document.getElementById('tap-node').innerText = s.icon;
        document.body.style.setProperty('--eff-color', s.color);

        // Uyim bo'limi yangilash
        document.getElementById('u-id').innerText = user.id;
        document.getElementById('u-coins').innerText = Math.floor(s.coins).toLocaleString();
        document.getElementById('u-diams').innerText = Math.floor(s.diams).toLocaleString();
        document.getElementById('u-mine').innerText = s.mine + " ğŸ’/soat";
    }

    document.getElementById('tap-node').addEventListener('touchstart', (e) => {
        if(s.energy >= s.power) {
            s.coins += s.power; s.energy -= s.power;
            tg.HapticFeedback.impactOccurred('light');
            updateUI();
            save();
        }
    });

    function getGift() {
        const now = Date.now();
        if(now - s.lastGift > 86400000) {
            const win = Math.floor(Math.random() * 24000) + 1000;
            s.coins += win; s.lastGift = now;
            alert("Tabriklaymiz! +" + win + " tanga");
            save();
        } else { alert("Keyingi sovg'a uchun 24 soat kuting!"); }
    }

    function buyCard(name, price, mineRate, color) {
        if(s.diams >= price) {
            s.diams -= price; s.mine += mineRate;
            s.color = color === 'ğŸŸ ' ? '#ff6600' : (color === 'ğŸ”µ' ? '#00d2ff' : '#ff0044');
            s.icon = color;
            alert(name + " faollashdi! Mining boshlandi.");
            save();
        } else { alert("Olmos yetarli emas!"); }
    }

    function renderBoosts() {
        const list = [
            {id:'p', n:'Tap Kuchi', k:'power'},
            {id:'e', n:'Max Energiya', k:'maxE'},
            {id:'r', n:'Tiklanish', k:'regen'},
            {id:'h', n:'Soatbay foyda', k:'hourly'}
        ];
        let h = "";
        list.forEach(b => {
            let cost = 500 + (s.bLvl[b.id] * 2000);
            h += `<div class="item"><div><b>${b.n}</b><br><small>Daraja: ${s.bLvl[b.id]}</small></div><button class="item-btn" onclick="upB('${b.id}', ${cost})">${cost} ğŸ’°</button></div>`;
        });
        document.getElementById('boost-content').innerHTML = h;
    }

    function upB(id, cost) {
        if(s.coins >= cost) {
            s.coins -= cost; s.bLvl[id]++;
            if(id==='p') s.power++;
            if(id==='e') s.maxE += 500;
            if(id==='r') s.regen++;
            if(id==='h') s.hourly += 100;
            renderBoosts(); save();
        }
    }

    function swap(amt) {
        if(s.diams >= amt) { s.diams -= amt; s.coins += (amt * 1000); save(); }
    }

    function save() { db.ref('users/' + user.id).set(s); }
    function openM(id) { document.getElementById(id).style.display = 'block'; }
    function closeM() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); }
    function showTab(t) {
        document.getElementById('tab-swap').style.display = t==='swap'?'block':'none';
        document.getElementById('tab-cards').style.display = t==='cards'?'block':'none';
    }

    init();
</script>
</body>
            </html>
                
            
    
        
        
    
        
                                                       
        
                                    
        
        
    
                                        
                                                                     
        
    
                                                              
            
    
            
            
                                                      
                

